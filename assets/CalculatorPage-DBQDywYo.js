var we=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var se=(u,t,c)=>t in u?we(u,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):u[t]=c,W=(u,t)=>{for(var c in t||(t={}))Le.call(t,c)&&se(u,c,t[c]);if(he)for(var c of he(t))Re.call(t,c)&&se(u,c,t[c]);return u},z=(u,t)=>ke(u,Ce(t));var pe=(u,t,c)=>se(u,typeof t!="symbol"?t+"":t,c);var A=(u,t,c)=>new Promise((d,i)=>{var l=x=>{try{m(c.next(x))}catch(h){i(h)}},n=x=>{try{m(c.throw(x))}catch(h){i(h)}},m=x=>x.done?d(x.value):Promise.resolve(x.value).then(l,n);m((c=c.apply(u,t)).next())});import{u as ie,j as e,M as fe,P as Te,f as H,K as Se,a as D,T as B,g as Ee,b as U,c as G,W as Me,N as Pe,B as ye,_ as ge}from"./index-DBdxZjm_.js";import{R as Y,r as I}from"./vendor-Dt516RNf.js";import{D as ae,S as K}from"./dataService-CkMse3mw.js";import{S as $e}from"./ShardAutocomplete-COjtjeZo.js";import{a as Qe,Z as Fe,R as _e,c as Oe,b as He,d as Ke,e as Ie,T as qe,f as be,H as je,X as We,M as ve,g as ze}from"./icons-DNYyJ9Q2.js";import{u as Ae}from"./useCustomRates-eJWc_BJY.js";import"./forms-CPIcrlzh.js";function Be(u){return A(this,null,function*(){return!u||typeof u!="string"?!1:!!(yield ae.getInstance().getShardNameToKeyMap())[u.trim().toLowerCase()]})}const Ue=({onSubmit:u})=>{const{form:t,setForm:c}=ie();Y.useEffect(()=>{A(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Be(t.shard))&&u(z(W({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const d=(s,o)=>{const r=z(W({},t),{[s]:o});c(r),s!=="shard"&&s!=="quantity"&&u(r)},i=()=>{const s=z(W({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});c(s),setTimeout(()=>{u(s)},0)},l=()=>{const s=t.shard,o=t.quantity,r={shard:s,quantity:o,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};c(r),x(""),setTimeout(()=>{u(r)},0)};function n(s){if(!s)return 0;const o=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!o)return Number(s.replace(/,/g,""))||0;let r=parseFloat(o[1].replace(/,/g,""));const a=o[2];return a==="k"?r*=1e3:a==="m"?r*=1e6:a==="b"&&(r*=1e9),Math.round(r)}const[m,x]=Y.useState("");Y.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&m===""&&(d("moneyPerHour",1/0),u(z(W({},t),{moneyPerHour:1/0})))},[t.shard]),Y.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&m!==""&&x("")},[t.moneyPerHour]);const h=()=>{t.shard&&d("shard","")};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx($e,{value:t.shard,onChange:s=>d("shard",s),onSelect:s=>{let o="common";if(s&&typeof s.rarity=="string"){const p=s.rarity.toLowerCase();p in fe&&(o=p)}const r=fe[o],a=z(W({},t),{shard:s.name,quantity:r});c(a),setTimeout(()=>u(a),0)},onFocus:h,placeholder:"Search for a shard...",searchMode:"name-only"})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>d("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:i,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:l,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>d("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>d("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>d("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt",shardId:"C35"},{key:"salamanderLevel",label:"Salamander",shardId:"U8"},{key:"lizardKingLevel",label:"Lizard King",shardId:"R8"},{key:"leviathanLevel",label:"Leviathan",shardId:"E5"},{key:"pythonLevel",label:"Python",shardId:"R9"},{key:"kingCobraLevel",label:"King Cobra",shardId:"R54"},{key:"seaSerpentLevel",label:"Sea Serpent",shardId:"E32"},{key:"tiamatLevel",label:"Tiamat",shardId:"L6"},{key:"crocodileLevel",label:"Crocodile",shardId:"R45"}].map(({key:s,label:o,shardId:r})=>{var p;const a=K[r];return e.jsx(Te,{value:t[s]||0,onChange:f=>d(s,f),label:o,tooltipTitle:a==null?void 0:a.title,tooltipContent:H((a==null?void 0:a.description)||"No description available."),tooltipShardName:o,tooltipShardIcon:r,tooltipRarity:((p=a==null?void 0:a.rarity)==null?void 0:p.toLowerCase())||"common",tooltipFamily:a==null?void 0:a.family,tooltipType:a==null?void 0:a.type,tooltipWarning:s==="crocodileLevel"?"Warning: May slow calculations significantly":void 0},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Se,{value:t.kuudraTier||"none",onChange:s=>d("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:m,onChange:s=>{if(x(s.target.value),s.target.value.trim()==="")d("moneyPerHour",1/0),u(z(W({},t),{moneyPerHour:1/0}));else{const o=n(s.target.value);d("moneyPerHour",o)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},ne=({tree:u,data:t,isTopLevel:c=!1,totalShardsProduced:d=u.quantity,nodeId:i,expandedStates:l,onToggle:n})=>{var V,re,le,ce,oe,de;const m=t.shards[u.shard],x=E=>{const g=t.recipes[E];if(!(g!=null&&g.length))return null;const b={U8:S=>S.inputs.includes("C35")&&S.inputs.includes("U38"),C35:S=>S.inputs.includes("C23")&&S.inputs.includes("U38")}[E];return b?g.find(b):g.sort((S,w)=>w.outputQuantity-S.outputQuantity)[0]},h=E=>E?e.jsx(He,{className:"w-6 h-6 text-amber-400"}):e.jsx(Ke,{className:"w-6 h-6 text-amber-400"}),s=(E,g,Q=!0)=>{var S;const b=K[g.id];return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((b==null?void 0:b.description)||"No description available."),title:b==null?void 0:b.title,shardName:g.name,shardIcon:g.id,rarity:((S=b==null?void 0:b.rarity)==null?void 0:S.toLowerCase())||g.rarity,family:b==null?void 0:b.family,type:b==null?void 0:b.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})}),Q&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]})},o=(E,g,Q,b,S,w,M=!1,$)=>{var q,F,O;const N=K[g.id],k=K[b.id],L=K[w.id];return e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium min-w-0",children:[M&&e.jsxs("span",{className:"font-normal text-sm text-amber-300 flex-shrink-0 mr-2",children:["Step ",$,":"]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((N==null?void 0:N.description)||"No description available."),title:N==null?void 0:N.title,shardName:g.name,shardIcon:g.id,rarity:((q=N==null?void 0:N.rarity)==null?void 0:q.toLowerCase())||g.rarity,family:N==null?void 0:N.family,type:N==null?void 0:N.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"="}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[Q,"x"]}),e.jsx(B,{content:H((k==null?void 0:k.description)||"No description available."),title:k==null?void 0:k.title,shardName:b.name,shardIcon:b.id,rarity:((F=k==null?void 0:k.rarity)==null?void 0:F.toLowerCase())||b.rarity,family:k==null?void 0:k.family,type:k==null?void 0:k.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${b.id}.png`,alt:b.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(b.rarity)} whitespace-nowrap text-sm`,children:b.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"+"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[S,"x"]}),e.jsx(B,{content:H((L==null?void 0:L.description)||"No description available."),title:(L==null?void 0:L.title)||w.name,shardName:w.name,shardIcon:w.id,rarity:((O=L==null?void 0:L.rarity)==null?void 0:O.toLowerCase())||w.rarity,family:L==null?void 0:L.family,type:L==null?void 0:L.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${w.id}.png`,alt:w.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(w.rarity)} whitespace-nowrap text-sm`,children:w.name})]})})]})]})},r=(E,g)=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full flex-shrink-0"}),e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2",children:s(E,g,!1)}),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]}),a=(E,g,Q,b=1)=>{var q;const S=E.outputQuantity,w=t.shards[E.inputs[0]],M=t.shards[E.inputs[1]],$=w.fuse_amount,N=M.fuse_amount,k=`${Q}-${g.id}`,L=(q=l.get(k))!=null?q:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>n(k),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(L),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:o(S,g,$,w,N,M)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:"1"})]})})]}),L&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 flex flex-col gap-0.5",children:E.inputs.map(F=>{const O=t.shards[F];if(!O)return null;const Z=x(F);return F==="C11"||F==="U38"||F==="C23"?e.jsx("div",{children:r(O.fuse_amount,O)},`direct-${F}`):Z&&b<2?e.jsx("div",{children:a(Z,O,k,b+1)},`sub-${F}`):null})})]})};if(u.method==="cycle"){const E=(V=l.get(i))!=null?V:!0,g=Math.ceil(u.quantity/(u.cycles[0].expectedOutput-u.cycles[0].baseOutput));return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors gap-2 sm:gap-8",onClick:()=>n(i),children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(E),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"text-sm text-amber-300 flex-shrink-0",children:[g," crafts"]}),e.jsx(Oe,{className:"w-6 text-amber-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[s(Math.floor(u.quantity),m,!1),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-sm font-medium rounded-md flex-shrink-0",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:g})]})})]}),E&&u.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:u.cycles.map((Q,b)=>e.jsxs("div",{children:[e.jsx("div",{className:"space-y-0.5",children:[...Q.steps].slice().reverse().map((S,w)=>{var Z;const M=S.recipe,$=t.shards[S.outputShard],N=t.shards[M.inputs[0]],k=t.shards[M.inputs[1]],L=N.fuse_amount,q=k.fuse_amount;let F=M.outputQuantity;M.isReptile&&(F*=Q.multiplier);const O=Q.steps.length-w;if(O===1){const te=`${i}-step-${O}`,me=(Z=l.get(te))!=null?Z:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>n(te),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(me),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:o(F,$,L,N,q,k,!0,O)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:Q.expectedCrafts})]})})]}),me&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-1",children:M.inputs.map(X=>{const ue=t.shards[X],xe=x(X);return xe&&ue&&X!=="C11"&&X!=="U38"&&X!=="C23"?e.jsx("div",{className:"space-y-1",children:a(xe,ue,i)},X):null})})]},w)}else return e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between gap-2 sm:gap-8",children:[e.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:o(F,$,L,N,q,k,!0,O)}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:Q.expectedCrafts})]})})]},w)})}),(()=>{const S=new Set(Q.steps.map(M=>M.outputShard)),w={};return Q.steps.forEach(M=>{M.recipe.inputs.forEach($=>{const N=t.shards[$];!N||S.has($)||(w[$]||(w[$]={quantity:0,shard:N}),w[$].quantity+=N.fuse_amount)})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(w).map(({quantity:M,shard:$})=>e.jsx("div",{children:r(M*g,$)},$.id))})})()]},b))})]})}if(u.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s(u.quantity,m,!1),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[D(m.rate),e.jsx("span",{className:"text-slate-500 text-xs font-bold mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})})]});const p=(re=l.get(i))!=null?re:!0,f=u.inputs[0],j=u.inputs[1],y=t.shards[f.shard],R=t.shards[j.shard],P="craftsNeeded"in u&&(le=u.craftsNeeded)!=null?le:1,_=c?d:u.quantity,v=K[m.id],C=K[y.id],T=K[R.id];return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>n(i),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-15 sm:gap-8 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 p-0.5 min-w-0 flex-1",children:[h(p),e.jsxs("div",{className:"text-white flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsxs("span",{className:"font-medium text-sm flex-shrink-0",children:[Math.floor(_),"x"]}),e.jsx(B,{content:H((v==null?void 0:v.description)||"No description available."),title:v==null?void 0:v.title,shardName:m.name,shardIcon:m.id,rarity:((ce=v==null?void 0:v.rarity)==null?void 0:ce.toLowerCase())||m.rarity,family:v==null?void 0:v.family,type:v==null?void 0:v.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${m.id}.png`,alt:m.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium ${U(m.rarity)} text-sm truncate`,title:Ee(m,!1),children:m.name})]})}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center gap-1 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsx("span",{className:"text-white flex-shrink-0 text-sm",children:"="}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(f.quantity),"x"]}),e.jsx(B,{content:H((C==null?void 0:C.description)||"No description available."),title:C==null?void 0:C.title,shardName:y.name,shardIcon:y.id,rarity:((oe=C==null?void 0:C.rarity)==null?void 0:oe.toLowerCase())||y.rarity,family:C==null?void 0:C.family,type:C==null?void 0:C.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${y.id}.png`,alt:y.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(y.rarity)} text-sm truncate`,children:y.name})]})}),e.jsx("span",{className:"flex-shrink-0 text-white text-sm",children:"+"}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(j.quantity),"x"]}),e.jsx(B,{content:H((T==null?void 0:T.description)||"No description available."),title:T==null?void 0:T.title,shardName:R.name,shardIcon:R.id,rarity:((de=T==null?void 0:T.rarity)==null?void 0:de.toLowerCase())||R.rarity,family:T==null?void 0:T.family,type:T==null?void 0:T.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${R.id}.png`,alt:R.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(R.rarity)} text-sm truncate`,children:R.name})]})})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:P})]})})]})}),p&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(ne,{tree:f,data:t,nodeId:`${i}-0`,expandedStates:l,onToggle:n}),e.jsx(ne,{tree:j,data:t,nodeId:`${i}-1`,expandedStates:l,onToggle:n})]})]})},Ve=({result:u,data:t,targetShardName:c,noWoodenBait:d=!1})=>{const[i,l]=I.useState(new Map),[n,m]=I.useState(""),x=(r,a="root")=>{const p=new Map,f=(j,y)=>{j.method==="recipe"&&j.inputs&&(p.set(y,!0),j.inputs.forEach((R,P)=>{f(R,`${y}-${P}`)}))};return f(r,a),p};Y.useEffect(()=>{if(u.tree){const r=JSON.stringify(u.tree);if(r!==n){const a=x(u.tree);l(a),m(r)}}},[u.tree,n]);const h=()=>{const r=new Map(i);for(const a of r.keys())r.set(a,!0);l(r)},s=()=>{const r=new Map(i);for(const a of r.keys())r.set(a,!1);l(r)},o=r=>{const a=new Map(i);a.set(r,!a.get(r)),l(a)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:Math.floor(u.totalShardsProduced)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[u.totalFusions,"x",u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:G(u.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2.5 flex-wrap items-start sm:items-center sm:justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"flex gap-2",children:[!d&&(()=>{const r=Array.from(u.totalQuantities).filter(([f])=>{var j,y;return["shinyfish","inferno koi","abyssal lanternfish","silentdepth"].includes((y=(j=t.shards[f])==null?void 0:j.name)==null?void 0:y.toLowerCase())});if(r.length===0)return null;const a=r.reduce((f,[j,y])=>{var _,v;const P=((v=(_=t.shards[j])==null?void 0:_.name)==null?void 0:v.toLowerCase())==="shinyfish"?512:1024;return f+y*P},0),p=f=>f>=1e9?(f/1e9).toFixed(1).replace(/\.0$/,"")+"b":f>=1e6?(f/1e6).toFixed(1).replace(/\.0$/,"")+"m":f>=1e3?(f/1e3).toFixed(1).replace(/\.0$/,"")+"k":f.toString();return e.jsxs("div",{className:"flex gap-1 items-center px-3 py-1.5 bg-fuchsia-500/20 border border-fuchsia-500/30 text-fuchsia-400 text-sm font-medium rounded-md min-w-0",children:[e.jsx("span",{className:"text-slate-300",children:p(a)}),e.jsx("span",{className:"truncate",children:"Forest Essence"})]})})(),e.jsxs("div",{className:"px-3 py-1.5 flex gap-1 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md min-w-0",children:[e.jsxs("span",{className:"text-slate-300",children:[Math.floor(u.totalShardsProduced),"x"]}),e.jsx("span",{className:"truncate",children:c}),e.jsxs("span",{className:"text-slate-400 whitespace-nowrap",children:[Math.floor(u.craftsNeeded)," craft",Math.floor(u.craftsNeeded)>1?"s":""]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(u.totalQuantities).map(([r,a])=>{var R;const p=t.shards[r],f=a,j=f/p.rate,y=K[p.id];return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[f,"x"]}),e.jsx(B,{content:H((y==null?void 0:y.description)||"No description available."),title:y==null?void 0:y.title,shardName:p.name,shardIcon:p.id,rarity:((R=y==null?void 0:y.rarity)==null?void 0:R.toLowerCase())||p.rarity,family:y==null?void 0:y.family,type:y==null?void 0:y.type,className:"cursor-pointer",children:e.jsxs("span",{className:`mt-0 font-medium text-sm ${U(p.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${p.id}.png`,alt:p.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),p.name]})})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[D(p.rate)," ",e.jsx("span",{className:"text-slate-500 font-bold",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:G(j)})]})]},r)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(be,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-fit",children:e.jsx(ne,{tree:u.tree,data:t,isTopLevel:!0,totalShardsProduced:u.totalShardsProduced,nodeId:"root",expandedStates:i,onToggle:o})})})]})]})},J=class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}parseData(t){return A(this,null,function*(){var c,d;try{const[i,l]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),n=yield i.json(),m=yield l.json(),x={};for(const s in n.recipes){x[s]=[];for(const o in n.recipes[s]){const r=parseInt(o);n.recipes[s][o].forEach(p=>{const f=p.some(j=>n.shards[j].family.includes("Reptile"));x[s].push({inputs:p,outputQuantity:r,isReptile:f})})}}const h={};for(const s in n.shards){let o=(d=(c=t.customRates[s])!=null?c:m[s])!=null?d:0;if(s==="L15"&&o===0){const r=t.moneyPerHour==null?1/0:t.moneyPerHour;o=this.calculateKuudraRate(t.kuudraTier,r)}o>0&&(t.noWoodenBait&&Me.includes(s)&&(o*=.2),Pe.includes(s)||(o=this.applyFortuneModifiers(o,s,n.shards[s],t))),t.excludeChameleon&&s==="L4"&&(o=0),h[s]=z(W({},n.shards[s]),{id:s,rate:o})}return{recipes:x,shards:h}}catch(i){throw new Error(`Failed to parse data: ${i}`)}})}calculateKuudraRate(t,c){const i={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!i)return 0;let l;return c===1/0?l=0:c===0?l=1e12:l=i.cost/c*3600,i.multiplier*(3600/(i.baseTime+l))}applyFortuneModifiers(t,c,d,i){let l=i.hunterFortune;const n=1+5*i.tiamatLevel/100,m=1+2*i.seaSerpentLevel/100*n,x=2*i.pythonLevel/100*m,h=i.kingCobraLevel/100*m;switch(d.rarity){case"common":l+=2*i.newtLevel;break;case"uncommon":l+=2*i.salamanderLevel;break;case"rare":l+=i.lizardKingLevel;break;case"epic":l+=i.leviathanLevel;break}return i.frogPet&&(t*=1.1),c in ye&&(ye[c]&&(t*=1+x),l*=1+h),t*(1+l/100)}computeMinCosts(t,c,d,i){const l=new Map,n=new Map,m=Object.keys(t.shards),x=1+5*i/100,h=1+2*d/100*x,s=1+2*c/100*h,o=.8/3600;m.forEach(a=>{const p=t.shards[a].rate>0?1/t.shards[a].rate:1/0;l.set(a,p),n.set(a,{recipe:null})});let r=!0;for(;r;)r=!1,m.forEach(a=>{(t.recipes[a]||[]).forEach(f=>{const[j,y]=f.inputs,R=t.shards[j].fuse_amount,P=t.shards[y].fuse_amount,_=l.get(j)*R,v=l.get(y)*P,C=_+v+o,T=f.isReptile?f.outputQuantity*s:f.outputQuantity,V=C/T;V<l.get(a)&&(l.set(a,V),n.set(a,{recipe:f}),r=!0)})});return{minCosts:l,choices:n}}findCycleNodes(t){const c=new Map;for(const[s,o]of t)o.recipe&&c.set(s,o.recipe.inputs);let d=0;const i=new Map,l=new Map,n=new Map,m=[],x=[],h=s=>{var r;i.set(s,d),l.set(s,d),d++,m.push(s),n.set(s,!0);const o=c.get(s)||[];for(const a of o)c.has(a)&&(i.has(a)?n.get(a)&&l.set(s,Math.min(l.get(s),i.get(a))):(h(a),l.set(s,Math.min(l.get(s),l.get(a)))));if(l.get(s)===i.get(s)){const a=[];let p;do p=m.pop(),n.set(p,!1),a.push(p);while(p!==s);(a.length>1||a.length===1&&((r=c.get(s))!=null&&r.includes(s)))&&x.push(a)}};for(const s of c.keys())i.has(s)||h(s);return x}buildCycle(t,c,d){const i=[];for(const l of d)if(l.includes(t)){const n=[];for(const m of l){const x=c.get(m);x!=null&&x.recipe&&n.push({outputShard:m,recipe:x.recipe})}i.push(n)}return i}buildRecipeTree(t,c,d,i){if(i.flat().includes(c)){const n=this.buildCycle(c,d,i),{minCosts:m,choices:x}=this.computeMinCosts(t,0,0,0),h=i.flat().reduce((r,a)=>m.get(a)<m.get(r)?a:r,i.flat()[0]),s=this.buildRecipeTree(t,h,x,[]),o={total:0};return this.assignQuantities(s,t.shards[h].fuse_amount,t,o,x,1),{shard:c,method:"cycle",quantity:0,cycles:n.map(r=>({steps:r,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0,inputRecipe:s}}const l=d.get(c);if(l.recipe===null)return{shard:c,method:"direct",quantity:0};{const n=l.recipe,[m,x]=n.inputs,h=this.buildRecipeTree(t,m,d,i),s=this.buildRecipeTree(t,x,d,i);return i.flat().includes(c)?{shard:c,method:"cycleNode",recipe:n,inputs:[h,s],quantity:0,craftsNeeded:0}:{shard:c,method:"recipe",recipe:n,inputs:[h,s],quantity:0,craftsNeeded:0}}}assignQuantities(t,c,d,i,l,n){switch(t.quantity=c,t.method){case"recipe":{const m=t.recipe,x=m.isReptile?m.outputQuantity*n:m.outputQuantity,h=Math.ceil(c/x);t.craftsNeeded=h,i.total+=h;const[s,o]=m.inputs,r=d.shards[s].fuse_amount,a=d.shards[o].fuse_amount,p=h*r,f=h*a;this.assignQuantities(t.inputs[0],p,d,i,l,n),this.assignQuantities(t.inputs[1],f,d,i,l,n);break}case"cycleNode":{const m=t.recipe,x=m.isReptile?m.outputQuantity*n:m.outputQuantity,h=Math.ceil(c/x);t.craftsNeeded=h,i.total+=h;const[s,o]=m.inputs,r=d.shards[s].fuse_amount,a=d.shards[o].fuse_amount;this.assignQuantities(t.inputs[0],r,d,i,l,n),this.assignQuantities(t.inputs[1],a,d,i,l,n);break}case"cycle":for(const m of t.cycles){const x=m.steps.find(f=>f.outputShard===t.shard);if(!x)continue;const h=x.recipe,s=h.outputQuantity,o=h.isReptile?s*n:s;let r=0;m.steps.forEach(f=>{f.recipe.inputs.forEach(j=>{if(j===t.shard){const y=d.shards[j];r+=y.fuse_amount}})});const a=2*(o-r),p=a>0?Math.ceil(c/a):Math.ceil(c/o);m.expectedCrafts=p,m.expectedOutput=o,m.baseOutput=s,m.multiplier=n,i.total+=p*m.steps.length}if(t.craftsNeeded=t.cycles.reduce((m,x)=>m+(x.expectedCrafts||0),0),t.cycles.length>0){const m=t.cycles[0].expectedCrafts,x=new Map;t.cycles[0].steps.forEach(s=>{s.recipe.inputs.forEach(o=>{const r=d.shards[o],a=x.get(o)||0;x.set(o,a+r.fuse_amount)})});const h=new Set(t.cycles[0].steps.map(s=>s.outputShard));x.forEach((s,o)=>{if(!h.has(o)){const r=s*m,a=l.get(o);if(a&&a.recipe){const p=this.buildRecipeTree(d,o,l,[]);this.assignQuantities(p,r,d,i,l,n)}}})}break}}collectTotalQuantities(t,c){const d=new Map,i=l=>{switch(l.method){case"direct":d.set(l.shard,(d.get(l.shard)||0)+l.quantity);break;case"recipe":case"cycleNode":l.inputs.forEach(i);break;case"cycle":if(l.cycles.length>0){for(const n of l.cycles){const x=l.cycles[0].expectedCrafts,h=new Map;n.steps.forEach(s=>{const[o,r]=s.recipe.inputs,a=c.shards[o].fuse_amount,p=c.shards[r].fuse_amount;c.shards[o].family.includes("Reptile")||h.set(o,(h.get(o)||0)+x*a),c.shards[r].family.includes("Reptile")||h.set(r,(h.get(r)||0)+x*p)}),h.forEach((s,o)=>{d.set(o,(d.get(o)||0)+s)})}i(l.inputRecipe)}break}};return i(t),d}calculateOptimalPath(t,c,d){return A(this,null,function*(){var _;const i=yield this.parseData(d);if(!i.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:l,choices:n}=this.computeMinCosts(i,d.crocodileLevel,d.seaSerpentLevel,d.tiamatLevel),m=d.crocodileLevel>0?this.findCycleNodes(n):[],x=this.buildRecipeTree(i,t,n,m),h={total:0},s=1+5*d.tiamatLevel/100,o=1+2*d.seaSerpentLevel/100*s,r=1+2*d.crocodileLevel/100*o;this.assignQuantities(x,c,i,h,n,r);const a=this.collectTotalQuantities(x,i);let p=c,f=1;const j=n.get(t);if(j!=null&&j.recipe){const v=j.recipe.isReptile?j.recipe.outputQuantity*r:j.recipe.outputQuantity;f=Math.ceil(c/v),p=f*v}const y=(_=l.get(t))!=null?_:0,R=y*p,P=h.total*.8/3600;return{timePerShard:y,totalTime:R,totalShardsProduced:p,craftsNeeded:f,totalQuantities:a,totalFusions:h.total,craftTime:P,tree:x}})}};pe(J,"instance");let ee=J;const Ne=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:ee},Symbol.toStringTag,{value:"Module"})),Je=()=>{const[u,t]=I.useState(null),[c,d]=I.useState(!1),[i,l]=I.useState(null),n=I.useCallback((x,h,s)=>A(null,null,function*(){try{d(!0),l(null);const r=yield ee.getInstance().calculateOptimalPath(x,h,s);t(r)}catch(o){l(o instanceof Error?o.message:"Calculation failed"),t(null)}finally{d(!1)}}),[]),m=I.useCallback(()=>{t(null),l(null)},[]);return{result:u,loading:c,error:i,calculate:n,clearResult:m}},Xe=({onSubmit:u})=>{const{setForm:t}=ie();return e.jsx(Ue,{onSubmit:c=>u(c,t)})},Ze=()=>{const{result:u,setResult:t,calculationData:c,setCalculationData:d,targetShardName:i,setTargetShardName:l,form:n}=ie(),{loading:m,error:x}=Je(),{customRates:h}=Ae(),[s,o]=I.useState(!1),r=(a,p)=>A(null,null,function*(){p(a);try{if(!a.shard||a.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}const y=(yield ae.getInstance().getShardNameToKeyMap())[a.shard.toLowerCase()];if(!y){console.warn(`Calculation skipped: Shard "${a.shard}" not found in data`);return}l(a.shard);const P={customRates:Object.fromEntries(Object.entries(h).filter(([,V])=>V!==void 0)),hunterFortune:a.hunterFortune,excludeChameleon:a.excludeChameleon,frogPet:a.frogPet,newtLevel:a.newtLevel,salamanderLevel:a.salamanderLevel,lizardKingLevel:a.lizardKingLevel,leviathanLevel:a.leviathanLevel,pythonLevel:a.pythonLevel,kingCobraLevel:a.kingCobraLevel,seaSerpentLevel:a.seaSerpentLevel,tiamatLevel:a.tiamatLevel,crocodileLevel:a.crocodileLevel,kuudraTier:a.kuudraTier,moneyPerHour:a.moneyPerHour,noWoodenBait:a.noWoodenBait},v=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),C=yield v.calculateOptimalPath(y,a.quantity,P);t(C);const T=yield v.parseData(P);d(T)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return I.useEffect(()=>{n&&n.shard&&n.shard.trim()!==""&&A(null,null,function*(){try{const f=(yield ae.getInstance().getShardNameToKeyMap())[n.shard.toLowerCase()];if(!f)return;l(n.shard);const y={customRates:Object.fromEntries(Object.entries(h).filter(([,C])=>C!==void 0)),hunterFortune:n.hunterFortune,excludeChameleon:n.excludeChameleon,frogPet:n.frogPet,newtLevel:n.newtLevel,salamanderLevel:n.salamanderLevel,lizardKingLevel:n.lizardKingLevel,leviathanLevel:n.leviathanLevel,pythonLevel:n.pythonLevel,kingCobraLevel:n.kingCobraLevel,seaSerpentLevel:n.seaSerpentLevel,tiamatLevel:n.tiamatLevel,crocodileLevel:n.crocodileLevel,kuudraTier:n.kuudraTier,moneyPerHour:n.moneyPerHour,noWoodenBait:n.noWoodenBait},P=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),_=yield P.calculateOptimalPath(f,n.quantity,y);t(_);const v=yield P.parseData(y);d(v)}catch(a){a instanceof Error&&!a.message.includes("not found")&&console.error("Calculation failed (customRates effect):",a)}})},[h,n,t,d,l]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>o(!s),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm cursor-pointer
              `,children:[s?e.jsx(We,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[s?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${s?"block not-xl:mt-3":"hidden xl:block"}`,children:e.jsx(Xe,{onSubmit:r})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ze,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),u&&c&&e.jsx(Ve,{result:u,data:c,targetShardName:i,noWoodenBait:n==null?void 0:n.noWoodenBait}),!u&&!m&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},it=()=>e.jsx(Ze,{});export{it as CalculatorPage};
