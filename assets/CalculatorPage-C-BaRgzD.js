var Z=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var I=(i,t,s)=>t in i?Z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,y=(i,t)=>{for(var s in t||(t={}))ee.call(t,s)&&I(i,s,t[s]);if(_)for(var s of _(t))te.call(t,s)&&I(i,s,t[s]);return i},w=(i,t)=>G(i,Y(t));var A=(i,t,s)=>I(i,typeof t!="symbol"?t+"":t,s);var C=(i,t,s)=>new Promise((u,n)=>{var d=m=>{try{o(s.next(m))}catch(a){n(a)}},h=m=>{try{o(s.throw(m))}catch(a){n(a)}},o=m=>m.done?u(m.value):Promise.resolve(m.value).then(d,h);o((s=s.apply(i,t)).next())});import{d as se,j as e,S as ae,u as O,P as re,K as ne,M as E,g as q,a as R,f as D,b as P,W as le,N as ie,B,_ as ce}from"./index-D9z8FUln.js";import{r as p,R as U}from"./vendor-e8ACzjHW.js";import{D as H,u as oe}from"./useCustomRates-DYOjOmUZ.js";import{b as de,X as V,S as ue,Z as me,R as he,a as xe,c as pe,d as fe,T as be,e as z,H as W,M as $,f as ge}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";const ve=({value:i,onChange:t,onSelect:s,placeholder:u="Search for a shard...",className:n=""})=>{const[d,h]=p.useState([]),[o,m]=p.useState(!1),[a,l]=p.useState(-1),[r,c]=p.useState(!1),[x,f]=p.useState(!1),v=p.useRef(null),N=p.useRef(null),g=p.useRef(null),S=p.useMemo(()=>se(b=>C(null,null,function*(){if(b.length===0||r){h([]),m(!1),f(!1);return}f(!0);try{const L=yield H.getInstance().searchShards(b);h(L.slice(0,10)),m(L.length>0),l(-1)}catch(j){console.error("Search failed:",j),h([]),m(!1)}finally{f(!1)}}),100),[r]),M=p.useCallback(b=>{const j=b.target.value;c(!1),t(j),g.current&&clearTimeout(g.current),S(j)},[t,S]),T=p.useCallback(b=>{c(!0),m(!1),h([]),l(-1),t(b.name),s(b),g.current&&clearTimeout(g.current),setTimeout(()=>{c(!1),v.current&&v.current.blur()},50)},[t,s]),K=p.useCallback(b=>{if(!(!o||d.length===0||r))switch(b.key){case"ArrowDown":b.preventDefault(),l(j=>(j+1)%d.length);break;case"ArrowUp":b.preventDefault(),l(j=>j<=0?d.length-1:j-1);break;case"Enter":b.preventDefault(),a>=0&&a<d.length?T(d[a]):d.length===1&&T(d[0]);break;case"Escape":m(!1),l(-1);break}},[o,d,r,a,T]),J=p.useCallback(()=>{var b;c(!1),t(""),h([]),m(!1),l(-1),g.current&&clearTimeout(g.current),(b=v.current)==null||b.focus()},[t]),X=p.useCallback(()=>{r||i.trim()&&S(i)},[r,i,S]);return p.useEffect(()=>{const b=j=>{const L=j.target;v.current&&!v.current.contains(L)&&N.current&&!N.current.contains(L)&&(m(!1),l(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),g.current&&clearTimeout(g.current)}},[]),e.jsxs("div",{className:`relative ${n}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(de,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:v,type:"text",value:i,onChange:M,onKeyDown:K,onFocus:X,placeholder:u,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),i&&e.jsx("button",{onClick:J,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(V,{className:"h-4 w-4"})})]}),o&&d.length>0&&!r&&e.jsx("ul",{ref:N,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:d.map((b,j)=>e.jsx(ae,{shard:b,index:j,focusedIndex:a,onSelect:T,isSelecting:r,setFocusedIndex:l},b.key))})]})},je=({onSubmit:i})=>{const{form:t,setForm:s}=O();U.useEffect(()=>(console.log("[CalculatorForm] Mounted"),()=>{console.log("[CalculatorForm] Unmounted")}),[]);const u=t.shard,n=(a,l)=>{const r=w(y({},t),{[a]:l});s(r),setTimeout(()=>{i(r)},0)},d=a=>{s(w(y({},t),{shard:a.name})),setTimeout(()=>{const l=w(y({},t),{shard:a.name,frogPet:!1});i(l)},100)},h=()=>{const a=w(y({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10});s(a),setTimeout(()=>{i(a)},0)},o=()=>{const a=t.shard,l=t.quantity,r={shard:a,quantity:l,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1};s(r),setTimeout(()=>{i(r)},0)},m=()=>C(null,null,function*(){const a=u;let l;if(!a||a.trim()===""){l=w(y({},t),{quantity:E.common}),s(l),setTimeout(()=>{i(l)},0);return}try{const c=yield H.getInstance().getShardByName(a),x=c&&E[c.rarity]||E.common;l=w(y({},t),{quantity:x}),s(l),setTimeout(()=>{i(l)},0)}catch(r){console.error("Failed to get shard rarity:",r),l=w(y({},t),{quantity:E.common}),s(l),setTimeout(()=>{i(l)},0)}});return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:a=>a.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(ve,{value:t.shard,onChange:a=>n("shard",a),onSelect:d,placeholder:"Search for a shard..."})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:a=>n("quantity",Number(a.target.value)),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),a.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:" "}),e.jsx("button",{type:"button",onClick:m,className:"px-2.5 py-1.5 text-sm font-medium rounded-md bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 border border-emerald-500/20 hover:border-emerald-500/30 transition-colors duration-200 flex items-center justify-center cursor-pointer",children:"Max"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:h,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:o,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:a=>n("hunterFortune",Number(a.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"excludeChameleon",type:"checkbox",checked:t.excludeChameleon,onChange:a=>n("excludeChameleon",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Chameleon"})]}),e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"excludeWoodenBait",type:"checkbox",checked:t.noWoodenBait,onChange:a=>n("noWoodenBait",a.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Wooden Bait"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:a,label:l})=>e.jsx(re,{value:t[a]||0,onChange:r=>n(a,r),label:l},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{value:t.kuudraTier||"t5",onChange:a=>n("kuudraTier",a),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0",value:t.moneyPerHour===0?"":t.moneyPerHour,onChange:a=>n("moneyPerHour",Number(a.target.value)),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),a.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins/hour"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},Q=({tree:i,data:t,isTopLevel:s=!1,totalShardsProduced:u=i.quantity,nodeId:n,expandedStates:d,onToggle:h})=>{var f;const o=t.shards[i.shard],m=(f=d.get(n))!=null?f:!0;if(i.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[i.quantity,"x"]}),e.jsx("span",{className:`font-medium text-sm ${R(o.rarity)}`,title:q(o,!0),children:o.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-md",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:[D(o.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[o.type," • ",o.family]})]})]});const a=i.inputs[0],l=i.inputs[1],r=t.shards[a.shard],c=t.shards[l.shard],x=s?u:i.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>h(n),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[m?e.jsx(xe,{className:"w-4 h-4 text-slate-400"}):e.jsx(pe,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[x,"x "]}),e.jsx("span",{className:`font-medium ${R(o.rarity)} text-sm`,title:q(o,!1),children:o.name}),e.jsxs("span",{className:"text-slate-400 ml-1.5 text-sm",children:["= ",a.quantity,"x ",e.jsx("span",{className:R(r.rarity),children:r.name})," + ",l.quantity,"x"," ",e.jsx("span",{className:R(c.rarity),children:c.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:`font-medium text-white ${s?"text-sm":"text-xs"}`,children:x})]}),e.jsxs("div",{className:"text-slate-400 capitalize text-xs",children:[o.type," • ",o.family]})]})]})}),m&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(Q,{tree:a,data:t,nodeId:`${n}-0`,expandedStates:d,onToggle:h}),e.jsx(Q,{tree:l,data:t,nodeId:`${n}-1`,expandedStates:d,onToggle:h})]})]})},Ne=({result:i,data:t,targetShardName:s})=>{const[u,n]=p.useState(new Map),[d,h]=p.useState(""),o=(r,c="root")=>{const x=new Map,f=(v,N)=>{v.method==="recipe"&&v.inputs&&(x.set(N,!0),v.inputs.forEach((g,S)=>{f(g,`${N}-${S}`)}))};return f(r,c),x};U.useEffect(()=>{if(i.tree){const r=JSON.stringify(i.tree);if(r!==d){const c=o(i.tree);n(c),h(r)}}},[i.tree,d]);const m=()=>{const r=new Map(u);for(const c of r.keys())r.set(c,!0);n(r)},a=()=>{const r=new Map(u);for(const c of r.keys())r.set(c,!1);n(r)},l=r=>{const c=new Map(u);c.set(r,!c.get(r)),n(c)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:P(i.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:P(i.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:i.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(W,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[i.totalFusions,"x",i.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),i.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:P(i.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(W,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",i.totalShardsProduced," ",s," ",e.jsxs("span",{className:"text-slate-400",children:[i.craftsNeeded," craft",i.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(i.totalQuantities).map(([r,c])=>{const x=t.shards[r],f=c/x.rate;return e.jsx("div",{className:"bg-slate-700 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[c,"x ",e.jsx("span",{className:R(x.rarity),children:x.name})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[D(x.rate),e.jsx("span",{className:"text-slate-600 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs text-slate-400",children:P(f)})})]})},r)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(z,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(Q,{tree:i.tree,data:t,isTopLevel:!0,totalShardsProduced:i.totalShardsProduced,nodeId:"root",expandedStates:u,onToggle:l})})]})]})},k=class k{static getInstance(){return k.instance||(k.instance=new k),k.instance}parseData(t){return C(this,null,function*(){var s,u;try{const[n,d]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),h=yield n.json(),o=yield d.json(),m={};for(const l in h.recipes){m[l]=[];for(const r in h.recipes[l]){const c=parseInt(r);h.recipes[l][r].forEach(f=>{m[l].push({inputs:f,outputQuantity:c})})}}const a={};for(const l in h.shards){let r=(u=(s=t.customRates[l])!=null?s:o[l])!=null?u:0;l==="L15"&&r===0&&(r=this.calculateKuudraRate(t.kuudraTier,t.moneyPerHour)),r>0&&(t.noWoodenBait&&le.includes(l)&&(r*=.05),ie.includes(l)||(r=this.applyFortuneModifiers(r,l,h.shards[l],t))),t.excludeChameleon&&l==="L4"&&(r=0),a[l]=w(y({},h.shards[l]),{id:l,rate:r})}return{recipes:m,shards:a}}catch(n){throw new Error(`Failed to parse data: ${n}`)}})}calculateKuudraRate(t,s){const n={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!n)return 0;const d=s===0?0:n.cost/s*3600;return n.multiplier*(3600/(n.baseTime+d))}applyFortuneModifiers(t,s,u,n){let d=n.hunterFortune;const h=1+5*n.tiamatLevel/100,o=1+2*n.seaSerpentLevel/100*h,m=2*n.pythonLevel/100*o,a=n.kingCobraLevel/100*o;switch(u.rarity){case"common":d+=2*n.newtLevel;break;case"uncommon":d+=2*n.salamanderLevel;break;case"rare":d+=n.lizardKingLevel;break;case"epic":d+=n.leviathanLevel;break}return n.frogPet&&(t*=1.1),s in B&&(B[s]&&(t*=1+m),d*=1+a),t*(1+d/100)}computeMinCosts(t){const s=new Map,u=new Map,n=Object.keys(t.shards),d=.8/3600;n.forEach(o=>{const m=t.shards[o].rate>0?1/t.shards[o].rate:1/0;s.set(o,m),u.set(o,{recipe:null})});let h=!0;for(;h;)h=!1,n.forEach(o=>{(t.recipes[o]||[]).forEach(a=>{const[l,r]=a.inputs,c=t.shards[l].fuse_amount,x=t.shards[r].fuse_amount,f=s.get(l)*c,v=s.get(r)*x,g=(f+v+d)/a.outputQuantity;g<s.get(o)&&(s.set(o,g),u.set(o,{recipe:a}),h=!0)})});return{minCosts:s,choices:u}}buildRecipeTree(t,s){const u=s.get(t);if(u.recipe===null)return{shard:t,method:"direct",quantity:0};{const n=u.recipe,[d,h]=n.inputs,o=this.buildRecipeTree(d,s),m=this.buildRecipeTree(h,s);return{shard:t,method:"recipe",recipe:n,inputs:[o,m],quantity:0}}}assignQuantities(t,s,u,n){if(t.quantity=s,t.method==="recipe"){const d=t.recipe,h=d.outputQuantity,o=Math.ceil(s/h);n.total+=o;const[m,a]=d.inputs,l=u.shards[m].fuse_amount,r=u.shards[a].fuse_amount,c=o*l,x=o*r;this.assignQuantities(t.inputs[0],c,u,n),this.assignQuantities(t.inputs[1],x,u,n)}}collectTotalQuantities(t){const s=new Map,u=n=>{if(n.method==="direct"){const d=s.get(n.shard)||0;s.set(n.shard,d+n.quantity)}else n.inputs.forEach(u)};return u(t),s}decimalHoursToHoursMinutes(t){const s=Math.floor(t),u=Math.round((t-s)*60);return s===0?`${u} minutes`:u===0||isNaN(u)?`${s} hours`:`${s} hours ${u} minutes`}calculateOptimalPath(t,s,u){return C(this,null,function*(){var N;const n=yield this.parseData(u);if(!n.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0,inputs:[]}};const{minCosts:d,choices:h}=this.computeMinCosts(n),o=this.buildRecipeTree(t,h),m={total:0};this.assignQuantities(o,s,n,m);const a=this.collectTotalQuantities(o);let l=s,r=1;const c=h.get(t);if(c!=null&&c.recipe){const g=c.recipe.outputQuantity;r=Math.ceil(s/g),l=r*g}const x=(N=d.get(t))!=null?N:0,f=x*l,v=m.total*.8/3600;return{timePerShard:x,totalTime:f,totalShardsProduced:l,craftsNeeded:r,totalQuantities:a,totalFusions:m.total,craftTime:v,tree:o}})}};A(k,"instance");let F=k;const ye=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:F},Symbol.toStringTag,{value:"Module"})),we=()=>{const[i,t]=p.useState(null),[s,u]=p.useState(!1),[n,d]=p.useState(null),h=p.useCallback((m,a,l)=>C(null,null,function*(){try{u(!0),d(null);const c=yield F.getInstance().calculateOptimalPath(m,a,l);t(c)}catch(r){d(r instanceof Error?r.message:"Calculation failed"),t(null)}finally{u(!1)}}),[]),o=p.useCallback(()=>{t(null),d(null)},[]);return{result:i,loading:s,error:n,calculate:h,clearResult:o}},Se=({onSubmit:i})=>{const{setForm:t}=O();return e.jsx(je,{onSubmit:s=>i(s,t)})},Ce=()=>{const{result:i,setResult:t,calculationData:s,setCalculationData:u,targetShardName:n,setTargetShardName:d}=O(),{loading:h,error:o}=we(),{customRates:m}=oe(),[a,l]=p.useState(!1),r=(c,x)=>C(null,null,function*(){x(c);try{if(!c.shard||c.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}l(!1);const N=(yield H.getInstance().getShardNameToKeyMap())[c.shard.toLowerCase()];if(!N){console.warn(`Calculation skipped: Shard "${c.shard}" not found in data`);return}d(c.shard);const g={customRates:m,hunterFortune:c.hunterFortune,excludeChameleon:c.excludeChameleon,frogPet:c.frogPet,newtLevel:c.newtLevel,salamanderLevel:c.salamanderLevel,lizardKingLevel:c.lizardKingLevel,leviathanLevel:c.leviathanLevel,pythonLevel:c.pythonLevel,kingCobraLevel:c.kingCobraLevel,seaSerpentLevel:c.seaSerpentLevel,tiamatLevel:c.tiamatLevel,kuudraTier:c.kuudraTier,moneyPerHour:c.moneyPerHour,noWoodenBait:c.noWoodenBait},M=(yield ce(()=>Promise.resolve().then(()=>ye),void 0)).CalculationService.getInstance(),T=yield M.calculateOptimalPath(N,c.quantity,g);t(T);const K=yield M.parseData(g);u(K)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>l(!a),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm
              `,children:[a?e.jsx(V,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{children:[a?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${a?"block":"hidden xl:block"}`,children:e.jsx(Se,{onSubmit:r})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[o&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:o})]})]}),i&&s&&e.jsx(Ne,{result:i,data:s,targetShardName:n}),!i&&!h&&!o&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx($,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>l(!0),className:`
                      px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 
                      text-purple-400 font-medium rounded-md 
                      border border-purple-500/20 hover:border-purple-500/30
                      transition-colors duration-200 text-sm
                      flex items-center space-x-2 mx-auto
                    `,children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})},Pe=()=>e.jsx(Ce,{});export{Pe as CalculatorPage};
