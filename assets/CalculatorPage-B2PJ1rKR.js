var we=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var se=(m,t,c)=>t in m?we(m,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):m[t]=c,W=(m,t)=>{for(var c in t||(t={}))Le.call(t,c)&&se(m,c,t[c]);if(he)for(var c of he(t))Re.call(t,c)&&se(m,c,t[c]);return m},z=(m,t)=>ke(m,Ce(t));var pe=(m,t,c)=>se(m,typeof t!="symbol"?t+"":t,c);var B=(m,t,c)=>new Promise((u,l)=>{var n=x=>{try{o(c.next(x))}catch(p){l(p)}},i=x=>{try{o(c.throw(x))}catch(p){l(p)}},o=x=>x.done?u(x.value):Promise.resolve(x.value).then(n,i);o((c=c.apply(m,t)).next())});import{u as ie,j as e,T as H,M as fe,P as Te,f as K,K as Ee,a as D,g as Me,b as U,c as G,W as $e,N as Pe,B as ye,_ as ge}from"./index-PEjkTMSv.js";import{R as Y,r as q}from"./vendor-Dt516RNf.js";import{D as ae,S as I}from"./dataService-BBClzUC4.js";import{S as Se}from"./ShardAutocomplete-dIN7WkFh.js";import{a as Qe,Z as Fe,R as _e,c as Oe,b as He,d as Ke,e as Ie,T as qe,f as be,H as je,X as Ae,M as ve,g as We}from"./icons-DNYyJ9Q2.js";import{u as ze}from"./useCustomRates-Dk0lKvxJ.js";import"./forms-CPIcrlzh.js";function Be(m){return B(this,null,function*(){return!m||typeof m!="string"?!1:!!(yield ae.getInstance().getShardNameToKeyMap())[m.trim().toLowerCase()]})}const Ue=({onSubmit:m})=>{const{form:t,setForm:c,saveEnabled:u,setSaveEnabledState:l}=ie();Y.useEffect(()=>{B(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Be(t.shard))&&m(z(W({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const n=(s,a)=>{const h=z(W({},t),{[s]:a});c(h),s!=="shard"&&s!=="quantity"&&m(h)},i=()=>{const s=z(W({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});c(s),setTimeout(()=>{m(s)},0)},o=()=>{const s=t.shard,a=t.quantity,h={shard:s,quantity:a,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};c(h),r(""),setTimeout(()=>{m(h)},0)};function x(s){if(!s)return 0;const a=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!a)return Number(s.replace(/,/g,""))||0;let h=parseFloat(a[1].replace(/,/g,""));const d=a[2];return d==="k"?h*=1e3:d==="m"?h*=1e6:d==="b"&&(h*=1e9),Math.round(h)}const[p,r]=Y.useState("");Y.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&p===""&&(n("moneyPerHour",1/0),m(z(W({},t),{moneyPerHour:1/0})))},[t.shard]),Y.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&p!==""&&r("")},[t.moneyPerHour]);const f=()=>{t.shard&&n("shard","")};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("label",{htmlFor:"saveSettings",className:"text-xs font-medium text-slate-200 cursor-pointer",children:"Auto Save"}),e.jsx(H,{content:"Automatically saves all your settings (fortune, pet levels, etc.) in your browser. Data is restored when the page reloads."}),e.jsx("button",{type:"button",role:"switch","aria-checked":u,onClick:()=>l(!u),className:`relative inline-flex h-5 w-9 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${u?"bg-emerald-600":"bg-white/5"}
                    hover:border-emerald-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${u?"bg-emerald-400":"bg-slate-300/70"}
                    ${u?"translate-x-4":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]}),e.jsx(Se,{value:t.shard,onChange:s=>n("shard",s),onSelect:s=>{let a="common";if(s&&typeof s.rarity=="string"){const g=s.rarity.toLowerCase();g in fe&&(a=g)}const h=fe[a],d=z(W({},t),{shard:s.name,quantity:h});c(d),setTimeout(()=>m(d),0)},onFocus:f,placeholder:"Search for a shard...",searchMode:"name-only"})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>n("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:i,className:`\r
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 \r
                  text-amber-400 font-medium rounded-md text-xs\r
                  border border-amber-500/20 hover:border-amber-500/30\r
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer\r
                `,children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:o,className:`\r
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 \r
                  text-red-400 font-medium rounded-md text-xs\r
                  border border-red-500/20 hover:border-red-500/30\r
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer\r
                `,children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>n("hunterFortune",Number(s.target.value)),className:`\r
                  w-full px-3 py-2 text-sm\r
                  bg-white/5 border border-white/10 rounded-md\r
                  text-white placeholder-slate-400\r
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50\r
                  transition-colors duration-200\r
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>n("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>n("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt",shardId:"C35"},{key:"salamanderLevel",label:"Salamander",shardId:"U8"},{key:"lizardKingLevel",label:"Lizard King",shardId:"R8"},{key:"leviathanLevel",label:"Leviathan",shardId:"E5"},{key:"pythonLevel",label:"Python",shardId:"R9"},{key:"kingCobraLevel",label:"King Cobra",shardId:"R54"},{key:"seaSerpentLevel",label:"Sea Serpent",shardId:"E32"},{key:"tiamatLevel",label:"Tiamat",shardId:"L6"},{key:"crocodileLevel",label:"Crocodile",shardId:"R45"}].map(({key:s,label:a,shardId:h})=>{var g;const d=I[h];return e.jsx(Te,{value:t[s]||0,onChange:y=>n(s,y),label:a,tooltipTitle:d==null?void 0:d.title,tooltipContent:K((d==null?void 0:d.description)||"No description available."),tooltipShardName:a,tooltipShardIcon:h,tooltipRarity:((g=d==null?void 0:d.rarity)==null?void 0:g.toLowerCase())||"common",tooltipFamily:d==null?void 0:d.family,tooltipType:d==null?void 0:d.type,tooltipWarning:s==="crocodileLevel"?"Warning: May slow calculations significantly":void 0},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ee,{value:t.kuudraTier||"none",onChange:s=>n("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:p,onChange:s=>{if(r(s.target.value),s.target.value.trim()==="")n("moneyPerHour",1/0),m(z(W({},t),{moneyPerHour:1/0}));else{const a=x(s.target.value);n("moneyPerHour",a)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},ne=({tree:m,data:t,isTopLevel:c=!1,totalShardsProduced:u=m.quantity,nodeId:l,expandedStates:n,onToggle:i})=>{var V,re,le,ce,oe,de;const o=t.shards[m.shard],x=M=>{const b=t.recipes[M];if(!(b!=null&&b.length))return null;const j={U8:E=>E.inputs.includes("C35")&&E.inputs.includes("U38"),C35:E=>E.inputs.includes("C23")&&E.inputs.includes("U38")}[M];return j?b.find(j):b.sort((E,w)=>w.outputQuantity-E.outputQuantity)[0]},p=M=>M?e.jsx(He,{className:"w-6 h-6 text-amber-400"}):e.jsx(Ke,{className:"w-6 h-6 text-amber-400"}),r=(M,b,S=!0)=>{var E;const j=I[b.id];return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[M,"x"]}),e.jsx(H,{content:K((j==null?void 0:j.description)||"No description available."),title:j==null?void 0:j.title,shardName:b.name,shardIcon:b.id,rarity:((E=j==null?void 0:j.rarity)==null?void 0:E.toLowerCase())||b.rarity,family:j==null?void 0:j.family,type:j==null?void 0:j.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${b.id}.png`,alt:b.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(b.rarity)} whitespace-nowrap text-sm`,children:b.name})]})}),S&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(b.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]})},f=(M,b,S,j,E,w,$=!1,Q)=>{var A,F,O;const N=I[b.id],k=I[j.id],L=I[w.id];return e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium min-w-0",children:[$&&e.jsxs("span",{className:"font-normal text-sm text-amber-300 flex-shrink-0 mr-2",children:["Step ",Q,":"]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[M,"x"]}),e.jsx(H,{content:K((N==null?void 0:N.description)||"No description available."),title:N==null?void 0:N.title,shardName:b.name,shardIcon:b.id,rarity:((A=N==null?void 0:N.rarity)==null?void 0:A.toLowerCase())||b.rarity,family:N==null?void 0:N.family,type:N==null?void 0:N.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${b.id}.png`,alt:b.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(b.rarity)} whitespace-nowrap text-sm`,children:b.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"="}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[S,"x"]}),e.jsx(H,{content:K((k==null?void 0:k.description)||"No description available."),title:k==null?void 0:k.title,shardName:j.name,shardIcon:j.id,rarity:((F=k==null?void 0:k.rarity)==null?void 0:F.toLowerCase())||j.rarity,family:k==null?void 0:k.family,type:k==null?void 0:k.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${j.id}.png`,alt:j.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(j.rarity)} whitespace-nowrap text-sm`,children:j.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"+"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(H,{content:K((L==null?void 0:L.description)||"No description available."),title:(L==null?void 0:L.title)||w.name,shardName:w.name,shardIcon:w.id,rarity:((O=L==null?void 0:L.rarity)==null?void 0:O.toLowerCase())||w.rarity,family:L==null?void 0:L.family,type:L==null?void 0:L.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${w.id}.png`,alt:w.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(w.rarity)} whitespace-nowrap text-sm`,children:w.name})]})})]})]})},s=(M,b)=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full flex-shrink-0"}),e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2",children:r(M,b,!1)}),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(b.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]}),a=(M,b,S,j=1)=>{var A;const E=M.outputQuantity,w=t.shards[M.inputs[0]],$=t.shards[M.inputs[1]],Q=w.fuse_amount,N=$.fuse_amount,k=`${S}-${b.id}`,L=(A=n.get(k))!=null?A:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(k),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[p(L),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:f(E,b,Q,w,N,$)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:"1"})]})})]}),L&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 flex flex-col gap-0.5",children:M.inputs.map(F=>{const O=t.shards[F];if(!O)return null;const Z=x(F);return F==="C11"||F==="U38"||F==="C23"?e.jsx("div",{children:s(O.fuse_amount,O)},`direct-${F}`):Z&&j<2?e.jsx("div",{children:a(Z,O,k,j+1)},`sub-${F}`):null})})]})};if(m.method==="cycle"){const M=(V=n.get(l))!=null?V:!0,b=Math.ceil(m.quantity/(m.cycles[0].expectedOutput-m.cycles[0].baseOutput));return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors gap-2 sm:gap-8",onClick:()=>i(l),children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[p(M),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"text-sm text-amber-300 flex-shrink-0",children:[b," crafts"]}),e.jsx(Oe,{className:"w-6 text-amber-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[r(Math.floor(m.quantity),o,!1),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-sm font-medium rounded-md flex-shrink-0",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:b})]})})]}),M&&m.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:m.cycles.map((S,j)=>e.jsxs("div",{children:[e.jsx("div",{className:"space-y-0.5",children:[...S.steps].slice().reverse().map((E,w)=>{var Z;const $=E.recipe,Q=t.shards[E.outputShard],N=t.shards[$.inputs[0]],k=t.shards[$.inputs[1]],L=N.fuse_amount,A=k.fuse_amount;let F=$.outputQuantity;$.isReptile&&(F*=S.multiplier);const O=S.steps.length-w;if(O===1){const te=`${l}-step-${O}`,me=(Z=n.get(te))!=null?Z:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(te),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[p(me),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:f(F,Q,L,N,A,k,!0,O)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:S.expectedCrafts})]})})]}),me&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-1",children:$.inputs.map(X=>{const ue=t.shards[X],xe=x(X);return xe&&ue&&X!=="C11"&&X!=="U38"&&X!=="C23"?e.jsx("div",{className:"space-y-1",children:a(xe,ue,l)},X):null})})]},w)}else return e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between gap-2 sm:gap-8",children:[e.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:f(F,Q,L,N,A,k,!0,O)}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:S.expectedCrafts})]})})]},w)})}),(()=>{const E=new Set(S.steps.map($=>$.outputShard)),w={};return S.steps.forEach($=>{$.recipe.inputs.forEach(Q=>{const N=t.shards[Q];!N||E.has(Q)||(w[Q]||(w[Q]={quantity:0,shard:N}),w[Q].quantity+=N.fuse_amount)})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(w).map(({quantity:$,shard:Q})=>e.jsx("div",{children:s($*S.expectedCrafts,Q)},Q.id))})})()]},j))})]})}if(m.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),r(m.quantity,o,!1),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[D(o.rate),e.jsx("span",{className:"text-slate-500 text-xs font-bold mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})})]});const h=(re=n.get(l))!=null?re:!0,d=m.inputs[0],g=m.inputs[1],y=t.shards[d.shard],R=t.shards[g.shard],P="craftsNeeded"in m&&(le=m.craftsNeeded)!=null?le:1,_=c?u:m.quantity,v=I[o.id],C=I[y.id],T=I[R.id];return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>i(l),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-15 sm:gap-8 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 p-0.5 min-w-0 flex-1",children:[p(h),e.jsxs("div",{className:"text-white flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsxs("span",{className:"font-medium text-sm flex-shrink-0",children:[Math.floor(_),"x"]}),e.jsx(H,{content:K((v==null?void 0:v.description)||"No description available."),title:v==null?void 0:v.title,shardName:o.name,shardIcon:o.id,rarity:((ce=v==null?void 0:v.rarity)==null?void 0:ce.toLowerCase())||o.rarity,family:v==null?void 0:v.family,type:v==null?void 0:v.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${o.id}.png`,alt:o.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium ${U(o.rarity)} text-sm truncate`,title:Me(o,!1),children:o.name})]})}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center gap-1 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsx("span",{className:"text-white flex-shrink-0 text-sm",children:"="}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(d.quantity),"x"]}),e.jsx(H,{content:K((C==null?void 0:C.description)||"No description available."),title:C==null?void 0:C.title,shardName:y.name,shardIcon:y.id,rarity:((oe=C==null?void 0:C.rarity)==null?void 0:oe.toLowerCase())||y.rarity,family:C==null?void 0:C.family,type:C==null?void 0:C.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${y.id}.png`,alt:y.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(y.rarity)} text-sm truncate`,children:y.name})]})}),e.jsx("span",{className:"flex-shrink-0 text-white text-sm",children:"+"}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(g.quantity),"x"]}),e.jsx(H,{content:K((T==null?void 0:T.description)||"No description available."),title:T==null?void 0:T.title,shardName:R.name,shardIcon:R.id,rarity:((de=T==null?void 0:T.rarity)==null?void 0:de.toLowerCase())||R.rarity,family:T==null?void 0:T.family,type:T==null?void 0:T.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/shardIcons/${R.id}.png`,alt:R.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(R.rarity)} text-sm truncate`,children:R.name})]})})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:P})]})})]})}),h&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(ne,{tree:d,data:t,nodeId:`${l}-0`,expandedStates:n,onToggle:i}),e.jsx(ne,{tree:g,data:t,nodeId:`${l}-1`,expandedStates:n,onToggle:i})]})]})},Ve=({result:m,data:t,targetShardName:c,noWoodenBait:u=!1})=>{const[l,n]=q.useState(new Map),[i,o]=q.useState(""),x=(s,a="root")=>{const h=new Map,d=(g,y)=>{g.method==="recipe"&&g.inputs&&(h.set(y,!0),g.inputs.forEach((R,P)=>{d(R,`${y}-${P}`)}))};return d(s,a),h};Y.useEffect(()=>{if(m.tree){const s=JSON.stringify(m.tree);if(s!==i){const a=x(m.tree);n(a),o(s)}}},[m.tree,i]);const p=()=>{const s=new Map(l);for(const a of s.keys())s.set(a,!0);n(s)},r=()=>{const s=new Map(l);for(const a of s.keys())s.set(a,!1);n(s)},f=s=>{const a=new Map(l);a.set(s,!a.get(s)),n(a)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(m.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(m.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:Math.floor(m.totalShardsProduced)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[m.totalFusions,"x",m.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),m.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:G(m.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2.5 flex-wrap items-start sm:items-center sm:justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"flex gap-2",children:[!u&&(()=>{const s=Array.from(m.totalQuantities).filter(([d])=>{var g,y;return["shinyfish","inferno koi","abyssal lanternfish","silentdepth"].includes((y=(g=t.shards[d])==null?void 0:g.name)==null?void 0:y.toLowerCase())});if(s.length===0)return null;const a=s.reduce((d,[g,y])=>{var _,v;const P=((v=(_=t.shards[g])==null?void 0:_.name)==null?void 0:v.toLowerCase())==="shinyfish"?512:1024;return d+y*P},0),h=d=>d>=1e9?(d/1e9).toFixed(1).replace(/\.0$/,"")+"b":d>=1e6?(d/1e6).toFixed(1).replace(/\.0$/,"")+"m":d>=1e3?(d/1e3).toFixed(1).replace(/\.0$/,"")+"k":d.toString();return e.jsxs("div",{className:"flex gap-1 items-center px-3 py-1.5 bg-fuchsia-500/20 border border-fuchsia-500/30 text-fuchsia-400 text-sm font-medium rounded-md min-w-0",children:[e.jsx("span",{className:"text-slate-300",children:h(a)}),e.jsx("span",{className:"truncate",children:"Forest Essence"})]})})(),e.jsxs("div",{className:"px-3 py-1.5 flex gap-1 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md min-w-0",children:[e.jsxs("span",{className:"text-slate-300",children:[Math.floor(m.totalShardsProduced),"x"]}),e.jsx("span",{className:"truncate",children:c}),e.jsxs("span",{className:"text-slate-400 whitespace-nowrap",children:[Math.floor(m.craftsNeeded)," craft",Math.floor(m.craftsNeeded)>1?"s":""]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(m.totalQuantities).map(([s,a])=>{var R;const h=t.shards[s],d=a,g=d/h.rate,y=I[h.id];return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[d,"x"]}),e.jsx(H,{content:K((y==null?void 0:y.description)||"No description available."),title:y==null?void 0:y.title,shardName:h.name,shardIcon:h.id,rarity:((R=y==null?void 0:y.rarity)==null?void 0:R.toLowerCase())||h.rarity,family:y==null?void 0:y.family,type:y==null?void 0:y.type,className:"cursor-pointer",children:e.jsxs("span",{className:`mt-0 font-medium text-sm ${U(h.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/shardIcons/${h.id}.png`,alt:h.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),h.name]})})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[D(h.rate)," ",e.jsx("span",{className:"text-slate-500 font-bold",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:G(g)})]})]},s)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(be,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:r,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-fit",children:e.jsx(ne,{tree:m.tree,data:t,isTopLevel:!0,totalShardsProduced:m.totalShardsProduced,nodeId:"root",expandedStates:l,onToggle:f})})})]})]})},J=class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}parseData(t){return B(this,null,function*(){var c,u;try{const[l,n]=yield Promise.all([fetch("/fusion-data.json"),fetch("/rates.json")]),i=yield l.json(),o=yield n.json(),x={};for(const r in i.recipes){x[r]=[];for(const f in i.recipes[r]){const s=parseInt(f);i.recipes[r][f].forEach(h=>{const d=h.some(g=>i.shards[g].family.includes("Reptile"));x[r].push({inputs:h,outputQuantity:s,isReptile:d})})}}const p={};for(const r in i.shards){let f=(u=(c=t.customRates[r])!=null?c:o[r])!=null?u:0;if(r==="L15"&&f===0){const s=t.moneyPerHour==null?1/0:t.moneyPerHour;f=this.calculateKuudraRate(t.kuudraTier,s)}f>0&&(t.noWoodenBait&&$e.includes(r)&&(f*=.2),Pe.includes(r)||(f=this.applyFortuneModifiers(f,r,i.shards[r],t))),t.excludeChameleon&&r==="L4"&&(f=0),p[r]=z(W({},i.shards[r]),{id:r,rate:f})}return{recipes:x,shards:p}}catch(l){throw new Error(`Failed to parse data: ${l}`)}})}calculateKuudraRate(t,c){const l={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!l)return 0;let n;return c===1/0?n=0:c===0?n=1e12:n=l.cost/c*3600,l.multiplier*(3600/(l.baseTime+n))}applyFortuneModifiers(t,c,u,l){let n=l.hunterFortune;const i=1+5*l.tiamatLevel/100,o=1+2*l.seaSerpentLevel/100*i,x=2*l.pythonLevel/100*o,p=l.kingCobraLevel/100*o;switch(u.rarity){case"common":n+=2*l.newtLevel;break;case"uncommon":n+=2*l.salamanderLevel;break;case"rare":n+=l.lizardKingLevel;break;case"epic":n+=l.leviathanLevel;break}return l.frogPet&&(t*=1.1),c in ye&&(ye[c]&&(t*=1+x),n*=1+p),t*(1+n/100)}computeMinCosts(t,c,u,l){const n=new Map,i=new Map,o=Object.keys(t.shards),x=1+5*l/100,p=1+2*u/100*x,r=1+2*c/100*p,f=.8/3600;o.forEach(a=>{const h=t.shards[a].rate>0?1/t.shards[a].rate:1/0;n.set(a,h),i.set(a,{recipe:null})});let s=!0;for(;s;)s=!1,o.forEach(a=>{(t.recipes[a]||[]).forEach(d=>{const[g,y]=d.inputs,R=t.shards[g].fuse_amount,P=t.shards[y].fuse_amount,_=n.get(g)*R,v=n.get(y)*P,C=_+v+f,T=d.isReptile?d.outputQuantity*r:d.outputQuantity,V=C/T;V<n.get(a)&&(n.set(a,V),i.set(a,{recipe:d}),s=!0)})});return{minCosts:n,choices:i}}findCycleNodes(t){const c=new Map;for(const[r,f]of t)f.recipe&&c.set(r,f.recipe.inputs);let u=0;const l=new Map,n=new Map,i=new Map,o=[],x=[],p=r=>{var s;l.set(r,u),n.set(r,u),u++,o.push(r),i.set(r,!0);const f=c.get(r)||[];for(const a of f)c.has(a)&&(l.has(a)?i.get(a)&&n.set(r,Math.min(n.get(r),l.get(a))):(p(a),n.set(r,Math.min(n.get(r),n.get(a)))));if(n.get(r)===l.get(r)){const a=[];let h;do h=o.pop(),i.set(h,!1),a.push(h);while(h!==r);(a.length>1||a.length===1&&((s=c.get(r))!=null&&s.includes(r)))&&x.push(a)}};for(const r of c.keys())l.has(r)||p(r);return x}buildCycle(t,c,u){const l=[];for(const n of u)if(n.includes(t)){const i=[];for(const o of n){const x=c.get(o);x!=null&&x.recipe&&i.push({outputShard:o,recipe:x.recipe})}l.push(i)}return l}buildRecipeTree(t,c,u,l){if(l.flat().includes(c)){const i=this.buildCycle(c,u,l),{minCosts:o,choices:x}=this.computeMinCosts(t,0,0,0),p=l.flat().reduce((s,a)=>o.get(a)<o.get(s)?a:s,l.flat()[0]),r=this.buildRecipeTree(t,p,x,[]),f={total:0};return this.assignQuantities(r,t.shards[p].fuse_amount,t,f,x,1),{shard:c,method:"cycle",quantity:0,cycles:i.map(s=>({steps:s,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0,inputRecipe:r}}const n=u.get(c);if(n.recipe===null)return{shard:c,method:"direct",quantity:0};{const i=n.recipe,[o,x]=i.inputs,p=this.buildRecipeTree(t,o,u,l),r=this.buildRecipeTree(t,x,u,l);return l.flat().includes(c)?{shard:c,method:"cycleNode",recipe:i,inputs:[p,r],quantity:0,craftsNeeded:0}:{shard:c,method:"recipe",recipe:i,inputs:[p,r],quantity:0,craftsNeeded:0}}}assignQuantities(t,c,u,l,n,i){switch(t.quantity=c,t.method){case"recipe":{const o=t.recipe,x=o.isReptile?o.outputQuantity*i:o.outputQuantity,p=Math.ceil(c/x);t.craftsNeeded=p,l.total+=p;const[r,f]=o.inputs,s=u.shards[r].fuse_amount,a=u.shards[f].fuse_amount,h=p*s,d=p*a;this.assignQuantities(t.inputs[0],h,u,l,n,i),this.assignQuantities(t.inputs[1],d,u,l,n,i);break}case"cycleNode":{const o=t.recipe,x=o.isReptile?o.outputQuantity*i:o.outputQuantity,p=Math.ceil(c/x);t.craftsNeeded=p,l.total+=p;const[r,f]=o.inputs,s=u.shards[r].fuse_amount,a=u.shards[f].fuse_amount;this.assignQuantities(t.inputs[0],s,u,l,n,i),this.assignQuantities(t.inputs[1],a,u,l,n,i);break}case"cycle":for(const o of t.cycles){const x=o.steps.find(d=>d.outputShard===t.shard);if(!x)continue;const p=x.recipe,r=p.outputQuantity,f=p.isReptile?r*i:r;let s=0;o.steps.forEach(d=>{d.recipe.inputs.forEach(g=>{if(g===t.shard){const y=u.shards[g];s+=y.fuse_amount}})});const a=2*(f-s),h=a>0?Math.ceil(c/a):Math.ceil(c/f);o.expectedCrafts=h,o.expectedOutput=f,o.baseOutput=r,o.multiplier=i,l.total+=h*o.steps.length}if(t.craftsNeeded=t.cycles.reduce((o,x)=>o+(x.expectedCrafts||0),0),t.cycles.length>0){const o=t.cycles[0].expectedCrafts,x=new Map;t.cycles[0].steps.forEach(r=>{r.recipe.inputs.forEach(f=>{const s=u.shards[f],a=x.get(f)||0;x.set(f,a+s.fuse_amount)})});const p=new Set(t.cycles[0].steps.map(r=>r.outputShard));x.forEach((r,f)=>{if(!p.has(f)){const s=r*o,a=n.get(f);if(a&&a.recipe){const h=this.buildRecipeTree(u,f,n,[]);this.assignQuantities(h,s,u,l,n,i)}}})}break}}collectTotalQuantities(t,c){const u=new Map,l=n=>{switch(n.method){case"direct":u.set(n.shard,(u.get(n.shard)||0)+n.quantity);break;case"recipe":case"cycleNode":n.inputs.forEach(l);break;case"cycle":if(n.cycles.length>0){for(const i of n.cycles){const o=n.cycles[0].expectedCrafts,x=new Map;i.steps.forEach(p=>{const[r,f]=p.recipe.inputs,s=c.shards[r].fuse_amount,a=c.shards[f].fuse_amount;c.shards[r].family.includes("Reptile")||x.set(r,(x.get(r)||0)+o*s),c.shards[f].family.includes("Reptile")||x.set(f,(x.get(f)||0)+o*a)}),x.forEach((p,r)=>{u.set(r,(u.get(r)||0)+p)})}l(n.inputRecipe)}break}};return l(t),u}calculateOptimalPath(t,c,u){return B(this,null,function*(){var _;const l=yield this.parseData(u);if(!l.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:n,choices:i}=this.computeMinCosts(l,u.crocodileLevel,u.seaSerpentLevel,u.tiamatLevel),o=u.crocodileLevel>0?this.findCycleNodes(i):[],x=this.buildRecipeTree(l,t,i,o),p={total:0},r=1+5*u.tiamatLevel/100,f=1+2*u.seaSerpentLevel/100*r,s=1+2*u.crocodileLevel/100*f;this.assignQuantities(x,c,l,p,i,s);const a=this.collectTotalQuantities(x,l);let h=c,d=1;const g=i.get(t);if(g!=null&&g.recipe){const v=g.recipe.isReptile?g.recipe.outputQuantity*s:g.recipe.outputQuantity;d=Math.ceil(c/v),h=d*v}const y=(_=n.get(t))!=null?_:0,R=y*h,P=p.total*.8/3600;return{timePerShard:y,totalTime:R,totalShardsProduced:h,craftsNeeded:d,totalQuantities:a,totalFusions:p.total,craftTime:P,tree:x}})}};pe(J,"instance");let ee=J;const Ne=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:ee},Symbol.toStringTag,{value:"Module"})),Je=()=>{const[m,t]=q.useState(null),[c,u]=q.useState(!1),[l,n]=q.useState(null),i=q.useCallback((x,p,r)=>B(null,null,function*(){try{u(!0),n(null);const s=yield ee.getInstance().calculateOptimalPath(x,p,r);t(s)}catch(f){n(f instanceof Error?f.message:"Calculation failed"),t(null)}finally{u(!1)}}),[]),o=q.useCallback(()=>{t(null),n(null)},[]);return{result:m,loading:c,error:l,calculate:i,clearResult:o}},Xe=({onSubmit:m})=>{const{setForm:t}=ie();return e.jsx(Ue,{onSubmit:c=>m(c,t)})},Ze=()=>{const{result:m,setResult:t,calculationData:c,setCalculationData:u,targetShardName:l,setTargetShardName:n,form:i}=ie(),{loading:o,error:x}=Je(),{customRates:p}=ze(),[r,f]=q.useState(!1),s=(a,h)=>B(null,null,function*(){h(a);try{if(!a.shard||a.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}const y=(yield ae.getInstance().getShardNameToKeyMap())[a.shard.toLowerCase()];if(!y){console.warn(`Calculation skipped: Shard "${a.shard}" not found in data`);return}n(a.shard);const P={customRates:Object.fromEntries(Object.entries(p).filter(([,V])=>V!==void 0)),hunterFortune:a.hunterFortune,excludeChameleon:a.excludeChameleon,frogPet:a.frogPet,newtLevel:a.newtLevel,salamanderLevel:a.salamanderLevel,lizardKingLevel:a.lizardKingLevel,leviathanLevel:a.leviathanLevel,pythonLevel:a.pythonLevel,kingCobraLevel:a.kingCobraLevel,seaSerpentLevel:a.seaSerpentLevel,tiamatLevel:a.tiamatLevel,crocodileLevel:a.crocodileLevel,kuudraTier:a.kuudraTier,moneyPerHour:a.moneyPerHour,noWoodenBait:a.noWoodenBait},v=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),C=yield v.calculateOptimalPath(y,a.quantity,P);t(C);const T=yield v.parseData(P);u(T)}catch(d){d instanceof Error&&!d.message.includes("not found")&&console.error("Calculation failed:",d)}});return q.useEffect(()=>{i&&i.shard&&i.shard.trim()!==""&&B(null,null,function*(){try{const d=(yield ae.getInstance().getShardNameToKeyMap())[i.shard.toLowerCase()];if(!d)return;n(i.shard);const y={customRates:Object.fromEntries(Object.entries(p).filter(([,C])=>C!==void 0)),hunterFortune:i.hunterFortune,excludeChameleon:i.excludeChameleon,frogPet:i.frogPet,newtLevel:i.newtLevel,salamanderLevel:i.salamanderLevel,lizardKingLevel:i.lizardKingLevel,leviathanLevel:i.leviathanLevel,pythonLevel:i.pythonLevel,kingCobraLevel:i.kingCobraLevel,seaSerpentLevel:i.seaSerpentLevel,tiamatLevel:i.tiamatLevel,crocodileLevel:i.crocodileLevel,kuudraTier:i.kuudraTier,moneyPerHour:i.moneyPerHour,noWoodenBait:i.noWoodenBait},P=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),_=yield P.calculateOptimalPath(d,i.quantity,y);t(_);const v=yield P.parseData(y);u(v)}catch(a){a instanceof Error&&!a.message.includes("not found")&&console.error("Calculation failed (customRates effect):",a)}})},[p,i,t,u,n]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>f(!r),className:`\r
                w-full px-3 py-2.5 \r
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30\r
                rounded-md text-white hover:bg-purple-500/20 \r
                flex items-center justify-center space-x-2 \r
                transition-colors duration-200 font-medium text-sm cursor-pointer\r
              `,children:[r?e.jsx(Ae,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[r?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${r?"block not-xl:mt-3":"hidden xl:block"}`,children:e.jsx(Xe,{onSubmit:s})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(We,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),m&&c&&e.jsx(Ve,{result:m,data:c,targetShardName:l,noWoodenBait:i==null?void 0:i.noWoodenBait}),!m&&!o&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},it=()=>e.jsx(Ze,{});export{it as CalculatorPage};
