var I=(f,l,d)=>new Promise((x,g)=>{var y=n=>{try{r(d.next(n))}catch(h){g(h)}},S=n=>{try{r(d.throw(n))}catch(h){g(h)}},r=n=>n.done?x(n.value):Promise.resolve(n.value).then(y,S);r((d=d.apply(f,l)).next())});import{e as W,j as a,k as F}from"./index-Bl6oh72E.js";import{r as s}from"./vendor-Dt516RNf.js";import{D as K}from"./dataService-DsdNQdBP.js";import{h as L,X as $}from"./icons-DNYyJ9Q2.js";const G=({value:f,onChange:l,onSelect:d,onFocus:x,placeholder:g="Search for a shard...",className:y="",searchMode:S="enhanced"})=>{const[r,n]=s.useState([]),[h,m]=s.useState(!1),[p,c]=s.useState(-1),[o,w]=s.useState(!1),[C,j]=s.useState(!1),[D,E]=s.useState(void 0),u=s.useRef(null),N=s.useRef(null),i=s.useRef(null),k=s.useMemo(()=>W(e=>I(null,null,function*(){if(e.length===0||o){n([]),m(!1),j(!1);return}j(!0);try{const t=K.getInstance(),b=S==="name-only"?yield t.searchShardsByNameOnly(e):yield t.searchShards(e);n(b.slice(0,10)),m(b.length>0),c(-1)}catch(t){console.error("Search failed:",t),n([]),m(!1)}finally{j(!1)}}),100),[o,S]),R=s.useCallback(e=>{const t=e.target.value;w(!1),l(t),i.current&&clearTimeout(i.current),k(t)},[l,k]),v=s.useCallback(e=>{w(!0),m(!1),n([]),c(-1),l(e.name),d(e),i.current&&clearTimeout(i.current),setTimeout(()=>{w(!1),u.current&&u.current.blur()},50)},[l,d]),T=s.useCallback(e=>{if(!(!h||r.length===0||o))switch(e.key){case"ArrowDown":e.preventDefault(),c(t=>(t+1)%r.length);break;case"ArrowUp":e.preventDefault(),c(t=>t<=0?r.length-1:t-1);break;case"Enter":e.preventDefault(),p>=0&&p<r.length?v(r[p]):r.length===1&&v(r[0]);break;case"Escape":m(!1),c(-1);break}},[h,r,o,p,v]),O=s.useCallback(()=>{var e;w(!1),l(""),n([]),m(!1),c(-1),i.current&&clearTimeout(i.current),(e=u.current)==null||e.focus()},[l]),A=s.useCallback(()=>{o||(u.current&&E(u.current.offsetWidth),f.trim()&&k(f))},[o,f,k]);return s.useEffect(()=>{const e=t=>{const b=t.target;u.current&&!u.current.contains(b)&&N.current&&!N.current.contains(b)&&(m(!1),c(-1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e),i.current&&clearTimeout(i.current)}},[]),a.jsxs("div",{className:`relative ${y}`,children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:C?a.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):a.jsx(L,{className:"h-4 w-4 text-slate-400"})}),a.jsx("input",{ref:u,type:"text",value:f,onChange:R,onKeyDown:T,onFocus:()=>{x&&x(),A()},placeholder:g,className:"w-full pl-10 pr-10 py-2.5 bg-slate-700/50 border border-slate-600/50 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 hover:bg-slate-700/70 transition-colors",autoComplete:"off",spellCheck:!1}),f&&a.jsx("button",{onClick:O,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:a.jsx($,{className:"h-4 w-4"})})]}),h&&r.length>0&&!o&&a.jsx("ul",{ref:N,className:"absolute z-50 mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",style:{width:D?`${D}px`:"100%"},children:r.map((e,t)=>a.jsx(F,{shard:e,index:t,focusedIndex:p,onSelect:v,isSelecting:o,setFocusedIndex:c},e.key))})]})};export{G as S};
