var Z=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var $=(n,t,a)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,k=(n,t)=>{for(var a in t||(t={}))ee.call(t,a)&&$(n,a,t[a]);if(H)for(var a of H(t))te.call(t,a)&&$(n,a,t[a]);return n},L=(n,t)=>G(n,Y(t));var _=(n,t,a)=>$(n,typeof t!="symbol"?t+"":t,a);var y=(n,t,a)=>new Promise((o,l)=>{var m=u=>{try{r(a.next(u))}catch(h){l(h)}},s=u=>{try{r(a.throw(u))}catch(h){l(h)}},r=u=>u.done?o(u.value):Promise.resolve(u.value).then(m,s);r((a=a.apply(n,t)).next())});import{d as se,j as e,S as ae,u as O,M as q,P as ne,K as re,g as B,a as R,f as U,b as M,W as le,N as ie,B as W,_ as ce}from"./index-DPrHVE9S.js";import{r as p,R as K}from"./vendor-e8ACzjHW.js";import{D as Q,u as oe}from"./useCustomRates--fFrVg9p.js";import{b as de,X as V,S as ue,Z as me,R as he,a as xe,c as pe,d as fe,T as be,e as z,H as D,M as I,f as ge}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";function je(n){return y(this,null,function*(){return!n||typeof n!="string"?!1:!!(yield Q.getInstance().getShardNameToKeyMap())[n.trim().toLowerCase()]})}const ve=({value:n,onChange:t,onSelect:a,placeholder:o="Search for a shard...",className:l=""})=>{const[m,s]=p.useState([]),[r,u]=p.useState(!1),[h,d]=p.useState(-1),[i,c]=p.useState(!1),[x,f]=p.useState(!1),j=p.useRef(null),N=p.useRef(null),g=p.useRef(null),w=p.useMemo(()=>se(b=>y(null,null,function*(){if(b.length===0||i){s([]),u(!1),f(!1);return}f(!0);try{const T=yield Q.getInstance().searchShards(b);s(T.slice(0,10)),u(T.length>0),d(-1)}catch(v){console.error("Search failed:",v),s([]),u(!1)}finally{f(!1)}}),100),[i]),E=p.useCallback(b=>{const v=b.target.value;c(!1),t(v),g.current&&clearTimeout(g.current),w(v)},[t,w]),C=p.useCallback(b=>{c(!0),u(!1),s([]),d(-1),t(b.name),a(b),g.current&&clearTimeout(g.current),setTimeout(()=>{c(!1),j.current&&j.current.blur()},50)},[t,a]),F=p.useCallback(b=>{if(!(!r||m.length===0||i))switch(b.key){case"ArrowDown":b.preventDefault(),d(v=>(v+1)%m.length);break;case"ArrowUp":b.preventDefault(),d(v=>v<=0?m.length-1:v-1);break;case"Enter":b.preventDefault(),h>=0&&h<m.length?C(m[h]):m.length===1&&C(m[0]);break;case"Escape":u(!1),d(-1);break}},[r,m,i,h,C]),J=p.useCallback(()=>{var b;c(!1),t(""),s([]),u(!1),d(-1),g.current&&clearTimeout(g.current),(b=j.current)==null||b.focus()},[t]),X=p.useCallback(()=>{i||n.trim()&&w(n)},[i,n,w]);return p.useEffect(()=>{const b=v=>{const T=v.target;j.current&&!j.current.contains(T)&&N.current&&!N.current.contains(T)&&(u(!1),d(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),g.current&&clearTimeout(g.current)}},[]),e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(de,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:j,type:"text",value:n,onChange:E,onKeyDown:F,onFocus:X,placeholder:o,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),n&&e.jsx("button",{onClick:J,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(V,{className:"h-4 w-4"})})]}),r&&m.length>0&&!i&&e.jsx("ul",{ref:N,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:m.map((b,v)=>e.jsx(ae,{shard:b,index:v,focusedIndex:h,onSelect:C,isSelecting:i,setFocusedIndex:d},b.key))})]})},Ne=({onSubmit:n})=>{const{form:t,setForm:a}=O();K.useEffect(()=>(console.log("[CalculatorForm] Mounted"),()=>{console.log("[CalculatorForm] Unmounted")}),[]),K.useEffect(()=>{y(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield je(t.shard))&&n(L(k({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const o=(s,r)=>{const u=L(k({},t),{[s]:r});a(u),s!=="shard"&&s!=="quantity"&&n(u)},l=()=>{const s=L(k({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10});a(s),setTimeout(()=>{n(s)},0)},m=()=>{const s=t.shard,r=t.quantity,u={shard:s,quantity:r,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1};a(u),setTimeout(()=>{n(u)},0)};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(ve,{value:t.shard,onChange:s=>o("shard",s),onSelect:s=>{let r="common";if(s&&typeof s.rarity=="string"){const d=s.rarity.toLowerCase();d in q&&(r=d)}const u=q[r],h=L(k({},t),{shard:s.name,quantity:u});a(h),setTimeout(()=>n(h),0),setTimeout(()=>{const d=document.querySelector('input[placeholder="1"]');d&&d.select()},0)},placeholder:"Search for a shard..."})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>o("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:l,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:m,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>o("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>o("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>o("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:s,label:r})=>e.jsx(ne,{value:t[s]||0,onChange:u=>o(s,u),label:r},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{value:t.kuudraTier||"t5",onChange:s=>o("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0",value:t.moneyPerHour===0?"":t.moneyPerHour,onChange:s=>o("moneyPerHour",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins/hour"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},A=({tree:n,data:t,isTopLevel:a=!1,totalShardsProduced:o=n.quantity,nodeId:l,expandedStates:m,onToggle:s})=>{var f;const r=t.shards[n.shard],u=(f=m.get(l))!=null?f:!0;if(n.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("img",{src:`/shardIcons/${r.id}.png`,alt:r.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[n.quantity,"x"]}),e.jsx("span",{className:`font-medium text-sm ${R(r.rarity)}`,title:B(r,!0),children:r.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-md",children:"DIRECT"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-slate-300",children:[U(r.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]})})]});const h=n.inputs[0],d=n.inputs[1],i=t.shards[h.shard],c=t.shards[d.shard],x=a?o:n.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>s(l),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[u?e.jsx(xe,{className:"w-4 h-4 text-slate-400"}):e.jsx(pe,{className:"w-4 h-4 text-slate-400"}),e.jsx("img",{src:`/shardIcons/${r.id}.png`,alt:r.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[x,"x "]}),e.jsx("span",{className:`font-medium ${R(r.rarity)} text-sm`,title:B(r,!1),children:r.name}),e.jsxs("span",{className:"text-slate-400 ml-1.5 text-sm",children:["= ",h.quantity,"x ",e.jsx("span",{className:R(i.rarity),children:i.name})," + ",d.quantity,"x"," ",e.jsx("span",{className:R(c.rarity),children:c.name})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:`font-medium text-white ${a?"text-sm":"text-xs"}`,children:x})]})})]})}),u&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(A,{tree:h,data:t,nodeId:`${l}-0`,expandedStates:m,onToggle:s}),e.jsx(A,{tree:d,data:t,nodeId:`${l}-1`,expandedStates:m,onToggle:s})]})]})},ye=({result:n,data:t,targetShardName:a})=>{const[o,l]=p.useState(new Map),[m,s]=p.useState(""),r=(i,c="root")=>{const x=new Map,f=(j,N)=>{j.method==="recipe"&&j.inputs&&(x.set(N,!0),j.inputs.forEach((g,w)=>{f(g,`${N}-${w}`)}))};return f(i,c),x};K.useEffect(()=>{if(n.tree){const i=JSON.stringify(n.tree);if(i!==m){const c=r(n.tree);l(c),s(i)}}},[n.tree,m]);const u=()=>{const i=new Map(o);for(const c of i.keys())i.set(c,!0);l(i)},h=()=>{const i=new Map(o);for(const c of i.keys())i.set(c,!1);l(i)},d=i=>{const c=new Map(o);c.set(i,!c.get(i)),l(c)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(n.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(n.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:n.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(D,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[n.totalFusions,"x",n.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),n.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:M(n.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(D,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",n.totalShardsProduced," ",a," ",e.jsxs("span",{className:"text-slate-400",children:[n.craftsNeeded," craft",n.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(n.totalQuantities).map(([i,c])=>{const x=t.shards[i],f=c/x.rate;return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[c,"x"]}),e.jsxs("span",{className:`mt-0 font-medium text-sm ${R(x.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${x.id}.png`,alt:x.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-1",loading:"lazy"}),x.name]})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[U(x.rate)," ",e.jsx("span",{className:"text-slate-500",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:M(f)})]})]},i)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(z,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(A,{tree:n.tree,data:t,isTopLevel:!0,totalShardsProduced:n.totalShardsProduced,nodeId:"root",expandedStates:o,onToggle:d})})]})]})},S=class S{static getInstance(){return S.instance||(S.instance=new S),S.instance}parseData(t){return y(this,null,function*(){var a,o;try{const[l,m]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),s=yield l.json(),r=yield m.json(),u={};for(const d in s.recipes){u[d]=[];for(const i in s.recipes[d]){const c=parseInt(i);s.recipes[d][i].forEach(f=>{u[d].push({inputs:f,outputQuantity:c})})}}const h={};for(const d in s.shards){let i=(o=(a=t.customRates[d])!=null?a:r[d])!=null?o:0;d==="L15"&&i===0&&(i=this.calculateKuudraRate(t.kuudraTier,t.moneyPerHour)),i>0&&(t.noWoodenBait&&le.includes(d)&&(i*=.05),ie.includes(d)||(i=this.applyFortuneModifiers(i,d,s.shards[d],t))),t.excludeChameleon&&d==="L4"&&(i=0),h[d]=L(k({},s.shards[d]),{id:d,rate:i})}return{recipes:u,shards:h}}catch(l){throw new Error(`Failed to parse data: ${l}`)}})}calculateKuudraRate(t,a){const l={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!l)return 0;const m=a===0?0:l.cost/a*3600;return l.multiplier*(3600/(l.baseTime+m))}applyFortuneModifiers(t,a,o,l){let m=l.hunterFortune;const s=1+5*l.tiamatLevel/100,r=1+2*l.seaSerpentLevel/100*s,u=2*l.pythonLevel/100*r,h=l.kingCobraLevel/100*r;switch(o.rarity){case"common":m+=2*l.newtLevel;break;case"uncommon":m+=2*l.salamanderLevel;break;case"rare":m+=l.lizardKingLevel;break;case"epic":m+=l.leviathanLevel;break}return l.frogPet&&(t*=1.1),a in W&&(W[a]&&(t*=1+u),m*=1+h),t*(1+m/100)}computeMinCosts(t){const a=new Map,o=new Map,l=Object.keys(t.shards),m=.8/3600;l.forEach(r=>{const u=t.shards[r].rate>0?1/t.shards[r].rate:1/0;a.set(r,u),o.set(r,{recipe:null})});let s=!0;for(;s;)s=!1,l.forEach(r=>{(t.recipes[r]||[]).forEach(h=>{const[d,i]=h.inputs,c=t.shards[d].fuse_amount,x=t.shards[i].fuse_amount,f=a.get(d)*c,j=a.get(i)*x,g=(f+j+m)/h.outputQuantity;g<a.get(r)&&(a.set(r,g),o.set(r,{recipe:h}),s=!0)})});return{minCosts:a,choices:o}}buildRecipeTree(t,a){const o=a.get(t);if(o.recipe===null)return{shard:t,method:"direct",quantity:0};{const l=o.recipe,[m,s]=l.inputs,r=this.buildRecipeTree(m,a),u=this.buildRecipeTree(s,a);return{shard:t,method:"recipe",recipe:l,inputs:[r,u],quantity:0}}}assignQuantities(t,a,o,l){if(t.quantity=a,t.method==="recipe"){const m=t.recipe,s=m.outputQuantity,r=Math.ceil(a/s);l.total+=r;const[u,h]=m.inputs,d=o.shards[u].fuse_amount,i=o.shards[h].fuse_amount,c=r*d,x=r*i;this.assignQuantities(t.inputs[0],c,o,l),this.assignQuantities(t.inputs[1],x,o,l)}}collectTotalQuantities(t){const a=new Map,o=l=>{if(l.method==="direct"){const m=a.get(l.shard)||0;a.set(l.shard,m+l.quantity)}else l.inputs.forEach(o)};return o(t),a}decimalHoursToHoursMinutes(t){const a=Math.floor(t),o=Math.round((t-a)*60);return a===0?`${o} minutes`:o===0||isNaN(o)?`${a} hours`:`${a} hours ${o} minutes`}calculateOptimalPath(t,a,o){return y(this,null,function*(){var N;const l=yield this.parseData(o);if(!l.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0,inputs:[]}};const{minCosts:m,choices:s}=this.computeMinCosts(l),r=this.buildRecipeTree(t,s),u={total:0};this.assignQuantities(r,a,l,u);const h=this.collectTotalQuantities(r);let d=a,i=1;const c=s.get(t);if(c!=null&&c.recipe){const g=c.recipe.outputQuantity;i=Math.ceil(a/g),d=i*g}const x=(N=m.get(t))!=null?N:0,f=x*d,j=u.total*.8/3600;return{timePerShard:x,totalTime:f,totalShardsProduced:d,craftsNeeded:i,totalQuantities:h,totalFusions:u.total,craftTime:j,tree:r}})}};_(S,"instance");let P=S;const we=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:P},Symbol.toStringTag,{value:"Module"})),Se=()=>{const[n,t]=p.useState(null),[a,o]=p.useState(!1),[l,m]=p.useState(null),s=p.useCallback((u,h,d)=>y(null,null,function*(){try{o(!0),m(null);const c=yield P.getInstance().calculateOptimalPath(u,h,d);t(c)}catch(i){m(i instanceof Error?i.message:"Calculation failed"),t(null)}finally{o(!1)}}),[]),r=p.useCallback(()=>{t(null),m(null)},[]);return{result:n,loading:a,error:l,calculate:s,clearResult:r}},Ce=({onSubmit:n})=>{const{setForm:t}=O();return e.jsx(Ne,{onSubmit:a=>n(a,t)})},ke=()=>{const{result:n,setResult:t,calculationData:a,setCalculationData:o,targetShardName:l,setTargetShardName:m}=O(),{loading:s,error:r}=Se(),{customRates:u}=oe(),[h,d]=p.useState(!1),i=(c,x)=>y(null,null,function*(){x(c);try{if(!c.shard||c.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}d(!1);const N=(yield Q.getInstance().getShardNameToKeyMap())[c.shard.toLowerCase()];if(!N){console.warn(`Calculation skipped: Shard "${c.shard}" not found in data`);return}m(c.shard);const g={customRates:u,hunterFortune:c.hunterFortune,excludeChameleon:c.excludeChameleon,frogPet:c.frogPet,newtLevel:c.newtLevel,salamanderLevel:c.salamanderLevel,lizardKingLevel:c.lizardKingLevel,leviathanLevel:c.leviathanLevel,pythonLevel:c.pythonLevel,kingCobraLevel:c.kingCobraLevel,seaSerpentLevel:c.seaSerpentLevel,tiamatLevel:c.tiamatLevel,kuudraTier:c.kuudraTier,moneyPerHour:c.moneyPerHour,noWoodenBait:c.noWoodenBait},E=(yield ce(()=>Promise.resolve().then(()=>we),void 0)).CalculationService.getInstance(),C=yield E.calculateOptimalPath(N,c.quantity,g);t(C);const F=yield E.parseData(g);o(F)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>d(!h),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm
              `,children:[h?e.jsx(V,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}),e.jsxs("span",{children:[h?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${h?"block":"hidden xl:block"}`,children:e.jsx(Ce,{onSubmit:i})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[r&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:r})]})]}),n&&a&&e.jsx(ye,{result:n,data:a,targetShardName:l}),!n&&!s&&!r&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(I,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>d(!0),className:`
                      px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 
                      text-purple-400 font-medium rounded-md 
                      border border-purple-500/20 hover:border-purple-500/30
                      transition-colors duration-200 text-sm
                      flex items-center space-x-2 mx-auto
                    `,children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})},Fe=()=>e.jsx(ke,{});export{Fe as CalculatorPage};
