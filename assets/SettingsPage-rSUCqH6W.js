var q=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var I=(r,a,t)=>a in r?q(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,E=(r,a)=>{for(var t in a||(a={}))K.call(a,t)&&I(r,t,a[t]);if(F)for(var t of F(a))Q.call(a,t)&&I(r,t,a[t]);return r},T=(r,a)=>G(r,J(a));var L=(r,a,t)=>new Promise((m,h)=>{var c=n=>{try{o(t.next(n))}catch(d){h(d)}},p=n=>{try{o(t.throw(n))}catch(d){h(d)}},o=n=>n.done?m(n.value):Promise.resolve(n.value).then(c,p);o((t=t.apply(r,a)).next())});import{j as e,d as U,b as Y,e as Z,R as P,h as $,S as ee,f as se}from"./index-ITcu-uZD.js";import{r as l,R as B}from"./vendor-Dt516RNf.js";import{u as te,S as re}from"./useCustomRates-BXXwq_XI.js";import{D as ae}from"./dataService-BdYs6t7D.js";import{h as H,R as M,i as O}from"./icons-DNYyJ9Q2.js";import"./forms-CPIcrlzh.js";const _={common:"bg-gray-700/80 border-gray-500/80",uncommon:"bg-green-400/10 border-green-400/20",rare:"bg-blue-400/10 border-blue-400/20",epic:"bg-purple-500/10 border-purple-500/20",legendary:"bg-yellow-400/10 border-yellow-400/20"},ne=({open:r,onClose:a,title:t,name:m,description:h,rarity:c,icon:p,rate:o,onRateChange:n,isDirect:d,family:u,type:f})=>{const[y,b]=l.useState("");B.useEffect(()=>{r&&b("")},[r]),B.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]);const i=x=>{if(b(x.target.value),n){const v=parseFloat(x.target.value);x.target.value===""?n(void 0):isNaN(v)||n(v)}};if(!r)return null;const j=x=>{x.target===x.currentTarget&&a()};return e.jsx("div",{className:"fixed inset-0 z-50 px-1 flex items-center justify-center bg-black/65",onClick:j,children:e.jsxs("div",{className:`bg-slate-900 border ${U(c)} rounded-xl shadow-2xl px-10 py-8 min-w-[500px]  max-w-[700px] relative animate-fadeIn`,onClick:x=>x.stopPropagation(),children:[e.jsx("button",{onClick:a,className:"absolute top-0 right-2 text-2xl text-slate-500 cursor-pointer",children:"×"}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx("img",{src:p,alt:t,className:"w-32 h-32 object-contain flex-shrink-0 shadow-lg"}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0 justify-center",children:[e.jsxs("div",{className:"text-xl font-bold text-white mb-0.5 truncate flex gap-2",children:[m,e.jsx("span",{className:`space-x-2 px-1.5 py-1 font-medium uppercase tracking-wider text-xs ${Y(c)} ${_[c]||_.common} border rounded-md self-start`,children:c})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"text-sm text-yellow-500 font-medium truncate",children:[t," I→X"]}),u&&f&&e.jsxs("span",{className:"text-xs text-slate-400",children:[u," • ",f]})]}),e.jsx("p",{className:"text-slate-300 text-base leading-snug break-words max-w-xl my-3",dangerouslySetInnerHTML:{__html:h}}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[typeof d=="boolean"&&(d?e.jsx("span",{className:"px-1.5 py-1 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md font-medium mr",children:"Direct"}):e.jsx("span",{className:"px-1.5 py-1 text-xs bg-fuchsia-500/20 text-fuchsia-400 border border-fuchsia-500/30 rounded-md font-medium",children:"Fuse"})),e.jsx("input",{type:"number",min:"0",step:"0.01",value:y,onChange:i,placeholder:typeof o=="number"?o.toString():"",className:"px-1 h-6.5 w-15 py-1 text-sm text-center bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-purple-500/50 focus:border-purple-500/50 transition-colors duration-200"}),e.jsx("span",{className:"text-sm text-slate-400",children:"rate / hr"})]})]})]})]})})},le=()=>{const[r,a]=l.useState([]),[t,m]=l.useState(!0),[h,c]=l.useState(null);return l.useEffect(()=>{L(null,null,function*(){try{m(!0);const o=ae.getInstance(),[n,d]=yield Promise.all([o.loadShards(),o.loadDefaultRates()]),u=n.map(f=>T(E({},f),{rate:d[f.key]||0,isDirect:(d[f.key]||0)>0}));a(u),c(null)}catch(o){c(o instanceof Error?o.message:"Failed to load shards and recipes")}finally{m(!1)}})},[]),{shards:r,loading:t,error:h}},he=()=>{console.log("SettingsPage rendered");const{shards:r,loading:a}=le(),{customRates:t,defaultRates:m,updateRate:h,resetRates:c}=te(),[p,o]=l.useState(""),[n,d]=l.useState("all"),[u,f]=l.useState("all"),[y,b]=l.useState(!1),[i,j]=l.useState(null),[x,v]=l.useState(""),S=l.useMemo(()=>Z(s=>v(s),300),[]);l.useEffect(()=>{S(p)},[p,S]);const N=l.useMemo(()=>r.filter(s=>{const g=x.toLowerCase(),w=s.name.toLowerCase().includes(g),z=s.family.toLowerCase().includes(g),A=s.type.toLowerCase().includes(g),V=w||z||A,W=n==="all"||s.rarity===n,X=u==="all"||u==="direct"&&s.isDirect||u==="fuse"&&!s.isDirect;return V&&W&&X}),[r,x,n,u]),C=l.useCallback((s,g)=>{h(s,g),b(!0)},[h]),k=l.useCallback(()=>{confirm("Are you sure you want to reset all rates to their defaults? This will clear all custom rates.")&&(c(),b(!1))},[c]),R=l.useCallback(()=>{b(!1)},[]),D=l.useCallback(s=>{o(s.target.value)},[]);return a?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500/20 border-t-purple-500 rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen flex flex-col space-y-4 py-4",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-md p-4",children:[e.jsxs("div",{className:"text-center pb-6 pt-2",children:[e.jsx("h1",{className:"text-2xl font-black text-purple-400 mb-2",children:"Shard Overview and Rates"}),e.jsxs("p",{className:"text-slate-400",children:["Customize gathering rates",e.jsx("span",{className:"font-bold text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})," for more accurate calculations"]})]}),e.jsxs("div",{className:"md:hidden space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:p,onChange:D,onFocus:()=>o(""),placeholder:"Search shards...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(P,{value:n,onChange:d}),e.jsx($,{value:u,onChange:f}),e.jsxs("button",{onClick:k,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),y&&e.jsxs("button",{onClick:R,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsxs("div",{className:"hidden md:flex md:flex-wrap gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[400px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:p,onChange:D,onFocus:()=>o(""),placeholder:"Search shards...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsx(P,{value:n,onChange:d}),e.jsx($,{value:u,onChange:f}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),y&&e.jsxs("button",{onClick:R,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsx("div",{className:"mt-3 text-sm text-slate-400",children:e.jsxs("p",{children:["Base rates (shards/hour) • Showing ",N.length," of ",r.length," shards"]})})]}),e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-md overflow-hidden flex-1",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 p-3",children:N.map(s=>e.jsx("div",{children:e.jsx(ee,{shard:s,rate:t[s.key]!==void 0?t[s.key]:m[s.key],defaultRate:m[s.key],onRateChange:C,onCardClick:()=>j(s)})},s.key))})})}),i&&(()=>{const s=re[i.key],g=`/SkyShards/shardIcons/${i.key}.png`;return e.jsx(ne,{open:!!i,onClose:()=>j(null),title:(s==null?void 0:s.title)||i.name,name:i.name,description:se((s==null?void 0:s.description)||"No description."),rarity:i.rarity,icon:g,rate:t[i.key]!==void 0?t[i.key]:m[i.key],onRateChange:w=>C(i.key,w),isDirect:i.isDirect,family:i.family,type:i.type})})(),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Shards Found"}),e.jsx("p",{className:"text-slate-400",children:"Try adjusting your search or filter criteria"})]})]})};export{he as SettingsPage};
