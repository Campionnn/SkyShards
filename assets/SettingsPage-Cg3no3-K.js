var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var O=(r,a,t)=>a in r?Y(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,A=(r,a)=>{for(var t in a||(a={}))se.call(a,t)&&O(r,t,a[t]);if(M)for(var t of M(a))te.call(a,t)&&O(r,t,a[t]);return r},B=(r,a)=>Z(r,ee(a));var H=(r,a,t)=>new Promise((d,h)=>{var u=n=>{try{o(t.next(n))}catch(m){h(m)}},f=n=>{try{o(t.throw(n))}catch(m){h(m)}},o=n=>n.done?d(n.value):Promise.resolve(n.value).then(u,f);o((t=t.apply(r,a)).next())});import{j as e,d as re,b as ae,e as ne,R as _,h as z,S as le,f as oe}from"./index-CIGqkUlD.js";import{r as l,R as D}from"./vendor-Dt516RNf.js";import{u as ie}from"./useCustomRates-CPB9dONO.js";import{D as ce,S as V}from"./dataService-9TujrULY.js";import{c as de,h as W,R as K,i as X}from"./icons-DNYyJ9Q2.js";import"./forms-CPIcrlzh.js";const q={common:"bg-gray-700/80 border-gray-500/80",uncommon:"bg-green-400/10 border-green-400/20",rare:"bg-blue-400/10 border-blue-400/20",epic:"bg-purple-500/10 border-purple-500/20",legendary:"bg-yellow-400/10 border-yellow-400/20"},ue=({open:r,onClose:a,title:t,name:d,description:h,rarity:u,icon:f,rate:o,onRateChange:n,isDirect:m,family:x,type:g})=>{const[N,y]=l.useState("");D.useEffect(()=>{r&&y("")},[r]),D.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),D.useEffect(()=>{const c=v=>{v.key==="Escape"&&r&&(document.activeElement&&document.activeElement.blur(),a())};return r&&document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[r,a]);const i=c=>{if(y(c.target.value),n){const v=parseFloat(c.target.value);c.target.value===""?n(void 0):isNaN(v)||n(v)}};if(!r)return null;const w=c=>{c.target===c.currentTarget&&a()};return e.jsx("div",{className:"fixed inset-0 z-50 px-1 flex items-center justify-center bg-black/65",onClick:w,children:e.jsxs("div",{className:`bg-slate-900 border ${re(u)} rounded-xl shadow-2xl px-10 py-8 min-w-[500px]  max-w-[700px] relative animate-fadeIn`,onClick:c=>c.stopPropagation(),children:[e.jsx("button",{onClick:a,className:"absolute top-0 right-2 text-2xl text-slate-500 cursor-pointer",children:"×"}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx("img",{src:f,alt:t,className:"w-32 h-32 object-contain flex-shrink-0 shadow-lg"}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0 justify-center",children:[e.jsxs("div",{className:"text-xl font-bold text-white mb-0.5 truncate flex gap-2",children:[d,e.jsx("span",{className:`space-x-2 px-1.5 py-1 font-medium uppercase tracking-wider text-xs ${ae(u)} ${q[u]||q.common} border rounded-md self-start`,children:u})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"text-sm text-yellow-500 font-medium truncate flex gap-1 items-center",children:[t,e.jsxs("span",{className:"flex items-center",children:["I",e.jsx(de,{className:"w-4"}),"X"]})]}),x&&g&&e.jsxs("span",{className:"text-xs text-slate-400",children:[x," • ",g]})]}),e.jsx("p",{className:"text-slate-300 text-base leading-snug break-words max-w-xl my-3",dangerouslySetInnerHTML:{__html:h}}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[typeof m=="boolean"&&(m?e.jsx("span",{className:"px-1.5 py-1 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md font-medium mr",children:"Direct"}):e.jsx("span",{className:"px-1.5 py-1 text-xs bg-fuchsia-500/20 text-fuchsia-400 border border-fuchsia-500/30 rounded-md font-medium",children:"Fuse"})),e.jsx("input",{type:"number",min:"0",step:"0.01",value:N,onChange:i,placeholder:typeof o=="number"?o.toString():"",className:"px-1 h-6.5 w-15 py-1 text-sm text-center bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-purple-500/50 focus:border-purple-500/50 transition-colors duration-200"}),e.jsx("span",{className:"text-sm text-slate-400",children:"rate / hr"})]})]})]})]})})},me=()=>{const[r,a]=l.useState([]),[t,d]=l.useState(!0),[h,u]=l.useState(null);return l.useEffect(()=>{H(null,null,function*(){try{d(!0);const o=ce.getInstance(),[n,m]=yield Promise.all([o.loadShards(),o.loadDefaultRates()]),x=n.map(g=>B(A({},g),{rate:m[g.key]||0,isDirect:(m[g.key]||0)>0}));a(x),u(null)}catch(o){u(o instanceof Error?o.message:"Failed to load shards and recipes")}finally{d(!1)}})},[]),{shards:r,loading:t,error:h}},ve=()=>{console.log("SettingsPage rendered");const{shards:r,loading:a}=me(),{customRates:t,defaultRates:d,updateRate:h,resetRates:u}=ie(),[f,o]=l.useState(""),[n,m]=l.useState("all"),[x,g]=l.useState("all"),[N,y]=l.useState(!1),[i,w]=l.useState(null),[c,v]=l.useState(""),F=l.useMemo(()=>ne(s=>v(s),300),[]);l.useEffect(()=>{F(f)},[f,F]);const k=l.useMemo(()=>r.filter(s=>{var P,$;const p=c.toLowerCase(),j=s.name.toLowerCase().includes(p),C=s.family.toLowerCase().includes(p),R=s.type.toLowerCase().includes(p),b=V[s.key],S=((P=b==null?void 0:b.title)==null?void 0:P.toLowerCase().includes(p))||!1,G=(($=b==null?void 0:b.description)==null?void 0:$.toLowerCase().includes(p))||!1,J=j||C||R||S||G,Q=n==="all"||s.rarity===n,U=x==="all"||x==="direct"&&s.isDirect||x==="fuse"&&!s.isDirect;return J&&Q&&U}),[r,c,n,x]),E=l.useCallback((s,p)=>{h(s,p);const j=d[s],C=p!==void 0&&p!==j,R=Object.entries(t).some(([b,S])=>b===s?!1:S!==void 0&&S!==d[b]);y(C||R)},[h,d,t]),L=l.useCallback(()=>{confirm("Are you sure you want to reset all rates to their defaults? This will clear all custom rates.")&&(u(),y(!1))},[u]),T=l.useCallback(()=>{y(!1)},[]),I=l.useCallback(s=>{o(s.target.value)},[]);return a?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500/20 border-t-purple-500 rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen flex flex-col space-y-4 py-4",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-md p-4",children:[e.jsxs("div",{className:"text-center pb-6 pt-2",children:[e.jsx("h1",{className:"text-2xl font-black text-purple-400 mb-2",children:"Shard Overview and Rates"}),e.jsxs("p",{className:"text-slate-400",children:["Customize gathering rates",e.jsx("span",{className:"font-bold text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})," for more accurate calculations"]})]}),e.jsxs("div",{className:"md:hidden space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:f,onChange:I,onFocus:()=>o(""),placeholder:"Search by name, perk, or description...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(_,{value:n,onChange:m}),e.jsx(z,{value:x,onChange:g}),e.jsxs("button",{onClick:L,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),N&&e.jsxs("button",{onClick:T,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsxs("div",{className:"hidden md:flex md:flex-wrap gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[400px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:f,onChange:I,onFocus:()=>o(""),placeholder:"Search by name, perk, or description...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsx(_,{value:n,onChange:m}),e.jsx(z,{value:x,onChange:g}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:L,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),N&&e.jsxs("button",{onClick:T,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsx("div",{className:"mt-3 text-sm text-slate-400",children:e.jsxs("p",{children:["Base rates (shards/hour) • Showing ",k.length," of ",r.length," shards"]})})]}),e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-md overflow-hidden flex-1",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 p-3",children:k.map(s=>e.jsx("div",{children:e.jsx(le,{shard:s,rate:t[s.key]!==void 0?t[s.key]:d[s.key],defaultRate:d[s.key],onRateChange:E,onCardClick:()=>w(s)})},s.key))})})}),i&&(()=>{const s=V[i.key],p=`/SkyShards/shardIcons/${i.key}.png`;return e.jsx(ue,{open:!!i,onClose:()=>w(null),title:(s==null?void 0:s.title)||i.name,name:i.name,description:oe((s==null?void 0:s.description)||"No description."),rarity:i.rarity,icon:p,rate:t[i.key]!==void 0?t[i.key]:d[i.key],onRateChange:j=>E(i.key,j),isDirect:i.isDirect,family:i.family,type:i.type})})(),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Shards Found"}),e.jsx("p",{className:"text-slate-400",children:"Try adjusting your search or filter criteria"})]})]})};export{ve as SettingsPage};
