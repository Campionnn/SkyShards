var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var L=(r,a,t)=>a in r?Y(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,P=(r,a)=>{for(var t in a||(a={}))se.call(a,t)&&L(r,t,a[t]);if(E)for(var t of E(a))te.call(a,t)&&L(r,t,a[t]);return r},$=(r,a)=>Z(r,ee(a));var B=(r,a,t)=>new Promise((x,p)=>{var c=n=>{try{o(t.next(n))}catch(d){p(d)}},h=n=>{try{o(t.throw(n))}catch(d){p(d)}},o=n=>n.done?x(n.value):Promise.resolve(n.value).then(c,h);o((t=t.apply(r,a)).next())});import{j as e,d as re,b as ae,e as ne,R as H,h as M,S as le,f as oe}from"./index-DTauWsvd.js";import{r as l,R as O}from"./vendor-Dt516RNf.js";import{u as ie}from"./useCustomRates-BfcviGvR.js";import{D as ce,S as _}from"./dataService-lmqG_xQ6.js";import{h as z,R as A,i as V}from"./icons-DNYyJ9Q2.js";import"./forms-CPIcrlzh.js";const W={common:"bg-gray-700/80 border-gray-500/80",uncommon:"bg-green-400/10 border-green-400/20",rare:"bg-blue-400/10 border-blue-400/20",epic:"bg-purple-500/10 border-purple-500/20",legendary:"bg-yellow-400/10 border-yellow-400/20"},de=({open:r,onClose:a,title:t,name:x,description:p,rarity:c,icon:h,rate:o,onRateChange:n,isDirect:d,family:u,type:f})=>{const[j,b]=l.useState("");O.useEffect(()=>{r&&b("")},[r]),O.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]);const i=m=>{if(b(m.target.value),n){const N=parseFloat(m.target.value);m.target.value===""?n(void 0):isNaN(N)||n(N)}};if(!r)return null;const v=m=>{m.target===m.currentTarget&&a()};return e.jsx("div",{className:"fixed inset-0 z-50 px-1 flex items-center justify-center bg-black/65",onClick:v,children:e.jsxs("div",{className:`bg-slate-900 border ${re(c)} rounded-xl shadow-2xl px-10 py-8 min-w-[500px]  max-w-[700px] relative animate-fadeIn`,onClick:m=>m.stopPropagation(),children:[e.jsx("button",{onClick:a,className:"absolute top-0 right-2 text-2xl text-slate-500 cursor-pointer",children:"×"}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx("img",{src:h,alt:t,className:"w-32 h-32 object-contain flex-shrink-0 shadow-lg"}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0 justify-center",children:[e.jsxs("div",{className:"text-xl font-bold text-white mb-0.5 truncate flex gap-2",children:[x,e.jsx("span",{className:`space-x-2 px-1.5 py-1 font-medium uppercase tracking-wider text-xs ${ae(c)} ${W[c]||W.common} border rounded-md self-start`,children:c})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"text-sm text-yellow-500 font-medium truncate",children:[t," I→X"]}),u&&f&&e.jsxs("span",{className:"text-xs text-slate-400",children:[u," • ",f]})]}),e.jsx("p",{className:"text-slate-300 text-base leading-snug break-words max-w-xl my-3",dangerouslySetInnerHTML:{__html:p}}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[typeof d=="boolean"&&(d?e.jsx("span",{className:"px-1.5 py-1 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md font-medium mr",children:"Direct"}):e.jsx("span",{className:"px-1.5 py-1 text-xs bg-fuchsia-500/20 text-fuchsia-400 border border-fuchsia-500/30 rounded-md font-medium",children:"Fuse"})),e.jsx("input",{type:"number",min:"0",step:"0.01",value:j,onChange:i,placeholder:typeof o=="number"?o.toString():"",className:"px-1 h-6.5 w-15 py-1 text-sm text-center bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-purple-500/50 focus:border-purple-500/50 transition-colors duration-200"}),e.jsx("span",{className:"text-sm text-slate-400",children:"rate / hr"})]})]})]})]})})},ue=()=>{const[r,a]=l.useState([]),[t,x]=l.useState(!0),[p,c]=l.useState(null);return l.useEffect(()=>{B(null,null,function*(){try{x(!0);const o=ce.getInstance(),[n,d]=yield Promise.all([o.loadShards(),o.loadDefaultRates()]),u=n.map(f=>$(P({},f),{rate:d[f.key]||0,isDirect:(d[f.key]||0)>0}));a(u),c(null)}catch(o){c(o instanceof Error?o.message:"Failed to load shards and recipes")}finally{x(!1)}})},[]),{shards:r,loading:t,error:p}},ye=()=>{console.log("SettingsPage rendered");const{shards:r,loading:a}=ue(),{customRates:t,defaultRates:x,updateRate:p,resetRates:c}=ie(),[h,o]=l.useState(""),[n,d]=l.useState("all"),[u,f]=l.useState("all"),[j,b]=l.useState(!1),[i,v]=l.useState(null),[m,N]=l.useState(""),C=l.useMemo(()=>ne(s=>N(s),300),[]);l.useEffect(()=>{C(h)},[h,C]);const w=l.useMemo(()=>r.filter(s=>{var I,T;const g=m.toLowerCase(),S=s.name.toLowerCase().includes(g),X=s.family.toLowerCase().includes(g),q=s.type.toLowerCase().includes(g),y=_[s.key],G=((I=y==null?void 0:y.title)==null?void 0:I.toLowerCase().includes(g))||!1,J=((T=y==null?void 0:y.description)==null?void 0:T.toLowerCase().includes(g))||!1,K=S||X||q||G||J,Q=n==="all"||s.rarity===n,U=u==="all"||u==="direct"&&s.isDirect||u==="fuse"&&!s.isDirect;return K&&Q&&U}),[r,m,n,u]),k=l.useCallback((s,g)=>{p(s,g),b(!0)},[p]),R=l.useCallback(()=>{confirm("Are you sure you want to reset all rates to their defaults? This will clear all custom rates.")&&(c(),b(!1))},[c]),F=l.useCallback(()=>{b(!1)},[]),D=l.useCallback(s=>{o(s.target.value)},[]);return a?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500/20 border-t-purple-500 rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen flex flex-col space-y-4 py-4",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-md p-4",children:[e.jsxs("div",{className:"text-center pb-6 pt-2",children:[e.jsx("h1",{className:"text-2xl font-black text-purple-400 mb-2",children:"Shard Overview and Rates"}),e.jsxs("p",{className:"text-slate-400",children:["Customize gathering rates",e.jsx("span",{className:"font-bold text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})," for more accurate calculations"]})]}),e.jsxs("div",{className:"md:hidden space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(z,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:h,onChange:D,onFocus:()=>o(""),placeholder:"Search by name, perk, or description...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(H,{value:n,onChange:d}),e.jsx(M,{value:u,onChange:f}),e.jsxs("button",{onClick:R,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),j&&e.jsxs("button",{onClick:F,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsxs("div",{className:"hidden md:flex md:flex-wrap gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[400px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(z,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:"text",value:h,onChange:D,onFocus:()=>o(""),placeholder:"Search by name, perk, or description...",className:`
                w-full pl-10 pr-4 py-2.5 
                bg-white/5 border border-white/10 
                rounded-md text-white placeholder-slate-400
                focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50
                transition-colors duration-200
              `})]}),e.jsx(H,{value:n,onChange:d}),e.jsx(M,{value:u,onChange:f}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:R,className:`
                px-3 py-2.5 bg-red-500/20 hover:bg-red-500/30 
                text-red-400 font-medium rounded-md 
                border border-red-500/20 hover:border-red-500/30
                transition-colors duration-200
                flex items-center space-x-2 cursor-pointer
              `,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),j&&e.jsxs("button",{onClick:F,className:`
                  px-3 py-2.5 bg-green-500/20 hover:bg-green-500/30 
                  text-green-400 font-medium rounded-md 
                  border border-green-500/20 hover:border-green-500/30
                  transition-colors duration-200
                  flex items-center space-x-2 cursor-pointer
                `,children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})]})]}),e.jsx("div",{className:"mt-3 text-sm text-slate-400",children:e.jsxs("p",{children:["Base rates (shards/hour) • Showing ",w.length," of ",r.length," shards"]})})]}),e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-md overflow-hidden flex-1",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 p-3",children:w.map(s=>e.jsx("div",{children:e.jsx(le,{shard:s,rate:t[s.key]!==void 0?t[s.key]:x[s.key],defaultRate:x[s.key],onRateChange:k,onCardClick:()=>v(s)})},s.key))})})}),i&&(()=>{const s=_[i.key],g=`/SkyShards/shardIcons/${i.key}.png`;return e.jsx(de,{open:!!i,onClose:()=>v(null),title:(s==null?void 0:s.title)||i.name,name:i.name,description:oe((s==null?void 0:s.description)||"No description."),rarity:i.rarity,icon:g,rate:t[i.key]!==void 0?t[i.key]:x[i.key],onRateChange:S=>k(i.key,S),isDirect:i.isDirect,family:i.family,type:i.type})})(),w.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Shards Found"}),e.jsx("p",{className:"text-slate-400",children:"Try adjusting your search or filter criteria"})]})]})};export{ye as SettingsPage};
