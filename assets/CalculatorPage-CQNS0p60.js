var Z=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var I=(i,t,a)=>t in i?Z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,y=(i,t)=>{for(var a in t||(t={}))ee.call(t,a)&&I(i,a,t[a]);if(O)for(var a of O(t))te.call(t,a)&&I(i,a,t[a]);return i},w=(i,t)=>G(i,Y(t));var _=(i,t,a)=>I(i,typeof t!="symbol"?t+"":t,a);var S=(i,t,a)=>new Promise((d,n)=>{var l=m=>{try{c(a.next(m))}catch(x){n(x)}},h=m=>{try{c(a.throw(m))}catch(x){n(x)}},c=m=>m.done?d(m.value):Promise.resolve(m.value).then(l,h);c((a=a.apply(i,t)).next())});import{d as se,j as e,S as ae,u as z,P as re,K as ne,M as R,g as A,a as M,f as W,b as E,W as le,N as ie,B as q,C as ce,_ as oe}from"./index-BWKby48I.js";import{r as p,R as D}from"./vendor-e8ACzjHW.js";import{D as P,u as de}from"./useCustomRates-DYOjOmUZ.js";import{b as ue,X as V,S as me,Z as he,R as xe,a as pe,c as fe,d as be,T as ge,e as H,H as B,M as K,f as ve}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";const je=({value:i,onChange:t,onSelect:a,placeholder:d="Search for a shard...",className:n=""})=>{const[l,h]=p.useState([]),[c,m]=p.useState(!1),[x,s]=p.useState(-1),[r,u]=p.useState(!1),[o,f]=p.useState(!1),v=p.useRef(null),N=p.useRef(null),g=p.useRef(null),C=p.useMemo(()=>se(b=>S(null,null,function*(){if(b.length===0||r){h([]),m(!1),f(!1);return}f(!0);try{const L=yield P.getInstance().searchShards(b);h(L.slice(0,10)),m(L.length>0),s(-1)}catch(j){console.error("Search failed:",j),h([]),m(!1)}finally{f(!1)}}),100),[r]),Q=p.useCallback(b=>{const j=b.target.value;u(!1),t(j),g.current&&clearTimeout(g.current),C(j)},[t,C]),T=p.useCallback(b=>{u(!0),m(!1),h([]),s(-1),t(b.name),a(b),g.current&&clearTimeout(g.current),setTimeout(()=>{u(!1),v.current&&v.current.blur()},50)},[t,a]),U=p.useCallback(b=>{if(!(!c||l.length===0||r))switch(b.key){case"ArrowDown":b.preventDefault(),s(j=>(j+1)%l.length);break;case"ArrowUp":b.preventDefault(),s(j=>j<=0?l.length-1:j-1);break;case"Enter":b.preventDefault(),x>=0&&x<l.length?T(l[x]):l.length===1&&T(l[0]);break;case"Escape":m(!1),s(-1);break}},[c,l,r,x,T]),J=p.useCallback(()=>{var b;u(!1),t(""),h([]),m(!1),s(-1),g.current&&clearTimeout(g.current),(b=v.current)==null||b.focus()},[t]),X=p.useCallback(()=>{r||i.trim()&&C(i)},[r,i,C]);return p.useEffect(()=>{const b=j=>{const L=j.target;v.current&&!v.current.contains(L)&&N.current&&!N.current.contains(L)&&(m(!1),s(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),g.current&&clearTimeout(g.current)}},[]),e.jsxs("div",{className:`relative ${n}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:o?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(ue,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:v,type:"text",value:i,onChange:Q,onKeyDown:U,onFocus:X,placeholder:d,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),i&&e.jsx("button",{onClick:J,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(V,{className:"h-4 w-4"})})]}),c&&l.length>0&&!r&&e.jsx("ul",{ref:N,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:l.map((b,j)=>e.jsx(ae,{shard:b,index:j,focusedIndex:x,onSelect:T,isSelecting:r,setFocusedIndex:s},b.key))})]})},Ne=({onSubmit:i})=>{const{form:t,setForm:a,resetForm:d}=z(),n=t.shard;D.useEffect(()=>{const s=r=>S(null,null,function*(){if(!r||r.trim()==="")return!1;try{return!!(yield P.getInstance().getShardNameToKeyMap())[r.toLowerCase()]}catch(u){return!1}});if(n&&n.trim()!==""&&t.shard&&t.shard.trim()!==""){const r=setTimeout(()=>S(null,null,function*(){if(yield s(t.shard)){const o=w(y({},t),{frogPet:!1});i(o)}}),0);return()=>clearTimeout(r)}},[t,i,n]);const l=(s,r)=>{a(w(y({},t),{[s]:r}))},h=s=>{a(w(y({},t),{shard:s.name})),setTimeout(()=>{const r=w(y({},t),{shard:s.name,frogPet:!1});i(r)},100)},c=()=>{a(w(y({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10}))},m=()=>{const s=t.shard,r=t.quantity;d(),a(w(y({},t),{shard:s,quantity:r}))},x=()=>S(null,null,function*(){const s=n;if(!s||s.trim()===""){a(w(y({},t),{quantity:R.common}));return}try{const u=yield P.getInstance().getShardByName(s);if(u){const o=R[u.rarity]||R.common;a(w(y({},t),{quantity:o}))}else a(w(y({},t),{quantity:R.common}))}catch(r){console.error("Failed to get shard rarity:",r),a(w(y({},t),{quantity:R.common}))}});return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(je,{value:t.shard,onChange:s=>l("shard",s),onSelect:h,placeholder:"Search for a shard..."})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:s=>l("quantity",Number(s.target.value)),className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:" "}),e.jsx("button",{type:"button",onClick:x,className:"px-2.5 py-1.5 text-sm font-medium rounded-md bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 border border-emerald-500/20 hover:border-emerald-500/30 transition-colors duration-200 flex items-center justify-center cursor-pointer",children:"Max"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:c,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:m,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune,onChange:s=>l("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"excludeChameleon",type:"checkbox",checked:t.excludeChameleon,onChange:s=>l("excludeChameleon",s.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Chameleon"})]}),e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"excludeWoodenBait",type:"checkbox",checked:t.noWoodenBait,onChange:s=>l("noWoodenBait",s.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Wooden Bait"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:s,label:r})=>e.jsx(re,{value:t[s]||0,onChange:u=>l(s,u),label:r},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{value:t.kuudraTier||"t5",onChange:s=>l("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"40000000",value:t.moneyPerHour||"",onChange:s=>l("moneyPerHour",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins/hour"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},$=({tree:i,data:t,isTopLevel:a=!1,totalShardsProduced:d=i.quantity,nodeId:n,expandedStates:l,onToggle:h})=>{var f;const c=t.shards[i.shard],m=(f=l.get(n))!=null?f:!0;if(i.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[i.quantity,"x"]}),e.jsx("span",{className:`font-medium text-sm ${M(c.rarity)}`,title:A(c,!0),children:c.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-md",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:[W(c.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[c.type," • ",c.family]})]})]});const x=i.inputs[0],s=i.inputs[1],r=t.shards[x.shard],u=t.shards[s.shard],o=a?d:i.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>h(n),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[m?e.jsx(pe,{className:"w-4 h-4 text-slate-400"}):e.jsx(fe,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[o,"x "]}),e.jsx("span",{className:`font-medium ${M(c.rarity)} text-sm`,title:A(c,!1),children:c.name}),e.jsxs("span",{className:"text-slate-400 ml-1.5 text-sm",children:["= ",x.quantity,"x ",e.jsx("span",{className:M(r.rarity),children:r.name})," + ",s.quantity,"x"," ",e.jsx("span",{className:M(u.rarity),children:u.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:`font-medium text-white ${a?"text-sm":"text-xs"}`,children:o})]}),e.jsxs("div",{className:"text-slate-400 capitalize text-xs",children:[c.type," • ",c.family]})]})]})}),m&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx($,{tree:x,data:t,nodeId:`${n}-0`,expandedStates:l,onToggle:h}),e.jsx($,{tree:s,data:t,nodeId:`${n}-1`,expandedStates:l,onToggle:h})]})]})},ye=({result:i,data:t,targetShardName:a})=>{const[d,n]=p.useState(new Map),[l,h]=p.useState(""),c=(r,u="root")=>{const o=new Map,f=(v,N)=>{v.method==="recipe"&&v.inputs&&(o.set(N,!0),v.inputs.forEach((g,C)=>{f(g,`${N}-${C}`)}))};return f(r,u),o};D.useEffect(()=>{if(i.tree){const r=JSON.stringify(i.tree);if(r!==l){const u=c(i.tree);n(u),h(r)}}},[i.tree,l]);const m=()=>{const r=new Map(d);for(const u of r.keys())r.set(u,!0);n(r)},x=()=>{const r=new Map(d);for(const u of r.keys())r.set(u,!1);n(r)},s=r=>{const u=new Map(d);u.set(r,!u.get(r)),n(u)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:E(i.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:E(i.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(H,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:i.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(B,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[i.totalFusions,"x",i.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),i.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:E(i.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(B,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",i.totalShardsProduced," ",a," ",e.jsxs("span",{className:"text-slate-400",children:[i.craftsNeeded," craft",i.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(i.totalQuantities).map(([r,u])=>{const o=t.shards[r],f=u/o.rate;return e.jsx("div",{className:"bg-slate-700 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[u,"x ",e.jsx("span",{className:M(o.rarity),children:o.name})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[W(o.rate),e.jsx("span",{className:"text-slate-600 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs text-slate-400",children:E(f)})})]})},r)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(H,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:x,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx($,{tree:i.tree,data:t,isTopLevel:!0,totalShardsProduced:i.totalShardsProduced,nodeId:"root",expandedStates:d,onToggle:s})})]})]})},k=class k{static getInstance(){return k.instance||(k.instance=new k),k.instance}parseData(t){return S(this,null,function*(){var a,d;try{const[n,l]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),h=yield n.json(),c=yield l.json(),m={};for(const s in h.recipes){m[s]=[];for(const r in h.recipes[s]){const u=parseInt(r);h.recipes[s][r].forEach(f=>{m[s].push({inputs:f,outputQuantity:u})})}}const x={};for(const s in h.shards){let r=(d=(a=t.customRates[s])!=null?a:c[s])!=null?d:0;s==="L15"&&r===0&&(r=this.calculateKuudraRate(t.kuudraTier,t.moneyPerHour)),r>0&&(t.noWoodenBait&&le.includes(s)&&(r*=.05),ie.includes(s)||(r=this.applyFortuneModifiers(r,s,h.shards[s],t))),t.excludeChameleon&&s==="L4"&&(r=0),x[s]=w(y({},h.shards[s]),{id:s,rate:r})}return{recipes:m,shards:x}}catch(n){throw new Error(`Failed to parse data: ${n}`)}})}calculateKuudraRate(t,a){const n={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!n)return 0;const l=a===0?0:n.cost/a*3600;return n.multiplier*(3600/(n.baseTime+l))}applyFortuneModifiers(t,a,d,n){let l=n.hunterFortune;const h=1+5*n.tiamatLevel/100,c=1+2*n.seaSerpentLevel/100*h,m=2*n.pythonLevel/100*c,x=n.kingCobraLevel/100*c;switch(d.rarity){case"common":l+=2*n.newtLevel;break;case"uncommon":l+=2*n.salamanderLevel;break;case"rare":l+=n.lizardKingLevel;break;case"epic":l+=n.leviathanLevel;break}return n.frogPet&&(t*=1.1),a in q&&(q[a]&&(t*=1+m),l*=1+x),t*(1+l/100)}computeMinCosts(t){const a=new Map,d=new Map,n=Object.keys(t.shards),l=.8/3600;n.forEach(c=>{const m=t.shards[c].rate>0?1/t.shards[c].rate:1/0;a.set(c,m),d.set(c,{recipe:null})});let h=!0;for(;h;)h=!1,n.forEach(c=>{(t.recipes[c]||[]).forEach(x=>{const[s,r]=x.inputs,u=t.shards[s].fuse_amount,o=t.shards[r].fuse_amount,f=a.get(s)*u,v=a.get(r)*o,g=(f+v+l)/x.outputQuantity;g<a.get(c)&&(a.set(c,g),d.set(c,{recipe:x}),h=!0)})});return{minCosts:a,choices:d}}buildRecipeTree(t,a){const d=a.get(t);if(d.recipe===null)return{shard:t,method:"direct",quantity:0};{const n=d.recipe,[l,h]=n.inputs,c=this.buildRecipeTree(l,a),m=this.buildRecipeTree(h,a);return{shard:t,method:"recipe",recipe:n,inputs:[c,m],quantity:0}}}assignQuantities(t,a,d,n){if(t.quantity=a,t.method==="recipe"){const l=t.recipe,h=l.outputQuantity,c=Math.ceil(a/h);n.total+=c;const[m,x]=l.inputs,s=d.shards[m].fuse_amount,r=d.shards[x].fuse_amount,u=c*s,o=c*r;this.assignQuantities(t.inputs[0],u,d,n),this.assignQuantities(t.inputs[1],o,d,n)}}collectTotalQuantities(t){const a=new Map,d=n=>{if(n.method==="direct"){const l=a.get(n.shard)||0;a.set(n.shard,l+n.quantity)}else n.inputs.forEach(d)};return d(t),a}decimalHoursToHoursMinutes(t){const a=Math.floor(t),d=Math.round((t-a)*60);return a===0?`${d} minutes`:d===0||isNaN(d)?`${a} hours`:`${a} hours ${d} minutes`}calculateOptimalPath(t,a,d){return S(this,null,function*(){var N;const n=yield this.parseData(d);if(!n.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0,inputs:[]}};const{minCosts:l,choices:h}=this.computeMinCosts(n),c=this.buildRecipeTree(t,h),m={total:0};this.assignQuantities(c,a,n,m);const x=this.collectTotalQuantities(c);let s=a,r=1;const u=h.get(t);if(u!=null&&u.recipe){const g=u.recipe.outputQuantity;r=Math.ceil(a/g),s=r*g}const o=(N=l.get(t))!=null?N:0,f=o*s,v=m.total*.8/3600;return{timePerShard:o,totalTime:f,totalShardsProduced:s,craftsNeeded:r,totalQuantities:x,totalFusions:m.total,craftTime:v,tree:c}})}};_(k,"instance");let F=k;const we=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:F},Symbol.toStringTag,{value:"Module"})),Se=()=>{const[i,t]=p.useState(null),[a,d]=p.useState(!1),[n,l]=p.useState(null),h=p.useCallback((m,x,s)=>S(null,null,function*(){try{d(!0),l(null);const u=yield F.getInstance().calculateOptimalPath(m,x,s);t(u)}catch(r){l(r instanceof Error?r.message:"Calculation failed"),t(null)}finally{d(!1)}}),[]),c=p.useCallback(()=>{t(null),l(null)},[]);return{result:i,loading:a,error:n,calculate:h,clearResult:c}},Ce=()=>{const{result:i,loading:t,error:a,calculate:d}=Se(),{customRates:n}=de(),{setForm:l}=z(),[h,c]=p.useState(null),[m,x]=p.useState(""),[s,r]=p.useState(!1),u=o=>S(null,null,function*(){l(o);try{if(!o.shard||o.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}r(!1);const N=(yield P.getInstance().getShardNameToKeyMap())[o.shard.toLowerCase()];if(!N){console.warn(`Calculation skipped: Shard "${o.shard}" not found in data`);return}x(o.shard);const g={customRates:n,hunterFortune:o.hunterFortune,excludeChameleon:o.excludeChameleon,frogPet:o.frogPet,newtLevel:o.newtLevel,salamanderLevel:o.salamanderLevel,lizardKingLevel:o.lizardKingLevel,leviathanLevel:o.leviathanLevel,pythonLevel:o.pythonLevel,kingCobraLevel:o.kingCobraLevel,seaSerpentLevel:o.seaSerpentLevel,tiamatLevel:o.tiamatLevel,kuudraTier:o.kuudraTier,moneyPerHour:o.moneyPerHour,noWoodenBait:o.noWoodenBait};yield d(N,o.quantity,g);const T=yield(yield oe(()=>Promise.resolve().then(()=>we),void 0)).CalculationService.getInstance().parseData(g);c(T)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>r(!s),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm
              `,children:[s?e.jsx(V,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[s?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${s?"block":"hidden xl:block"}`,children:e.jsx(Ne,{onSubmit:u})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[a&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ve,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:a})]})]}),i&&h&&e.jsx(ye,{result:i,data:h,targetShardName:m}),!i&&!t&&!a&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(K,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>r(!0),className:`
                      px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 
                      text-purple-400 font-medium rounded-md 
                      border border-purple-500/20 hover:border-purple-500/30
                      transition-colors duration-200 text-sm
                      flex items-center space-x-2 mx-auto
                    `,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})},Pe=()=>e.jsx(ce,{children:e.jsx(Ce,{})});export{Pe as CalculatorPage};
