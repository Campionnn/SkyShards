var Z=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var $=(l,t,s)=>t in l?Z(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s,L=(l,t)=>{for(var s in t||(t={}))ee.call(t,s)&&$(l,s,t[s]);if(Q)for(var s of Q(t))te.call(t,s)&&$(l,s,t[s]);return l},T=(l,t)=>G(l,Y(t));var H=(l,t,s)=>$(l,typeof t!="symbol"?t+"":t,s);var C=(l,t,s)=>new Promise((c,r)=>{var m=u=>{try{n(s.next(u))}catch(h){r(h)}},a=u=>{try{n(s.throw(u))}catch(h){r(h)}},n=u=>u.done?c(u.value):Promise.resolve(u.value).then(m,a);n((s=s.apply(l,t)).next())});import{d as se,j as e,S as ae,u as O,M as _,P as ne,K as re,g as A,a as R,f as z,b as M,W as le,N as ie,B as q,_ as oe}from"./index-GIlZK1kM.js";import{r as x,R as D}from"./vendor-e8ACzjHW.js";import{D as U,u as ce}from"./useCustomRates--fFrVg9p.js";import{b as de,X as J,S as ue,Z as me,R as he,a as xe,c as pe,d as fe,T as be,e as B,H as W,M as K,f as ge}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";const je=({value:l,onChange:t,onSelect:s,placeholder:c="Search for a shard...",className:r=""})=>{const[m,a]=x.useState([]),[n,u]=x.useState(!1),[h,d]=x.useState(-1),[i,o]=x.useState(!1),[p,f]=x.useState(!1),j=x.useRef(null),N=x.useRef(null),g=x.useRef(null),y=x.useMemo(()=>se(b=>C(null,null,function*(){if(b.length===0||i){a([]),u(!1),f(!1);return}f(!0);try{const k=yield U.getInstance().searchShards(b);a(k.slice(0,10)),u(k.length>0),d(-1)}catch(v){console.error("Search failed:",v),a([]),u(!1)}finally{f(!1)}}),100),[i]),E=x.useCallback(b=>{const v=b.target.value;o(!1),t(v),g.current&&clearTimeout(g.current),y(v)},[t,y]),S=x.useCallback(b=>{o(!0),u(!1),a([]),d(-1),t(b.name),s(b),g.current&&clearTimeout(g.current),setTimeout(()=>{o(!1),j.current&&j.current.blur()},50)},[t,s]),F=x.useCallback(b=>{if(!(!n||m.length===0||i))switch(b.key){case"ArrowDown":b.preventDefault(),d(v=>(v+1)%m.length);break;case"ArrowUp":b.preventDefault(),d(v=>v<=0?m.length-1:v-1);break;case"Enter":b.preventDefault(),h>=0&&h<m.length?S(m[h]):m.length===1&&S(m[0]);break;case"Escape":u(!1),d(-1);break}},[n,m,i,h,S]),V=x.useCallback(()=>{var b;o(!1),t(""),a([]),u(!1),d(-1),g.current&&clearTimeout(g.current),(b=j.current)==null||b.focus()},[t]),X=x.useCallback(()=>{i||l.trim()&&y(l)},[i,l,y]);return x.useEffect(()=>{const b=v=>{const k=v.target;j.current&&!j.current.contains(k)&&N.current&&!N.current.contains(k)&&(u(!1),d(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),g.current&&clearTimeout(g.current)}},[]),e.jsxs("div",{className:`relative ${r}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(de,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:j,type:"text",value:l,onChange:E,onKeyDown:F,onFocus:X,placeholder:c,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),l&&e.jsx("button",{onClick:V,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(J,{className:"h-4 w-4"})})]}),n&&m.length>0&&!i&&e.jsx("ul",{ref:N,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:m.map((b,v)=>e.jsx(ae,{shard:b,index:v,focusedIndex:h,onSelect:S,isSelecting:i,setFocusedIndex:d},b.key))})]})},ve=({onSubmit:l})=>{const{form:t,setForm:s}=O();D.useEffect(()=>(console.log("[CalculatorForm] Mounted"),()=>{console.log("[CalculatorForm] Unmounted")}),[]);const c=(a,n)=>{const u=T(L({},t),{[a]:n});s(u),setTimeout(()=>{l(u)},0)},r=()=>{const a=T(L({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10});s(a),setTimeout(()=>{l(a)},0)},m=()=>{const a=t.shard,n=t.quantity,u={shard:a,quantity:n,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1};s(u),setTimeout(()=>{l(u)},0)};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:a=>a.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(je,{value:t.shard,onChange:a=>c("shard",a),onSelect:a=>{let n="common";if(a&&typeof a.rarity=="string"){const d=a.rarity.toLowerCase();d in _&&(n=d)}const u=_[n],h=T(L({},t),{shard:a.name,quantity:u});s(h),setTimeout(()=>l(h),0),setTimeout(()=>{const d=document.querySelector('input[placeholder="1"]');d&&d.select()},0)},placeholder:"Search for a shard..."})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:a=>c("quantity",Number(a.target.value)),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),a.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:r,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:m,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:a=>c("hunterFortune",Number(a.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>c("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>c("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:a,label:n})=>e.jsx(ne,{value:t[a]||0,onChange:u=>c(a,u),label:n},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{value:t.kuudraTier||"t5",onChange:a=>c("kuudraTier",a),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0",value:t.moneyPerHour===0?"":t.moneyPerHour,onChange:a=>c("moneyPerHour",Number(a.target.value)),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),a.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins/hour"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},I=({tree:l,data:t,isTopLevel:s=!1,totalShardsProduced:c=l.quantity,nodeId:r,expandedStates:m,onToggle:a})=>{var f;const n=t.shards[l.shard],u=(f=m.get(r))!=null?f:!0;if(l.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[l.quantity,"x"]}),e.jsx("span",{className:`font-medium text-sm ${R(n.rarity)}`,title:A(n,!0),children:n.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-md",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:[z(n.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[n.type," • ",n.family]})]})]});const h=l.inputs[0],d=l.inputs[1],i=t.shards[h.shard],o=t.shards[d.shard],p=s?c:l.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>a(r),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[u?e.jsx(xe,{className:"w-4 h-4 text-slate-400"}):e.jsx(pe,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[p,"x "]}),e.jsx("span",{className:`font-medium ${R(n.rarity)} text-sm`,title:A(n,!1),children:n.name}),e.jsxs("span",{className:"text-slate-400 ml-1.5 text-sm",children:["= ",h.quantity,"x ",e.jsx("span",{className:R(i.rarity),children:i.name})," + ",d.quantity,"x"," ",e.jsx("span",{className:R(o.rarity),children:o.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:`font-medium text-white ${s?"text-sm":"text-xs"}`,children:p})]}),e.jsxs("div",{className:"text-slate-400 capitalize text-xs",children:[n.type," • ",n.family]})]})]})}),u&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(I,{tree:h,data:t,nodeId:`${r}-0`,expandedStates:m,onToggle:a}),e.jsx(I,{tree:d,data:t,nodeId:`${r}-1`,expandedStates:m,onToggle:a})]})]})},Ne=({result:l,data:t,targetShardName:s})=>{const[c,r]=x.useState(new Map),[m,a]=x.useState(""),n=(i,o="root")=>{const p=new Map,f=(j,N)=>{j.method==="recipe"&&j.inputs&&(p.set(N,!0),j.inputs.forEach((g,y)=>{f(g,`${N}-${y}`)}))};return f(i,o),p};D.useEffect(()=>{if(l.tree){const i=JSON.stringify(l.tree);if(i!==m){const o=n(l.tree);r(o),a(i)}}},[l.tree,m]);const u=()=>{const i=new Map(c);for(const o of i.keys())i.set(o,!0);r(i)},h=()=>{const i=new Map(c);for(const o of i.keys())i.set(o,!1);r(i)},d=i=>{const o=new Map(c);o.set(i,!o.get(i)),r(o)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(l.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(l.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(B,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:l.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(W,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[l.totalFusions,"x",l.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),l.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:M(l.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(W,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",l.totalShardsProduced," ",s," ",e.jsxs("span",{className:"text-slate-400",children:[l.craftsNeeded," craft",l.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(l.totalQuantities).map(([i,o])=>{const p=t.shards[i],f=o/p.rate;return e.jsx("div",{className:"bg-slate-700 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[o,"x ",e.jsx("span",{className:R(p.rarity),children:p.name})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[z(p.rate),e.jsx("span",{className:"text-slate-600 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs text-slate-400",children:M(f)})})]})},i)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(B,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(I,{tree:l.tree,data:t,isTopLevel:!0,totalShardsProduced:l.totalShardsProduced,nodeId:"root",expandedStates:c,onToggle:d})})]})]})},w=class w{static getInstance(){return w.instance||(w.instance=new w),w.instance}parseData(t){return C(this,null,function*(){var s,c;try{const[r,m]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),a=yield r.json(),n=yield m.json(),u={};for(const d in a.recipes){u[d]=[];for(const i in a.recipes[d]){const o=parseInt(i);a.recipes[d][i].forEach(f=>{u[d].push({inputs:f,outputQuantity:o})})}}const h={};for(const d in a.shards){let i=(c=(s=t.customRates[d])!=null?s:n[d])!=null?c:0;d==="L15"&&i===0&&(i=this.calculateKuudraRate(t.kuudraTier,t.moneyPerHour)),i>0&&(t.noWoodenBait&&le.includes(d)&&(i*=.05),ie.includes(d)||(i=this.applyFortuneModifiers(i,d,a.shards[d],t))),t.excludeChameleon&&d==="L4"&&(i=0),h[d]=T(L({},a.shards[d]),{id:d,rate:i})}return{recipes:u,shards:h}}catch(r){throw new Error(`Failed to parse data: ${r}`)}})}calculateKuudraRate(t,s){const r={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!r)return 0;const m=s===0?0:r.cost/s*3600;return r.multiplier*(3600/(r.baseTime+m))}applyFortuneModifiers(t,s,c,r){let m=r.hunterFortune;const a=1+5*r.tiamatLevel/100,n=1+2*r.seaSerpentLevel/100*a,u=2*r.pythonLevel/100*n,h=r.kingCobraLevel/100*n;switch(c.rarity){case"common":m+=2*r.newtLevel;break;case"uncommon":m+=2*r.salamanderLevel;break;case"rare":m+=r.lizardKingLevel;break;case"epic":m+=r.leviathanLevel;break}return r.frogPet&&(t*=1.1),s in q&&(q[s]&&(t*=1+u),m*=1+h),t*(1+m/100)}computeMinCosts(t){const s=new Map,c=new Map,r=Object.keys(t.shards),m=.8/3600;r.forEach(n=>{const u=t.shards[n].rate>0?1/t.shards[n].rate:1/0;s.set(n,u),c.set(n,{recipe:null})});let a=!0;for(;a;)a=!1,r.forEach(n=>{(t.recipes[n]||[]).forEach(h=>{const[d,i]=h.inputs,o=t.shards[d].fuse_amount,p=t.shards[i].fuse_amount,f=s.get(d)*o,j=s.get(i)*p,g=(f+j+m)/h.outputQuantity;g<s.get(n)&&(s.set(n,g),c.set(n,{recipe:h}),a=!0)})});return{minCosts:s,choices:c}}buildRecipeTree(t,s){const c=s.get(t);if(c.recipe===null)return{shard:t,method:"direct",quantity:0};{const r=c.recipe,[m,a]=r.inputs,n=this.buildRecipeTree(m,s),u=this.buildRecipeTree(a,s);return{shard:t,method:"recipe",recipe:r,inputs:[n,u],quantity:0}}}assignQuantities(t,s,c,r){if(t.quantity=s,t.method==="recipe"){const m=t.recipe,a=m.outputQuantity,n=Math.ceil(s/a);r.total+=n;const[u,h]=m.inputs,d=c.shards[u].fuse_amount,i=c.shards[h].fuse_amount,o=n*d,p=n*i;this.assignQuantities(t.inputs[0],o,c,r),this.assignQuantities(t.inputs[1],p,c,r)}}collectTotalQuantities(t){const s=new Map,c=r=>{if(r.method==="direct"){const m=s.get(r.shard)||0;s.set(r.shard,m+r.quantity)}else r.inputs.forEach(c)};return c(t),s}decimalHoursToHoursMinutes(t){const s=Math.floor(t),c=Math.round((t-s)*60);return s===0?`${c} minutes`:c===0||isNaN(c)?`${s} hours`:`${s} hours ${c} minutes`}calculateOptimalPath(t,s,c){return C(this,null,function*(){var N;const r=yield this.parseData(c);if(!r.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0,inputs:[]}};const{minCosts:m,choices:a}=this.computeMinCosts(r),n=this.buildRecipeTree(t,a),u={total:0};this.assignQuantities(n,s,r,u);const h=this.collectTotalQuantities(n);let d=s,i=1;const o=a.get(t);if(o!=null&&o.recipe){const g=o.recipe.outputQuantity;i=Math.ceil(s/g),d=i*g}const p=(N=m.get(t))!=null?N:0,f=p*d,j=u.total*.8/3600;return{timePerShard:p,totalTime:f,totalShardsProduced:d,craftsNeeded:i,totalQuantities:h,totalFusions:u.total,craftTime:j,tree:n}})}};H(w,"instance");let P=w;const ye=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:P},Symbol.toStringTag,{value:"Module"})),we=()=>{const[l,t]=x.useState(null),[s,c]=x.useState(!1),[r,m]=x.useState(null),a=x.useCallback((u,h,d)=>C(null,null,function*(){try{c(!0),m(null);const o=yield P.getInstance().calculateOptimalPath(u,h,d);t(o)}catch(i){m(i instanceof Error?i.message:"Calculation failed"),t(null)}finally{c(!1)}}),[]),n=x.useCallback(()=>{t(null),m(null)},[]);return{result:l,loading:s,error:r,calculate:a,clearResult:n}},Se=({onSubmit:l})=>{const{setForm:t}=O();return e.jsx(ve,{onSubmit:s=>l(s,t)})},Ce=()=>{const{result:l,setResult:t,calculationData:s,setCalculationData:c,targetShardName:r,setTargetShardName:m}=O(),{loading:a,error:n}=we(),{customRates:u}=ce(),[h,d]=x.useState(!1),i=(o,p)=>C(null,null,function*(){p(o);try{if(!o.shard||o.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}d(!1);const N=(yield U.getInstance().getShardNameToKeyMap())[o.shard.toLowerCase()];if(!N){console.warn(`Calculation skipped: Shard "${o.shard}" not found in data`);return}m(o.shard);const g={customRates:u,hunterFortune:o.hunterFortune,excludeChameleon:o.excludeChameleon,frogPet:o.frogPet,newtLevel:o.newtLevel,salamanderLevel:o.salamanderLevel,lizardKingLevel:o.lizardKingLevel,leviathanLevel:o.leviathanLevel,pythonLevel:o.pythonLevel,kingCobraLevel:o.kingCobraLevel,seaSerpentLevel:o.seaSerpentLevel,tiamatLevel:o.tiamatLevel,kuudraTier:o.kuudraTier,moneyPerHour:o.moneyPerHour,noWoodenBait:o.noWoodenBait},E=(yield oe(()=>Promise.resolve().then(()=>ye),void 0)).CalculationService.getInstance(),S=yield E.calculateOptimalPath(N,o.quantity,g);t(S);const F=yield E.parseData(g);c(F)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>d(!h),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm
              `,children:[h?e.jsx(J,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[h?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${h?"block":"hidden xl:block"}`,children:e.jsx(Se,{onSubmit:i})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[n&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:n})]})]}),l&&s&&e.jsx(Ne,{result:l,data:s,targetShardName:r}),!l&&!a&&!n&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(K,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>d(!0),className:`
                      px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 
                      text-purple-400 font-medium rounded-md 
                      border border-purple-500/20 hover:border-purple-500/30
                      transition-colors duration-200 text-sm
                      flex items-center space-x-2 mx-auto
                    `,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})},Pe=()=>e.jsx(Ce,{});export{Pe as CalculatorPage};
