var Ce=Object.defineProperty,ke=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var ie=(m,t,l)=>t in m?Ce(m,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[t]=l,V=(m,t)=>{for(var l in t||(t={}))Se.call(t,l)&&ie(m,l,t[l]);if(he)for(var l of he(t))Re.call(t,l)&&ie(m,l,t[l]);return m},J=(m,t)=>ke(m,Le(t));var pe=(m,t,l)=>ie(m,typeof t!="symbol"?t+"":t,l);var z=(m,t,l)=>new Promise((d,i)=>{var o=x=>{try{u(l.next(x))}catch(h){i(h)}},r=x=>{try{u(l.throw(x))}catch(h){i(h)}},u=x=>x.done?d(x.value):Promise.resolve(x.value).then(o,r);u((l=l.apply(m,t)).next())});import{d as Te,j as e,S as Ee,u as ce,M as fe,P as Me,f as A,K as Pe,a as se,T as X,g as $e,b as Z,c as te,W as Qe,N as Fe,B as ye,_ as be}from"./index-DFf8J8P1.js";import{r as k,R as ee}from"./vendor-e8ACzjHW.js";import{D as ae,S as q,u as _e}from"./useCustomRates-BQl1zBdX.js";import{b as Ie,X as we,S as Oe,Z as Ke,R as He,M as We,a as ze,c as Ae,d as qe,T as Be,e as ge,H as je,f as ve,g as Ue}from"./icons-DR3cHNnz.js";import"./forms-B7jjzPDX.js";function Ve(m){return z(this,null,function*(){return!m||typeof m!="string"?!1:!!(yield ae.getInstance().getShardNameToKeyMap())[m.trim().toLowerCase()]})}const Je=({value:m,onChange:t,onSelect:l,onFocus:d,placeholder:i="Search for a shard...",className:o=""})=>{const[r,u]=k.useState([]),[x,h]=k.useState(!1),[s,n]=k.useState(-1),[c,a]=k.useState(!1),[f,y]=k.useState(!1),p=k.useRef(null),j=k.useRef(null),N=k.useRef(null),Q=k.useMemo(()=>Te(C=>z(null,null,function*(){if(C.length===0||c){u([]),h(!1),y(!1);return}y(!0);try{const B=yield ae.getInstance().searchShards(C);u(B.slice(0,10)),h(B.length>0),n(-1)}catch($){console.error("Search failed:",$),u([]),h(!1)}finally{y(!1)}}),100),[c]),H=k.useCallback(C=>{const $=C.target.value;a(!1),t($),N.current&&clearTimeout(N.current),Q($)},[t,Q]),v=k.useCallback(C=>{a(!0),h(!1),u([]),n(-1),t(C.name),l(C),N.current&&clearTimeout(N.current),setTimeout(()=>{a(!1),p.current&&p.current.blur()},50)},[t,l]),L=k.useCallback(C=>{if(!(!x||r.length===0||c))switch(C.key){case"ArrowDown":C.preventDefault(),n($=>($+1)%r.length);break;case"ArrowUp":C.preventDefault(),n($=>$<=0?r.length-1:$-1);break;case"Enter":C.preventDefault(),s>=0&&s<r.length?v(r[s]):r.length===1&&v(r[0]);break;case"Escape":h(!1),n(-1);break}},[x,r,c,s,v]),T=k.useCallback(()=>{var C;a(!1),t(""),u([]),h(!1),n(-1),N.current&&clearTimeout(N.current),(C=p.current)==null||C.focus()},[t]),W=k.useCallback(()=>{c||m.trim()&&Q(m)},[c,m,Q]);return k.useEffect(()=>{const C=$=>{const B=$.target;p.current&&!p.current.contains(B)&&j.current&&!j.current.contains(B)&&(h(!1),n(-1))};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C),N.current&&clearTimeout(N.current)}},[]),e.jsxs("div",{className:`relative ${o}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:f?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(Ie,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:p,type:"text",value:m,onChange:H,onKeyDown:L,onFocus:()=>{d&&d(),W()},placeholder:i,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),m&&e.jsx("button",{onClick:T,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(we,{className:"h-4 w-4"})})]}),x&&r.length>0&&!c&&e.jsx("ul",{ref:j,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:r.map((C,$)=>e.jsx(Ee,{shard:C,index:$,focusedIndex:s,onSelect:v,isSelecting:c,setFocusedIndex:n},C.key))})]})},Xe=({onSubmit:m})=>{const{form:t,setForm:l}=ce();ee.useEffect(()=>{z(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Ve(t.shard))&&m(J(V({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const d=(s,n)=>{const c=J(V({},t),{[s]:n});l(c),s!=="shard"&&s!=="quantity"&&m(c)},i=()=>{const s=J(V({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});l(s),setTimeout(()=>{m(s)},0)},o=()=>{const s=t.shard,n=t.quantity,c={shard:s,quantity:n,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};l(c),x(""),setTimeout(()=>{m(c)},0)};function r(s){if(!s)return 0;const n=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!n)return Number(s.replace(/,/g,""))||0;let c=parseFloat(n[1].replace(/,/g,""));const a=n[2];return a==="k"?c*=1e3:a==="m"?c*=1e6:a==="b"&&(c*=1e9),Math.round(c)}const[u,x]=ee.useState("");ee.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&u===""&&(d("moneyPerHour",1/0),m(J(V({},t),{moneyPerHour:1/0})))},[t.shard]),ee.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&u!==""&&x("")},[t.moneyPerHour]);const h=()=>{t.shard&&d("shard","")};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(Je,{value:t.shard,onChange:s=>d("shard",s),onSelect:s=>{let n="common";if(s&&typeof s.rarity=="string"){const f=s.rarity.toLowerCase();f in fe&&(n=f)}const c=fe[n],a=J(V({},t),{shard:s.name,quantity:c});l(a),setTimeout(()=>m(a),0)},onFocus:h,placeholder:"Search for a shard..."})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>d("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:i,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:o,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>d("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>d("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>d("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt",shardId:"C35"},{key:"salamanderLevel",label:"Salamander",shardId:"U8"},{key:"lizardKingLevel",label:"Lizard King",shardId:"R8"},{key:"leviathanLevel",label:"Leviathan",shardId:"E5"},{key:"pythonLevel",label:"Python",shardId:"R9"},{key:"kingCobraLevel",label:"King Cobra",shardId:"R54"},{key:"seaSerpentLevel",label:"Sea Serpent",shardId:"E32"},{key:"tiamatLevel",label:"Tiamat",shardId:"L6"},{key:"crocodileLevel",label:"Crocodile",shardId:"R45"}].map(({key:s,label:n,shardId:c})=>{var f;const a=q[c];return e.jsx(Me,{value:t[s]||0,onChange:y=>d(s,y),label:n,tooltipTitle:a==null?void 0:a.title,tooltipContent:A((a==null?void 0:a.description)||"No description available."),tooltipShardName:n,tooltipShardIcon:c,tooltipRarity:((f=a==null?void 0:a.rarity)==null?void 0:f.toLowerCase())||"common",tooltipFamily:a==null?void 0:a.family,tooltipType:a==null?void 0:a.type,tooltipWarning:s==="crocodileLevel"?"Warning: May slow calculations significantly":void 0},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{value:t.kuudraTier||"none",onChange:s=>d("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:u,onChange:s=>{if(x(s.target.value),s.target.value.trim()==="")d("moneyPerHour",1/0),m(J(V({},t),{moneyPerHour:1/0}));else{const n=r(s.target.value);d("moneyPerHour",n)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},le=({tree:m,data:t,isTopLevel:l=!1,totalShardsProduced:d=m.quantity,nodeId:i,expandedStates:o,onToggle:r})=>{var W,C,$,B,oe,de;const u=t.shards[m.shard],x=P=>{const b=t.recipes[P];if(!(b!=null&&b.length))return null;const g={U8:M=>M.inputs.includes("C35")&&M.inputs.includes("U38"),C35:M=>M.inputs.includes("C23")&&M.inputs.includes("U38")}[P];return g?b.find(g):b.sort((M,S)=>S.outputQuantity-M.outputQuantity)[0]},h=P=>P?e.jsx(ze,{className:"w-4 h-4 text-amber-400"}):e.jsx(Ae,{className:"w-4 h-4 text-amber-400"}),s=(P,b,F=!0)=>{var M;const g=q[b.id];return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-white",children:[P,"x"]}),e.jsx(X,{content:A((g==null?void 0:g.description)||"No description available."),title:g==null?void 0:g.title,shardName:b.name,shardIcon:b.id,rarity:((M=g==null?void 0:g.rarity)==null?void 0:M.toLowerCase())||b.rarity,family:g==null?void 0:g.family,type:g==null?void 0:g.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${b.id}.png`,alt:b.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(b.rarity),children:b.name})]})}),F&&e.jsxs("div",{className:"text-right min-w-[80px] ml-2",children:[e.jsx("span",{className:"text-slate-300 text-xs font-medium",children:se(b.rate)}),e.jsx("span",{className:"text-slate-500 text-xs mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})]})},n=(P,b,F,g,M,S,_=!1,I)=>{var U,O,K;const w=q[b.id],R=q[g.id],E=q[S.id];return e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 text-sm font-medium",children:[_&&e.jsxs("span",{className:"font-normal text-xs text-amber-300",children:["Step ",I," :"]}),e.jsxs("span",{className:"text-white",children:[P,"x"]}),e.jsx(X,{content:A((w==null?void 0:w.description)||"No description available."),title:w==null?void 0:w.title,shardName:b.name,shardIcon:b.id,rarity:((U=w==null?void 0:w.rarity)==null?void 0:U.toLowerCase())||b.rarity,family:w==null?void 0:w.family,type:w==null?void 0:w.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${b.id}.png`,alt:b.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(b.rarity),children:b.name})]})}),e.jsx("span",{children:" = "}),e.jsxs("span",{className:"text-slate-400",children:[F,"x"]}),e.jsx(X,{content:A((R==null?void 0:R.description)||"No description available."),title:R==null?void 0:R.title,shardName:g.name,shardIcon:g.id,rarity:((O=R==null?void 0:R.rarity)==null?void 0:O.toLowerCase())||g.rarity,family:R==null?void 0:R.family,type:R==null?void 0:R.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(g.rarity),children:g.name})]})}),e.jsx("span",{children:" + "}),e.jsxs("span",{className:"text-slate-400",children:[M,"x"]}),e.jsx(X,{content:A((E==null?void 0:E.description)||"No description available."),title:(E==null?void 0:E.title)||S.name,shardName:S.name,shardIcon:S.id,rarity:((K=E==null?void 0:E.rarity)==null?void 0:K.toLowerCase())||S.rarity,family:E==null?void 0:E.family,type:E==null?void 0:E.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${S.id}.png`,alt:S.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(S.rarity),children:S.name})]})})]})},c=(P,b)=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s(P,b,!1),e.jsx("span",{className:"px-1 py-0.4 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right min-w-[80px] ml-2",children:[e.jsx("span",{className:"text-slate-300 text-xs font-medium",children:se(b.rate)}),e.jsx("span",{className:"text-slate-500 text-xs mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})]}),a=(P,b,F,g=1)=>{var U;const M=P.outputQuantity,S=t.shards[P.inputs[0]],_=t.shards[P.inputs[1]],I=S.fuse_amount,w=_.fuse_amount,R=`${F}-${b.id}`,E=(U=o.get(R))!=null?U:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>r(R),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h(E),n(M,b,I,S,w,_)]}),e.jsx("div",{className:"text-right min-w-[80px] ml-2",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:"1"})]})})]}),E&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 flex flex-col gap-0.5",children:P.inputs.map(O=>{const K=t.shards[O];if(!K)return null;const D=x(O);return O==="C11"||O==="U38"||O==="C23"?e.jsx("div",{children:c(K.fuse_amount,K)},`direct-${O}`):D&&g<2?e.jsx("div",{children:a(D,K,R,g+1)},`sub-${O}`):null})})]})};if(m.method==="cycle"){const P=(W=o.get(i))!=null?W:!0,b=m.cycles.reduce((F,g)=>F+g.expectedCrafts,0);return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors",onClick:()=>r(i),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h(P),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-xs text-amber-300",children:[b," crafts"]}),e.jsx(We,{className:"w-4 text-amber-400"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s(Math.floor(m.quantity),u,!1),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-[11px] font-medium rounded-md",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:b})]})})]}),P&&m.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:m.cycles.map((F,g)=>e.jsxs("div",{children:[e.jsx("div",{className:"space-y-0.5",children:[...F.steps].slice().reverse().map((M,S)=>{var D;const _=M.recipe,I=t.shards[M.outputShard],w=t.shards[_.inputs[0]],R=t.shards[_.inputs[1]],E=w.fuse_amount,U=R.fuse_amount;let O=_.outputQuantity;_.isReptile&&(O*=F.multiplier);const K=F.steps.length-S;if(K===1){const re=`${i}-step-${K}`,ue=(D=o.get(re))!=null?D:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>r(re),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h(ue),n(O,I,E,w,U,R,!0,K)]}),e.jsx("div",{className:"text-right min-w-[80px] ml-2",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:F.expectedCrafts})]})})]}),ue&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-1",children:_.inputs.map(G=>{const me=t.shards[G],xe=x(G);return xe&&me&&G!=="C11"&&G!=="U38"&&G!=="C23"?e.jsx("div",{className:"space-y-1",children:a(xe,me,i)},G):null})})]},S)}else return e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between",children:[n(O,I,E,w,U,R,!0,K),e.jsx("div",{className:"text-right min-w-[80px] ml-2",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:F.expectedCrafts})]})})]},S)})}),(()=>{const M=new Set(F.steps.map(_=>_.outputShard)),S={};return F.steps.forEach(_=>{_.recipe.inputs.forEach(I=>{const w=t.shards[I];!w||M.has(I)||(S[I]||(S[I]={quantity:0,shard:w}),S[I].quantity+=w.fuse_amount)})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(S).map(({quantity:_,shard:I})=>e.jsx("div",{children:c(_*b,I)},I.id))})})()]},g))})]})}if(m.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s(m.quantity,u,!1),e.jsx("span",{className:"px-1 py-0.4 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[se(u.rate),e.jsx("span",{className:"text-slate-500 text-xs mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})})]});const f=(C=o.get(i))!=null?C:!0,y=m.inputs[0],p=m.inputs[1],j=t.shards[y.shard],N=t.shards[p.shard],Q="craftsNeeded"in m&&($=m.craftsNeeded)!=null?$:1,H=l?d:m.quantity,v=q[u.id],L=q[j.id],T=q[N.id];return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>r(i),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5 p-0.5",children:[h(f),e.jsxs("div",{className:"text-white flex items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:[Math.floor(H),"x"]}),e.jsx(X,{content:A((v==null?void 0:v.description)||"No description available."),title:v==null?void 0:v.title,shardName:u.name,shardIcon:u.id,rarity:((B=v==null?void 0:v.rarity)==null?void 0:B.toLowerCase())||u.rarity,family:v==null?void 0:v.family,type:v==null?void 0:v.type,className:"cursor-pointer mx-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${u.id}.png`,alt:u.name,className:"w-5 h-5 object-contain inline-block align-middle flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium ${Z(u.rarity)} text-sm whitespace-nowrap truncate`,style:{maxWidth:"8rem"},title:$e(u,!1),children:u.name})]})}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center",children:[e.jsx("span",{className:"mx-2 text-white",children:"="}),e.jsxs("span",{children:[Math.floor(y.quantity),"x"]}),e.jsx(X,{content:A((L==null?void 0:L.description)||"No description available."),title:L==null?void 0:L.title,shardName:j.name,shardIcon:j.id,rarity:((oe=L==null?void 0:L.rarity)==null?void 0:oe.toLowerCase())||j.rarity,family:L==null?void 0:L.family,type:L==null?void 0:L.type,className:"cursor-pointer mx-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${j.id}.png`,alt:j.name,className:"w-5 h-5 object-contain inline-block align-middle flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(j.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:j.name})]})}),e.jsx("span",{className:"mx-2 text-white",children:"+"}),e.jsxs("span",{children:[Math.floor(p.quantity),"x"]}),e.jsx(X,{content:A((T==null?void 0:T.description)||"No description available."),title:T==null?void 0:T.title,shardName:N.name,shardIcon:N.id,rarity:((de=T==null?void 0:T.rarity)==null?void 0:de.toLowerCase())||N.rarity,family:T==null?void 0:T.family,type:T==null?void 0:T.type,className:"cursor-pointer mx-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${N.id}.png`,alt:N.name,className:"w-5 h-5 object-contain inline-block align-middle flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:Z(N.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:N.name})]})})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:Q})]})})]})}),f&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(le,{tree:y,data:t,nodeId:`${i}-0`,expandedStates:o,onToggle:r}),e.jsx(le,{tree:p,data:t,nodeId:`${i}-1`,expandedStates:o,onToggle:r})]})]})},Ze=({result:m,data:t,targetShardName:l})=>{const[d,i]=k.useState(new Map),[o,r]=k.useState(""),u=(n,c="root")=>{const a=new Map,f=(y,p)=>{y.method==="recipe"&&y.inputs&&(a.set(p,!0),y.inputs.forEach((j,N)=>{f(j,`${p}-${N}`)}))};return f(n,c),a};ee.useEffect(()=>{if(m.tree){const n=JSON.stringify(m.tree);if(n!==o){const c=u(m.tree);i(c),r(n)}}},[m.tree,o]);const x=()=>{const n=new Map(d);for(const c of n.keys())n.set(c,!0);i(n)},h=()=>{const n=new Map(d);for(const c of n.keys())n.set(c,!1);i(n)},s=n=>{const c=new Map(d);c.set(n,!c.get(n)),i(c)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:te(m.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Be,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:te(m.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:Math.floor(m.totalShardsProduced)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[m.totalFusions,"x",m.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),m.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:te(m.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",Math.floor(m.totalShardsProduced)," ",l," ",e.jsxs("span",{className:"text-slate-400",children:[Math.floor(m.craftsNeeded)," craft",Math.floor(m.craftsNeeded)>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(m.totalQuantities).map(([n,c])=>{var j;const a=t.shards[n],f=c,y=f/a.rate,p=q[a.id];return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[f,"x"]}),e.jsx(X,{content:A((p==null?void 0:p.description)||"No description available."),title:p==null?void 0:p.title,shardName:a.name,shardIcon:a.id,rarity:((j=p==null?void 0:p.rarity)==null?void 0:j.toLowerCase())||a.rarity,family:p==null?void 0:p.family,type:p==null?void 0:p.type,className:"cursor-pointer",children:e.jsxs("span",{className:`mt-0 font-medium text-sm ${Z(a.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${a.id}.png`,alt:a.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),a.name]})})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[se(a.rate)," ",e.jsx("span",{className:"text-slate-500",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:te(y)})]})]},n)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(ge,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-[650px]",children:e.jsx(le,{tree:m.tree,data:t,isTopLevel:!0,totalShardsProduced:m.totalShardsProduced,nodeId:"root",expandedStates:d,onToggle:s})})})]})]})},Y=class Y{static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}parseData(t){return z(this,null,function*(){var l,d;try{const[i,o]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),r=yield i.json(),u=yield o.json(),x={};for(const s in r.recipes){x[s]=[];for(const n in r.recipes[s]){const c=parseInt(n);r.recipes[s][n].forEach(f=>{const y=f.some(p=>r.shards[p].family.includes("Reptile"));x[s].push({inputs:f,outputQuantity:c,isReptile:y})})}}const h={};for(const s in r.shards){let n=(d=(l=t.customRates[s])!=null?l:u[s])!=null?d:0;if(s==="L15"&&n===0){const c=t.moneyPerHour==null?1/0:t.moneyPerHour;n=this.calculateKuudraRate(t.kuudraTier,c)}n>0&&(t.noWoodenBait&&Qe.includes(s)&&(n*=.05),Fe.includes(s)||(n=this.applyFortuneModifiers(n,s,r.shards[s],t))),t.excludeChameleon&&s==="L4"&&(n=0),h[s]=J(V({},r.shards[s]),{id:s,rate:n})}return{recipes:x,shards:h}}catch(i){throw new Error(`Failed to parse data: ${i}`)}})}calculateKuudraRate(t,l){const i={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!i)return 0;let o;return l===1/0?o=0:l===0?o=1e12:o=i.cost/l*3600,i.multiplier*(3600/(i.baseTime+o))}applyFortuneModifiers(t,l,d,i){let o=i.hunterFortune;const r=1+5*i.tiamatLevel/100,u=1+2*i.seaSerpentLevel/100*r,x=2*i.pythonLevel/100*u,h=i.kingCobraLevel/100*u;switch(d.rarity){case"common":o+=2*i.newtLevel;break;case"uncommon":o+=2*i.salamanderLevel;break;case"rare":o+=i.lizardKingLevel;break;case"epic":o+=i.leviathanLevel;break}return i.frogPet&&(t*=1.1),l in ye&&(ye[l]&&(t*=1+x),o*=1+h),t*(1+o/100)}computeMinCosts(t,l,d,i){const o=new Map,r=new Map,u=Object.keys(t.shards),x=1+5*i/100,h=1+2*d/100*x,s=1+2*l/100*h,n=.8/3600;u.forEach(a=>{const f=t.shards[a].rate>0?1/t.shards[a].rate:1/0;o.set(a,f),r.set(a,{recipe:null})});let c=!0;for(;c;)c=!1,u.forEach(a=>{(t.recipes[a]||[]).forEach(y=>{const[p,j]=y.inputs,N=t.shards[p].fuse_amount,Q=t.shards[j].fuse_amount,H=o.get(p)*N,v=o.get(j)*Q,L=H+v+n,T=y.isReptile?y.outputQuantity*s:y.outputQuantity,W=L/T;W<o.get(a)&&(o.set(a,W),r.set(a,{recipe:y}),c=!0)})});return{minCosts:o,choices:r}}findCycleNodes(t){const l=new Map;for(const[s,n]of t)n.recipe&&l.set(s,n.recipe.inputs);let d=0;const i=new Map,o=new Map,r=new Map,u=[],x=[],h=s=>{var c;i.set(s,d),o.set(s,d),d++,u.push(s),r.set(s,!0);const n=l.get(s)||[];for(const a of n)l.has(a)&&(i.has(a)?r.get(a)&&o.set(s,Math.min(o.get(s),i.get(a))):(h(a),o.set(s,Math.min(o.get(s),o.get(a)))));if(o.get(s)===i.get(s)){const a=[];let f;do f=u.pop(),r.set(f,!1),a.push(f);while(f!==s);(a.length>1||a.length===1&&((c=l.get(s))!=null&&c.includes(s)))&&x.push(a)}};for(const s of l.keys())i.has(s)||h(s);return x}buildCycle(t,l,d){const i=[];for(const o of d)if(o.includes(t)){const r=[];for(const u of o){const x=l.get(u);x!=null&&x.recipe&&r.push({outputShard:u,recipe:x.recipe})}i.push(r)}return i}buildRecipeTree(t,l,d,i){if(i.flat().includes(l)){const r=this.buildCycle(l,d,i),{minCosts:u,choices:x}=this.computeMinCosts(t,0,0,0),h=i.flat().reduce((c,a)=>u.get(a)<u.get(c)?a:c,i.flat()[0]),s=this.buildRecipeTree(t,h,x,[]),n={total:0};return this.assignQuantities(s,t.shards[h].fuse_amount,t,n,x,1),{shard:l,method:"cycle",quantity:0,cycles:r.map(c=>({steps:c,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0,inputRecipe:s}}const o=d.get(l);if(o.recipe===null)return{shard:l,method:"direct",quantity:0};{const r=o.recipe,[u,x]=r.inputs,h=this.buildRecipeTree(t,u,d,i),s=this.buildRecipeTree(t,x,d,i);return i.flat().includes(l)?{shard:l,method:"cycleNode",recipe:r,inputs:[h,s],quantity:0,craftsNeeded:0}:{shard:l,method:"recipe",recipe:r,inputs:[h,s],quantity:0,craftsNeeded:0}}}assignQuantities(t,l,d,i,o,r){switch(t.quantity=l,t.method){case"recipe":{const u=t.recipe,x=u.isReptile?u.outputQuantity*r:u.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,i.total+=h;const[s,n]=u.inputs,c=d.shards[s].fuse_amount,a=d.shards[n].fuse_amount,f=h*c,y=h*a;this.assignQuantities(t.inputs[0],f,d,i,o,r),this.assignQuantities(t.inputs[1],y,d,i,o,r);break}case"cycleNode":{const u=t.recipe,x=u.isReptile?u.outputQuantity*r:u.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,i.total+=h;const[s,n]=u.inputs,c=d.shards[s].fuse_amount,a=d.shards[n].fuse_amount;this.assignQuantities(t.inputs[0],c,d,i,o,r),this.assignQuantities(t.inputs[1],a,d,i,o,r);break}case"cycle":for(const u of t.cycles){const x=u.steps.find(y=>y.outputShard===t.shard);if(!x)continue;const h=x.recipe,s=h.outputQuantity,n=h.isReptile?s*r:s;let c=0;u.steps.forEach(y=>{y.recipe.inputs.forEach(p=>{if(p===t.shard){const j=d.shards[p];c+=j.fuse_amount}})});const a=n-c,f=a>0?Math.ceil(l/a):Math.ceil(l/n);u.expectedCrafts=f,u.expectedOutput=n,u.baseOutput=s,u.multiplier=r,i.total+=f*u.steps.length}if(t.craftsNeeded=t.cycles.reduce((u,x)=>u+(x.expectedCrafts||0),0),t.cycles.length>0){const u=t.cycles[0].expectedCrafts,x=new Map;t.cycles[0].steps.forEach(s=>{s.recipe.inputs.forEach(n=>{const c=d.shards[n],a=x.get(n)||0;x.set(n,a+c.fuse_amount)})});const h=new Set(t.cycles[0].steps.map(s=>s.outputShard));x.forEach((s,n)=>{if(!h.has(n)){const c=s*u,a=o.get(n);if(a&&a.recipe){const f=this.buildRecipeTree(d,n,o,[]);this.assignQuantities(f,c,d,i,o,r)}}})}break}}collectTotalQuantities(t,l){const d=new Map,i=o=>{switch(o.method){case"direct":d.set(o.shard,(d.get(o.shard)||0)+o.quantity);break;case"recipe":case"cycleNode":o.inputs.forEach(i);break;case"cycle":if(o.cycles.length>0){for(const r of o.cycles){const x=o.cycles[0].expectedCrafts,h=new Map;r.steps.forEach(s=>{const[n,c]=s.recipe.inputs,a=l.shards[n].fuse_amount,f=l.shards[c].fuse_amount;l.shards[n].family.includes("Reptile")||h.set(n,(h.get(n)||0)+x*a),l.shards[c].family.includes("Reptile")||h.set(c,(h.get(c)||0)+x*f)}),h.forEach((s,n)=>{d.set(n,(d.get(n)||0)+s)})}i(o.inputRecipe)}break}};return i(t),d}calculateOptimalPath(t,l,d){return z(this,null,function*(){var H;const i=yield this.parseData(d);if(!i.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:o,choices:r}=this.computeMinCosts(i,d.crocodileLevel,d.seaSerpentLevel,d.tiamatLevel),u=d.crocodileLevel>0?this.findCycleNodes(r):[],x=this.buildRecipeTree(i,t,r,u),h={total:0},s=1+5*d.tiamatLevel/100,n=1+2*d.seaSerpentLevel/100*s,c=1+2*d.crocodileLevel/100*n;this.assignQuantities(x,l,i,h,r,c);const a=this.collectTotalQuantities(x,i);let f=l,y=1;const p=r.get(t);if(p!=null&&p.recipe){const v=p.recipe.isReptile?p.recipe.outputQuantity*c:p.recipe.outputQuantity;y=Math.ceil(l/v),f=y*v}const j=(H=o.get(t))!=null?H:0,N=j*f,Q=h.total*.8/3600;return{timePerShard:j,totalTime:N,totalShardsProduced:f,craftsNeeded:y,totalQuantities:a,totalFusions:h.total,craftTime:Q,tree:x}})}};pe(Y,"instance");let ne=Y;const Ne=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:ne},Symbol.toStringTag,{value:"Module"})),Ye=()=>{const[m,t]=k.useState(null),[l,d]=k.useState(!1),[i,o]=k.useState(null),r=k.useCallback((x,h,s)=>z(null,null,function*(){try{d(!0),o(null);const c=yield ne.getInstance().calculateOptimalPath(x,h,s);t(c)}catch(n){o(n instanceof Error?n.message:"Calculation failed"),t(null)}finally{d(!1)}}),[]),u=k.useCallback(()=>{t(null),o(null)},[]);return{result:m,loading:l,error:i,calculate:r,clearResult:u}},Ge=({onSubmit:m})=>{const{setForm:t}=ce();return e.jsx(Xe,{onSubmit:l=>m(l,t)})},De=()=>{const{result:m,setResult:t,calculationData:l,setCalculationData:d,targetShardName:i,setTargetShardName:o,form:r}=ce(),{loading:u,error:x}=Ye(),{customRates:h}=_e(),[s,n]=k.useState(!1),c=(a,f)=>z(null,null,function*(){f(a);try{if(!a.shard||a.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}n(!1);const j=(yield ae.getInstance().getShardNameToKeyMap())[a.shard.toLowerCase()];if(!j){console.warn(`Calculation skipped: Shard "${a.shard}" not found in data`);return}o(a.shard);const Q={customRates:Object.fromEntries(Object.entries(h).filter(([,W])=>W!==void 0)),hunterFortune:a.hunterFortune,excludeChameleon:a.excludeChameleon,frogPet:a.frogPet,newtLevel:a.newtLevel,salamanderLevel:a.salamanderLevel,lizardKingLevel:a.lizardKingLevel,leviathanLevel:a.leviathanLevel,pythonLevel:a.pythonLevel,kingCobraLevel:a.kingCobraLevel,seaSerpentLevel:a.seaSerpentLevel,tiamatLevel:a.tiamatLevel,crocodileLevel:a.crocodileLevel,kuudraTier:a.kuudraTier,moneyPerHour:a.moneyPerHour,noWoodenBait:a.noWoodenBait},v=(yield be(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),L=yield v.calculateOptimalPath(j,a.quantity,Q);t(L);const T=yield v.parseData(Q);d(T)}catch(y){y instanceof Error&&!y.message.includes("not found")&&console.error("Calculation failed:",y)}});return k.useEffect(()=>{r&&r.shard&&r.shard.trim()!==""&&z(null,null,function*(){try{const y=(yield ae.getInstance().getShardNameToKeyMap())[r.shard.toLowerCase()];if(!y)return;o(r.shard);const j={customRates:Object.fromEntries(Object.entries(h).filter(([,L])=>L!==void 0)),hunterFortune:r.hunterFortune,excludeChameleon:r.excludeChameleon,frogPet:r.frogPet,newtLevel:r.newtLevel,salamanderLevel:r.salamanderLevel,lizardKingLevel:r.lizardKingLevel,leviathanLevel:r.leviathanLevel,pythonLevel:r.pythonLevel,kingCobraLevel:r.kingCobraLevel,seaSerpentLevel:r.seaSerpentLevel,tiamatLevel:r.tiamatLevel,crocodileLevel:r.crocodileLevel,kuudraTier:r.kuudraTier,moneyPerHour:r.moneyPerHour,noWoodenBait:r.noWoodenBait},Q=(yield be(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),H=yield Q.calculateOptimalPath(y,r.quantity,j);t(H);const v=yield Q.parseData(j);d(v)}catch(a){a instanceof Error&&!a.message.includes("not found")&&console.error("Calculation failed (customRates effect):",a)}})},[h,r,t,d,o]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-1 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>n(!s),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm cursor-pointer
              `,children:[s?e.jsx(we,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[s?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${s?"block":"hidden xl:block"}`,children:e.jsx(Ge,{onSubmit:c})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),m&&l&&e.jsx(Ze,{result:m,data:l,targetShardName:i}),!m&&!u&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},it=()=>e.jsx(De,{});export{it as CalculatorPage};
