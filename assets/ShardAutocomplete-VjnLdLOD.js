var I=(h,o,m)=>new Promise((x,g)=>{var k=a=>{try{c(m.next(a))}catch(n){g(n)}},r=a=>{try{c(m.throw(a))}catch(n){g(n)}},c=a=>a.done?x(a.value):Promise.resolve(a.value).then(k,r);c((m=m.apply(h,o)).next())});import{e as O,j as l,k as W}from"./index-u6FzULRB.js";import{r as t}from"./vendor-Dt516RNf.js";import{D as F}from"./dataService-BdYs6t7D.js";import{h as K,X as L}from"./icons-CTof7oRV.js";const X=({value:h,onChange:o,onSelect:m,onFocus:x,placeholder:g="Search for a shard...",className:k=""})=>{const[r,c]=t.useState([]),[a,n]=t.useState(!1),[p,u]=t.useState(-1),[i,S]=t.useState(!1),[N,j]=t.useState(!1),[D,C]=t.useState(void 0),f=t.useRef(null),y=t.useRef(null),d=t.useRef(null),w=t.useMemo(()=>O(e=>I(null,null,function*(){if(e.length===0||i){c([]),n(!1),j(!1);return}j(!0);try{const b=yield F.getInstance().searchShards(e);c(b.slice(0,10)),n(b.length>0),u(-1)}catch(s){console.error("Search failed:",s),c([]),n(!1)}finally{j(!1)}}),100),[i]),E=t.useCallback(e=>{const s=e.target.value;S(!1),o(s),d.current&&clearTimeout(d.current),w(s)},[o,w]),v=t.useCallback(e=>{S(!0),n(!1),c([]),u(-1),o(e.name),m(e),d.current&&clearTimeout(d.current),setTimeout(()=>{S(!1),f.current&&f.current.blur()},50)},[o,m]),R=t.useCallback(e=>{if(!(!a||r.length===0||i))switch(e.key){case"ArrowDown":e.preventDefault(),u(s=>(s+1)%r.length);break;case"ArrowUp":e.preventDefault(),u(s=>s<=0?r.length-1:s-1);break;case"Enter":e.preventDefault(),p>=0&&p<r.length?v(r[p]):r.length===1&&v(r[0]);break;case"Escape":n(!1),u(-1);break}},[a,r,i,p,v]),T=t.useCallback(()=>{var e;S(!1),o(""),c([]),n(!1),u(-1),d.current&&clearTimeout(d.current),(e=f.current)==null||e.focus()},[o]),A=t.useCallback(()=>{i||(f.current&&C(f.current.offsetWidth),h.trim()&&w(h))},[i,h,w]);return t.useEffect(()=>{const e=s=>{const b=s.target;f.current&&!f.current.contains(b)&&y.current&&!y.current.contains(b)&&(n(!1),u(-1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e),d.current&&clearTimeout(d.current)}},[]),l.jsxs("div",{className:`relative ${k}`,children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:N?l.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):l.jsx(K,{className:"h-4 w-4 text-slate-400"})}),l.jsx("input",{ref:f,type:"text",value:h,onChange:E,onKeyDown:R,onFocus:()=>{x&&x(),A()},placeholder:g,className:"w-full pl-10 pr-10 py-2.5 bg-slate-700/50 border border-slate-600/50 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 hover:bg-slate-700/70 transition-colors",autoComplete:"off",spellCheck:!1}),h&&l.jsx("button",{onClick:T,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:l.jsx(L,{className:"h-4 w-4"})})]}),a&&r.length>0&&!i&&l.jsx("ul",{ref:y,className:"absolute z-50 mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",style:{width:D?`${D}px`:"100%"},children:r.map((e,s)=>l.jsx(W,{shard:e,index:s,focusedIndex:p,onSelect:v,isSelecting:i,setFocusedIndex:u},e.key))})]})};export{X as S};
