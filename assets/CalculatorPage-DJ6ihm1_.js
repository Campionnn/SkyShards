var ie=Object.defineProperty,ce=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var A=(u,t,r)=>t in u?ie(u,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[t]=r,$=(u,t)=>{for(var r in t||(t={}))de.call(t,r)&&A(u,r,t[r]);if(B)for(var r of B(t))ue.call(t,r)&&A(u,r,t[r]);return u},M=(u,t)=>ce(u,oe(t));var D=(u,t,r)=>A(u,typeof t!="symbol"?t+"":t,r);var P=(u,t,r)=>new Promise((c,d)=>{var l=m=>{try{h(r.next(m))}catch(s){d(s)}},i=m=>{try{h(r.throw(m))}catch(s){d(s)}},h=m=>m.done?c(m.value):Promise.resolve(m.value).then(l,i);h((r=r.apply(u,t)).next())});import{d as me,j as e,S as he,u as W,M as U,P as xe,K as pe,g as T,f as Q,a as V,b as _,W as fe,N as be,B as J,_ as X}from"./index-BKc4ShqK.js";import{r as y,R as K}from"./vendor-e8ACzjHW.js";import{D as H,u as ge}from"./useCustomRates--fFrVg9p.js";import{b as ye,X as ae,S as je,Z as ve,R as Ne,a as Z,c as Y,d as we,T as Se,e as G,H as ee,M as te,f as ke}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";function Ce(u){return P(this,null,function*(){return!u||typeof u!="string"?!1:!!(yield H.getInstance().getShardNameToKeyMap())[u.trim().toLowerCase()]})}const Le=({value:u,onChange:t,onSelect:r,placeholder:c="Search for a shard...",className:d=""})=>{const[l,i]=y.useState([]),[h,m]=y.useState(!1),[s,a]=y.useState(-1),[n,x]=y.useState(!1),[o,p]=y.useState(!1),f=y.useRef(null),N=y.useRef(null),j=y.useRef(null),v=y.useMemo(()=>me(b=>P(null,null,function*(){if(b.length===0||n){i([]),m(!1),p(!1);return}p(!0);try{const w=yield H.getInstance().searchShards(b);i(w.slice(0,10)),m(w.length>0),a(-1)}catch(g){console.error("Search failed:",g),i([]),m(!1)}finally{p(!1)}}),100),[n]),S=y.useCallback(b=>{const g=b.target.value;x(!1),t(g),j.current&&clearTimeout(j.current),v(g)},[t,v]),k=y.useCallback(b=>{x(!0),m(!1),i([]),a(-1),t(b.name),r(b),j.current&&clearTimeout(j.current),setTimeout(()=>{x(!1),f.current&&f.current.blur()},50)},[t,r]),C=y.useCallback(b=>{if(!(!h||l.length===0||n))switch(b.key){case"ArrowDown":b.preventDefault(),a(g=>(g+1)%l.length);break;case"ArrowUp":b.preventDefault(),a(g=>g<=0?l.length-1:g-1);break;case"Enter":b.preventDefault(),s>=0&&s<l.length?k(l[s]):l.length===1&&k(l[0]);break;case"Escape":m(!1),a(-1);break}},[h,l,n,s,k]),E=y.useCallback(()=>{var b;x(!1),t(""),i([]),m(!1),a(-1),j.current&&clearTimeout(j.current),(b=f.current)==null||b.focus()},[t]),F=y.useCallback(()=>{n||u.trim()&&v(u)},[n,u,v]);return y.useEffect(()=>{const b=g=>{const w=g.target;f.current&&!f.current.contains(w)&&N.current&&!N.current.contains(w)&&(m(!1),a(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),j.current&&clearTimeout(j.current)}},[]),e.jsxs("div",{className:`relative ${d}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:o?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(ye,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:f,type:"text",value:u,onChange:S,onKeyDown:C,onFocus:F,placeholder:c,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),u&&e.jsx("button",{onClick:E,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(ae,{className:"h-4 w-4"})})]}),h&&l.length>0&&!n&&e.jsx("ul",{ref:N,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:l.map((b,g)=>e.jsx(he,{shard:b,index:g,focusedIndex:s,onSelect:k,isSelecting:n,setFocusedIndex:a},b.key))})]})},Te=({onSubmit:u})=>{const{form:t,setForm:r}=W();K.useEffect(()=>(console.log("[CalculatorForm] Mounted"),()=>{console.log("[CalculatorForm] Unmounted")}),[]),K.useEffect(()=>{P(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Ce(t.shard))&&u(M($({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const c=(s,a)=>{const n=M($({},t),{[s]:a});r(n),s!=="shard"&&s!=="quantity"&&u(n)},d=()=>{const s=M($({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});r(s),setTimeout(()=>{u(s)},0)},l=()=>{const s=t.shard,a=t.quantity,n={shard:s,quantity:a,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};r(n),m(""),setTimeout(()=>{u(n)},0)};function i(s){if(!s)return 0;const a=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!a)return Number(s.replace(/,/g,""))||0;let n=parseFloat(a[1].replace(/,/g,""));const x=a[2];return x==="k"?n*=1e3:x==="m"?n*=1e6:x==="b"&&(n*=1e9),Math.round(n)}const[h,m]=K.useState("");return K.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&h===""&&(c("moneyPerHour",1/0),u(M($({},t),{moneyPerHour:1/0})))},[t.shard]),K.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&h!==""&&m("")},[t.moneyPerHour]),e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(Le,{value:t.shard,onChange:s=>c("shard",s),onSelect:s=>{let a="common";if(s&&typeof s.rarity=="string"){const o=s.rarity.toLowerCase();o in U&&(a=o)}const n=U[a],x=M($({},t),{shard:s.name,quantity:n});r(x),setTimeout(()=>u(x),0),setTimeout(()=>{const o=document.querySelector('input[placeholder="1"]');o&&o.select()},0)},placeholder:"Search for a shard..."})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>c("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:d,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:l,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Ne,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>c("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>c("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>c("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"},{key:"crocodileLevel",label:"Crocodile"}].map(({key:s,label:a})=>e.jsx(xe,{value:t[s]||0,onChange:n=>c(s,n),label:a},s))}),e.jsx("p",{className:"text-xs text-orange-400 mt-1",children:"Note: Using Crocodile levels may slow down calculations a lot."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(pe,{value:t.kuudraTier||"none",onChange:s=>c("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:h,onChange:s=>{if(m(s.target.value),s.target.value.trim()==="")c("moneyPerHour",1/0),u(M($({},t),{moneyPerHour:1/0}));else{const a=i(s.target.value);c("moneyPerHour",a)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},q=({tree:u,data:t,isTopLevel:r=!1,totalShardsProduced:c=u.quantity,nodeId:d,expandedStates:l,onToggle:i})=>{var f,N,j;const h=t.shards[u.shard];if(u.method==="cycle"){const v=(f=l.get(d))!=null?f:!0,S=t.shards[u.shard],k=u.cycles.reduce((C,E)=>C+E.expectedCrafts,0)*2;return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors",onClick:()=>i(d),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[v?e.jsx(Z,{className:"w-4 h-4 text-amber-400"}):e.jsx(Y,{className:"w-4 h-4 text-amber-400"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-xs text-amber-300",children:[k," crafts"]}),e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-50 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-white font-medium text-sm",children:[Math.floor(u.quantity),"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${S.id}.png`,alt:S.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium text-sm ${T(S.rarity)}`,children:S.name}),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-[11px] font-medium rounded-md",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-slate-300",children:[Q(S.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]})})]}),v&&u.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:u.cycles.map((C,E)=>e.jsxs("div",{className:"",children:[e.jsx("div",{className:"text-xs font-semibold text-amber-400"}),e.jsx("div",{className:"space-y-0.5",children:[...C.steps].slice().reverse().map((F,b)=>{const g=F.recipe,w=t.shards[F.outputShard],L=t.shards[g.inputs[0]],R=t.shards[g.inputs[1]],ne=L.fuse_amount,re=R.fuse_amount;let z=g.outputQuantity;g.isReptile&&(z=z*C.multiplier);const le=C.steps.length-b;return e.jsx("div",{children:e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 text-sm font-medium",children:[e.jsxs("span",{className:"font-normal text-xs text-amber-300",children:["Step ",le," :"]}),e.jsxs("span",{className:"text-white",children:[z,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${w.id}.png`,alt:w.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${T(w.rarity)}`,children:w.name}),e.jsx("span",{children:" = "}),e.jsxs("span",{className:"text-slate-400",children:[ne,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${L.id}.png`,alt:L.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${T(L.rarity)}`,children:L.name}),e.jsx("span",{children:" + "}),e.jsxs("span",{className:"text-slate-400",children:[re,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${R.id}.png`,alt:R.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${T(R.rarity)}`,children:R.name})]}),e.jsxs("div",{className:"text-right min-w-[80px] ml-2",children:[e.jsx("span",{className:"text-slate-300 text-xs font-medium",children:Q(w.rate)}),e.jsx("span",{className:"text-slate-500 text-xs mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})]})},b)})}),(()=>{const F=new Set(C.steps.map(g=>g.outputShard)),b={};return C.steps.forEach(g=>{g.recipe.inputs.forEach(L=>{const R=t.shards[L];R&&(F.has(L)||(b[L]||(b[L]={quantity:0,shard:R}),b[L].quantity=R.fuse_amount))})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(b).map(({quantity:g,shard:w})=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[g*k,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${w.id}.png`,alt:w.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:T(w.rarity),children:w.name}),e.jsx("span",{className:"px-1 py-0.4 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right min-w-[80px] ml-2",children:[e.jsx("span",{className:"text-slate-300 text-xs font-medium",children:Q(w.rate)}),e.jsx("span",{className:"text-slate-500 text-xs mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})]},w.id))})})()]},E))})]})}if(u.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[u.quantity,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${h.id}.png`,alt:h.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium text-sm ${T(h.rarity)}`,title:V(h,!0),children:h.name}),e.jsx("span",{className:"px-1 py-0.4 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-slate-300",children:[Q(h.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]})})]});const m=(N=l.get(d))!=null?N:!0,s=u.inputs[0],a=u.inputs[1],n=t.shards[s.shard],x=t.shards[a.shard];let o=1;"craftsNeeded"in u&&(o=(j=u.craftsNeeded)!=null?j:1);const p=r?c:u.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>i(d),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5 p-0.5",children:[m?e.jsx(Z,{className:"w-4 h-4 text-slate-400"}):e.jsx(Y,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white flex items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:[Math.floor(p),"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${h.id}.png`,alt:h.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:`font-medium ${T(h.rarity)} text-sm whitespace-nowrap truncate`,style:{maxWidth:"8rem"},title:V(h,!1),children:h.name}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center",children:[e.jsx("span",{className:"mx-2 text-white",children:"="}),e.jsxs("span",{children:[Math.floor(s.quantity),"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${n.id}.png`,alt:n.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:T(n.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:n.name}),e.jsx("span",{className:"mx-2 text-white",children:"+"}),e.jsxs("span",{children:[Math.floor(a.quantity),"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${x.id}.png`,alt:x.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:T(x.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:x.name})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:o})]})})]})}),m&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(q,{tree:s,data:t,nodeId:`${d}-0`,expandedStates:l,onToggle:i}),e.jsx(q,{tree:a,data:t,nodeId:`${d}-1`,expandedStates:l,onToggle:i})]})]})},Re=({result:u,data:t,targetShardName:r})=>{const[c,d]=y.useState(new Map),[l,i]=y.useState(""),h=(n,x="root")=>{const o=new Map,p=(f,N)=>{f.method==="recipe"&&f.inputs&&(o.set(N,!0),f.inputs.forEach((j,v)=>{p(j,`${N}-${v}`)}))};return p(n,x),o};K.useEffect(()=>{if(u.tree){const n=JSON.stringify(u.tree);if(n!==l){const x=h(u.tree);d(x),i(n)}}},[u.tree,l]);const m=()=>{const n=new Map(c);for(const x of n.keys())n.set(x,!0);d(n)},s=()=>{const n=new Map(c);for(const x of n.keys())n.set(x,!1);d(n)},a=n=>{const x=new Map(c);x.set(n,!x.get(n)),d(x)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(we,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:_(u.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:_(u.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(G,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:u.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(ee,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[u.totalFusions,"x",u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:_(u.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(ee,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",Math.floor(u.totalShardsProduced)," ",r," ",e.jsxs("span",{className:"text-slate-400",children:[Math.floor(u.craftsNeeded)," craft",Math.floor(u.craftsNeeded)>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(u.totalQuantities).map(([n,x])=>{const o=t.shards[n],p=x/o.rate;return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[x,"x"]}),e.jsxs("span",{className:`mt-0 font-medium text-sm ${T(o.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${o.id}.png`,alt:o.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),o.name]})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[Q(o.rate)," ",e.jsx("span",{className:"text-slate-500",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:_(p)})]})]},n)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(G,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-[650px]",children:e.jsx(q,{tree:u.tree,data:t,isTopLevel:!0,totalShardsProduced:u.totalShardsProduced,nodeId:"root",expandedStates:c,onToggle:a})})})]})]})},I=class I{static getInstance(){return I.instance||(I.instance=new I),I.instance}parseData(t){return P(this,null,function*(){var r,c;try{const[d,l]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),i=yield d.json(),h=yield l.json(),m={};for(const a in i.recipes){m[a]=[];for(const n in i.recipes[a]){const x=parseInt(n);i.recipes[a][n].forEach(p=>{const f=p.some(N=>i.shards[N].family.includes("Reptile"));m[a].push({inputs:p,outputQuantity:x,isReptile:f})})}}const s={};for(const a in i.shards){let n=(c=(r=t.customRates[a])!=null?r:h[a])!=null?c:0;if(a==="L15"&&n===0){const x=t.moneyPerHour==null?1/0:t.moneyPerHour;n=this.calculateKuudraRate(t.kuudraTier,x)}n>0&&(t.noWoodenBait&&fe.includes(a)&&(n*=.05),be.includes(a)||(n=this.applyFortuneModifiers(n,a,i.shards[a],t))),t.excludeChameleon&&a==="L4"&&(n=0),s[a]=M($({},i.shards[a]),{id:a,rate:n})}return{recipes:m,shards:s}}catch(d){throw new Error(`Failed to parse data: ${d}`)}})}calculateKuudraRate(t,r){const d={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!d)return 0;let l;return r===1/0?l=0:r===0?l=1e12:l=d.cost/r*3600,d.multiplier*(3600/(d.baseTime+l))}applyFortuneModifiers(t,r,c,d){let l=d.hunterFortune;const i=1+5*d.tiamatLevel/100,h=1+2*d.seaSerpentLevel/100*i,m=2*d.pythonLevel/100*h,s=d.kingCobraLevel/100*h;switch(c.rarity){case"common":l+=2*d.newtLevel;break;case"uncommon":l+=2*d.salamanderLevel;break;case"rare":l+=d.lizardKingLevel;break;case"epic":l+=d.leviathanLevel;break}return d.frogPet&&(t*=1.1),r in J&&(J[r]&&(t*=1+m),l*=1+s),t*(1+l/100)}computeMinCosts(t,r){const c=new Map,d=new Map,l=Object.keys(t.shards),i=1+2*r/100,h=.8/3600;l.forEach(s=>{const a=t.shards[s].rate>0?1/t.shards[s].rate:1/0;c.set(s,a),d.set(s,{recipe:null})});let m=!0;for(;m;)m=!1,l.forEach(s=>{(t.recipes[s]||[]).forEach(n=>{const[x,o]=n.inputs,p=t.shards[x].fuse_amount,f=t.shards[o].fuse_amount,N=c.get(x)*p,j=c.get(o)*f,v=N+j+h,S=n.isReptile?n.outputQuantity*i:n.outputQuantity,k=v/S;k<c.get(s)&&(c.set(s,k),d.set(s,{recipe:n}),m=!0)})});return{minCosts:c,choices:d}}findCycleNodes(t){const r=new Map;for(const[a,n]of t)n.recipe&&r.set(a,n.recipe.inputs);let c=0;const d=new Map,l=new Map,i=new Map,h=[],m=[],s=a=>{var x;d.set(a,c),l.set(a,c),c++,h.push(a),i.set(a,!0);const n=r.get(a)||[];for(const o of n)r.has(o)&&(d.has(o)?i.get(o)&&l.set(a,Math.min(l.get(a),d.get(o))):(s(o),l.set(a,Math.min(l.get(a),l.get(o)))));if(l.get(a)===d.get(a)){const o=[];let p;do p=h.pop(),i.set(p,!1),o.push(p);while(p!==a);(o.length>1||o.length===1&&((x=r.get(a))!=null&&x.includes(a)))&&m.push(o)}};for(const a of r.keys())d.has(a)||s(a);return m}buildCycle(t,r,c){const d=[];for(const l of c)if(l.includes(t)){const i=[];for(const h of l){const m=r.get(h);m!=null&&m.recipe&&i.push({outputShard:h,recipe:m.recipe})}d.push(i)}return d}buildRecipeTree(t,r,c){if(c.flat().includes(t)){const l=this.buildCycle(t,r,c);return{shard:t,method:"cycle",quantity:0,cycles:l.map(i=>({steps:i,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0}}const d=r.get(t);if(d.recipe===null)return{shard:t,method:"direct",quantity:0};{const l=d.recipe,[i,h]=l.inputs,m=this.buildRecipeTree(i,r,c),s=this.buildRecipeTree(h,r,c);return c.flat().includes(t)?{shard:t,method:"cycleNode",recipe:l,inputs:[m,s],quantity:0,craftsNeeded:0}:{shard:t,method:"recipe",recipe:l,inputs:[m,s],quantity:0,craftsNeeded:0}}}assignQuantities(t,r,c,d,l,i){switch(t.quantity=r,t.method){case"recipe":{const h=t.recipe,m=h.isReptile?h.outputQuantity*i:h.outputQuantity,s=Math.ceil(r/m);t.craftsNeeded=s,d.total+=s;const[a,n]=h.inputs,x=c.shards[a].fuse_amount,o=c.shards[n].fuse_amount,p=s*x,f=s*o;this.assignQuantities(t.inputs[0],p,c,d,l,i),this.assignQuantities(t.inputs[1],f,c,d,l,i);break}case"cycleNode":{const h=t.recipe,m=h.isReptile?h.outputQuantity*i:h.outputQuantity,s=Math.ceil(r/m);t.craftsNeeded=s,d.total+=s;const[a,n]=h.inputs,x=c.shards[a].fuse_amount,o=c.shards[n].fuse_amount;this.assignQuantities(t.inputs[0],x,c,d,l,i),this.assignQuantities(t.inputs[1],o,c,d,l,i);break}case"cycle":for(const h of t.cycles){const m=h.steps.find(o=>o.outputShard===t.shard);if(!m)continue;const s=m.recipe,a=s.outputQuantity,n=s.isReptile?a*i:a,x=Math.ceil(r/n);h.expectedCrafts=x,h.expectedOutput=n,h.baseOutput=a,h.multiplier=i,d.total+=x*h.steps.length}t.craftsNeeded=t.cycles.reduce((h,m)=>h+(m.expectedCrafts||0),0);break}}collectTotalQuantities(t,r){const c=new Map,d=l=>{switch(l.method){case"direct":c.set(l.shard,(c.get(l.shard)||0)+l.quantity);break;case"recipe":case"cycleNode":l.inputs.forEach(d);break;case"cycle":if(l.cycles.length>0)for(const i of l.cycles){const h=l.cycles[0].expectedCrafts,m=new Map;i.steps.forEach(s=>{const[a,n]=s.recipe.inputs,x=r.shards[a].fuse_amount,o=r.shards[n].fuse_amount;r.shards[a].family.includes("Reptile")||m.set(a,(m.get(a)||0)+h*x),r.shards[n].family.includes("Reptile")||m.set(n,(m.get(n)||0)+h*o)}),m.forEach((s,a)=>{c.set(a,(c.get(a)||0)+s)})}break}};return d(t),c}decimalHoursToHoursMinutes(t){const r=Math.floor(t),c=Math.round((t-r)*60);return r===0?`${c} minutes`:c===0||isNaN(c)?`${r} hours`:`${r} hours ${c} minutes`}calculateOptimalPath(t,r,c){return P(this,null,function*(){var v;const d=yield this.parseData(c);if(!d.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:l,choices:i}=this.computeMinCosts(d,c.crocodileLevel),h=c.crocodileLevel>0?this.findCycleNodes(i):[],m=this.buildRecipeTree(t,i,h),s={total:0},a=1+2*c.crocodileLevel/100;this.assignQuantities(m,r,d,s,i,a);const n=this.collectTotalQuantities(m,d);let x=r,o=1;const p=i.get(t);if(p!=null&&p.recipe){const S=p.recipe.isReptile?p.recipe.outputQuantity*a:p.recipe.outputQuantity;o=Math.ceil(r/S),x=o*S}const f=(v=l.get(t))!=null?v:0,N=f*x,j=s.total*.8/3600;return{timePerShard:f,totalTime:N,totalShardsProduced:x,craftsNeeded:o,totalQuantities:n,totalFusions:s.total,craftTime:j,tree:m}})}};D(I,"instance");let O=I;const se=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:O},Symbol.toStringTag,{value:"Module"})),Pe=()=>{const[u,t]=y.useState(null),[r,c]=y.useState(!1),[d,l]=y.useState(null),i=y.useCallback((m,s,a)=>P(null,null,function*(){try{c(!0),l(null);const x=yield O.getInstance().calculateOptimalPath(m,s,a);t(x)}catch(n){l(n instanceof Error?n.message:"Calculation failed"),t(null)}finally{c(!1)}}),[]),h=y.useCallback(()=>{t(null),l(null)},[]);return{result:u,loading:r,error:d,calculate:i,clearResult:h}},$e=({onSubmit:u})=>{const{setForm:t}=W();return e.jsx(Te,{onSubmit:r=>u(r,t)})},Me=()=>{const{result:u,setResult:t,calculationData:r,setCalculationData:c,targetShardName:d,setTargetShardName:l,form:i}=W(),{loading:h,error:m}=Pe(),{customRates:s}=ge(),[a,n]=y.useState(!1),x=(o,p)=>P(null,null,function*(){p(o);try{if(!o.shard||o.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}n(!1);const j=(yield H.getInstance().getShardNameToKeyMap())[o.shard.toLowerCase()];if(!j){console.warn(`Calculation skipped: Shard "${o.shard}" not found in data`);return}l(o.shard);const v={customRates:s,hunterFortune:o.hunterFortune,excludeChameleon:o.excludeChameleon,frogPet:o.frogPet,newtLevel:o.newtLevel,salamanderLevel:o.salamanderLevel,lizardKingLevel:o.lizardKingLevel,leviathanLevel:o.leviathanLevel,pythonLevel:o.pythonLevel,kingCobraLevel:o.kingCobraLevel,seaSerpentLevel:o.seaSerpentLevel,tiamatLevel:o.tiamatLevel,crocodileLevel:o.crocodileLevel,kuudraTier:o.kuudraTier,moneyPerHour:o.moneyPerHour,noWoodenBait:o.noWoodenBait},k=(yield X(()=>Promise.resolve().then(()=>se),void 0)).CalculationService.getInstance(),C=yield k.calculateOptimalPath(j,o.quantity,v);t(C);const E=yield k.parseData(v);c(E)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return y.useEffect(()=>{i&&i.shard&&i.shard.trim()!==""&&P(null,null,function*(){try{const f=(yield H.getInstance().getShardNameToKeyMap())[i.shard.toLowerCase()];if(!f)return;l(i.shard);const N={customRates:s,hunterFortune:i.hunterFortune,excludeChameleon:i.excludeChameleon,frogPet:i.frogPet,newtLevel:i.newtLevel,salamanderLevel:i.salamanderLevel,lizardKingLevel:i.lizardKingLevel,leviathanLevel:i.leviathanLevel,pythonLevel:i.pythonLevel,kingCobraLevel:i.kingCobraLevel,seaSerpentLevel:i.seaSerpentLevel,tiamatLevel:i.tiamatLevel,crocodileLevel:i.crocodileLevel,kuudraTier:i.kuudraTier,moneyPerHour:i.moneyPerHour,noWoodenBait:i.noWoodenBait},v=(yield X(()=>Promise.resolve().then(()=>se),void 0)).CalculationService.getInstance(),S=yield v.calculateOptimalPath(f,i.quantity,N);t(S);const k=yield v.parseData(N);c(k)}catch(o){o instanceof Error&&!o.message.includes("not found")&&console.error("Calculation failed (customRates effect):",o)}})},[s,i,t,c,l]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-1 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>n(!a),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm cursor-pointer
              `,children:[a?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:[a?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${a?"block":"hidden xl:block"}`,children:e.jsx($e,{onSubmit:x})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[m&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ke,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:m})]})]}),u&&r&&e.jsx(Re,{result:u,data:r,targetShardName:d}),!u&&!h&&!m&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(te,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},He=()=>e.jsx(Me,{});export{He as CalculatorPage};
