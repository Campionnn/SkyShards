var Y=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var H=(r,t,a)=>t in r?Y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,k=(r,t)=>{for(var a in t||(t={}))se.call(t,a)&&H(r,a,t[a]);if(O)for(var a of O(t))ae.call(t,a)&&H(r,a,t[a]);return r},C=(r,t)=>ee(r,te(t));var W=(r,t,a)=>H(r,typeof t!="symbol"?t+"":t,a);var S=(r,t,a)=>new Promise((c,i)=>{var u=x=>{try{m(a.next(x))}catch(s){i(s)}},o=x=>{try{m(a.throw(x))}catch(s){i(s)}},m=x=>x.done?c(x.value):Promise.resolve(x.value).then(u,o);m((a=a.apply(r,t)).next())});import{d as ne,j as e,S as re,u as _,M as Q,P as le,K as ie,g as q,a as E,f as X,b as M,W as oe,N as ce,B as z,_ as B}from"./index-Dq4qA5KK.js";import{r as p,R as T}from"./vendor-e8ACzjHW.js";import{D as $,u as de}from"./useCustomRates--fFrVg9p.js";import{b as ue,X as Z,S as me,Z as he,R as xe,a as pe,c as fe,d as be,T as ge,e as D,H as V,M as U,f as ve}from"./icons-BJnD6z6O.js";import"./forms-B7jjzPDX.js";function ye(r){return S(this,null,function*(){return!r||typeof r!="string"?!1:!!(yield $.getInstance().getShardNameToKeyMap())[r.trim().toLowerCase()]})}const je=({value:r,onChange:t,onSelect:a,placeholder:c="Search for a shard...",className:i=""})=>{const[u,o]=p.useState([]),[m,x]=p.useState(!1),[s,l]=p.useState(-1),[n,h]=p.useState(!1),[d,g]=p.useState(!1),f=p.useRef(null),y=p.useRef(null),v=p.useRef(null),N=p.useMemo(()=>ne(b=>S(null,null,function*(){if(b.length===0||n){o([]),x(!1),g(!1);return}g(!0);try{const P=yield $.getInstance().searchShards(b);o(P.slice(0,10)),x(P.length>0),l(-1)}catch(j){console.error("Search failed:",j),o([]),x(!1)}finally{g(!1)}}),100),[n]),R=p.useCallback(b=>{const j=b.target.value;h(!1),t(j),v.current&&clearTimeout(v.current),N(j)},[t,N]),w=p.useCallback(b=>{h(!0),x(!1),o([]),l(-1),t(b.name),a(b),v.current&&clearTimeout(v.current),setTimeout(()=>{h(!1),f.current&&f.current.blur()},50)},[t,a]),F=p.useCallback(b=>{if(!(!m||u.length===0||n))switch(b.key){case"ArrowDown":b.preventDefault(),l(j=>(j+1)%u.length);break;case"ArrowUp":b.preventDefault(),l(j=>j<=0?u.length-1:j-1);break;case"Enter":b.preventDefault(),s>=0&&s<u.length?w(u[s]):u.length===1&&w(u[0]);break;case"Escape":x(!1),l(-1);break}},[m,u,n,s,w]),K=p.useCallback(()=>{var b;h(!1),t(""),o([]),x(!1),l(-1),v.current&&clearTimeout(v.current),(b=f.current)==null||b.focus()},[t]),G=p.useCallback(()=>{n||r.trim()&&N(r)},[n,r,N]);return p.useEffect(()=>{const b=j=>{const P=j.target;f.current&&!f.current.contains(P)&&y.current&&!y.current.contains(P)&&(x(!1),l(-1))};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b),v.current&&clearTimeout(v.current)}},[]),e.jsxs("div",{className:`relative ${i}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(ue,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:f,type:"text",value:r,onChange:R,onKeyDown:F,onFocus:G,placeholder:c,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),r&&e.jsx("button",{onClick:K,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(Z,{className:"h-4 w-4"})})]}),m&&u.length>0&&!n&&e.jsx("ul",{ref:y,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:u.map((b,j)=>e.jsx(re,{shard:b,index:j,focusedIndex:s,onSelect:w,isSelecting:n,setFocusedIndex:l},b.key))})]})},Ne=({onSubmit:r})=>{const{form:t,setForm:a}=_();T.useEffect(()=>(console.log("[CalculatorForm] Mounted"),()=>{console.log("[CalculatorForm] Unmounted")}),[]),T.useEffect(()=>{S(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield ye(t.shard))&&r(C(k({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const c=(s,l)=>{const n=C(k({},t),{[s]:l});a(n),s!=="shard"&&s!=="quantity"&&r(n)},i=()=>{const s=C(k({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,kuudraTier:"t5"});a(s),setTimeout(()=>{r(s)},0)},u=()=>{const s=t.shard,l=t.quantity,n={shard:s,quantity:l,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};a(n),x(""),setTimeout(()=>{r(n)},0)};function o(s){if(!s)return 0;const l=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!l)return Number(s.replace(/,/g,""))||0;let n=parseFloat(l[1].replace(/,/g,""));const h=l[2];return h==="k"?n*=1e3:h==="m"?n*=1e6:h==="b"&&(n*=1e9),Math.round(n)}const[m,x]=T.useState("");return T.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&m===""&&(c("moneyPerHour",1/0),r(C(k({},t),{moneyPerHour:1/0})))},[t.shard]),T.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&m!==""&&x("")},[t.moneyPerHour]),e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(je,{value:t.shard,onChange:s=>c("shard",s),onSelect:s=>{let l="common";if(s&&typeof s.rarity=="string"){const d=s.rarity.toLowerCase();d in Q&&(l=d)}const n=Q[l],h=C(k({},t),{shard:s.name,quantity:n});a(h),setTimeout(()=>r(h),0),setTimeout(()=>{const d=document.querySelector('input[placeholder="1"]');d&&d.select()},0)},placeholder:"Search for a shard..."})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>c("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:i,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:u,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>c("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>c("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>c("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:s,label:l})=>e.jsx(le,{value:t[s]||0,onChange:n=>c(s,n),label:l},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{value:t.kuudraTier||"none",onChange:s=>c("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:m,onChange:s=>{if(x(s.target.value),s.target.value.trim()==="")c("moneyPerHour",1/0),r(C(k({},t),{moneyPerHour:1/0}));else{const l=o(s.target.value);c("moneyPerHour",l)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},A=({tree:r,data:t,isTopLevel:a=!1,totalShardsProduced:c=r.quantity,nodeId:i,expandedStates:u,onToggle:o})=>{var g;const m=t.shards[r.shard],x=(g=u.get(i))!=null?g:!0;if(r.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[r.quantity,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${m.id}.png`,alt:m.name,className:"w-5 h-5 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium text-sm ${E(m.rarity)}`,title:q(m,!0),children:m.name}),e.jsx("span",{className:"px-1 py-0.4 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-slate-300",children:[X(m.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]})})]});const s=r.inputs[0],l=r.inputs[1],n=t.shards[s.shard],h=t.shards[l.shard],d=a?c:r.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>o(i),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5 p-0.5",children:[x?e.jsx(pe,{className:"w-4 h-4 text-slate-400"}):e.jsx(fe,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white flex items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:[d,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${m.id}.png`,alt:m.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:`font-medium ${E(m.rarity)} text-sm whitespace-nowrap truncate`,style:{maxWidth:"8rem"},title:q(m,!1),children:m.name}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center",children:[e.jsx("span",{className:"mx-2 text-white",children:"="}),e.jsxs("span",{children:[s.quantity,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${n.id}.png`,alt:n.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:E(n.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:n.name}),e.jsx("span",{className:"mx-2 text-white",children:"+"}),e.jsxs("span",{children:[l.quantity,"x"]}),e.jsx("img",{src:`/SkyShards/shardIcons/${h.id}.png`,alt:h.name,className:"w-5 h-5 object-contain inline-block align-middle mx-2 flex-shrink-0",loading:"lazy",style:{verticalAlign:"middle"}}),e.jsx("span",{className:E(h.rarity)+" whitespace-nowrap truncate",style:{maxWidth:"8rem"},children:h.name})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:d})]})})]})}),x&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(A,{tree:s,data:t,nodeId:`${i}-0`,expandedStates:u,onToggle:o}),e.jsx(A,{tree:l,data:t,nodeId:`${i}-1`,expandedStates:u,onToggle:o})]})]})},we=({result:r,data:t,targetShardName:a})=>{const[c,i]=p.useState(new Map),[u,o]=p.useState(""),m=(n,h="root")=>{const d=new Map,g=(f,y)=>{f.method==="recipe"&&f.inputs&&(d.set(y,!0),f.inputs.forEach((v,N)=>{g(v,`${y}-${N}`)}))};return g(n,h),d};T.useEffect(()=>{if(r.tree){const n=JSON.stringify(r.tree);if(n!==u){const h=m(r.tree);i(h),o(n)}}},[r.tree,u]);const x=()=>{const n=new Map(c);for(const h of n.keys())n.set(h,!0);i(n)},s=()=>{const n=new Map(c);for(const h of n.keys())n.set(h,!1);i(n)},l=n=>{const h=new Map(c);h.set(n,!h.get(n)),i(h)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(r.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(r.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(D,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:r.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[r.totalFusions,"x",r.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),r.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:M(r.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(V,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",r.totalShardsProduced," ",a," ",e.jsxs("span",{className:"text-slate-400",children:[r.craftsNeeded," craft",r.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(r.totalQuantities).map(([n,h])=>{const d=t.shards[n],g=h/d.rate;return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[h,"x"]}),e.jsxs("span",{className:`mt-0 font-medium text-sm ${E(d.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${d.id}.png`,alt:d.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),d.name]})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[X(d.rate)," ",e.jsx("span",{className:"text-slate-500",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:M(g)})]})]},n)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(D,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-[650px]",children:e.jsx(A,{tree:r.tree,data:t,isTopLevel:!0,totalShardsProduced:r.totalShardsProduced,nodeId:"root",expandedStates:c,onToggle:l})})})]})]})},L=class L{static getInstance(){return L.instance||(L.instance=new L),L.instance}parseData(t){return S(this,null,function*(){var a,c;try{const[i,u]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),o=yield i.json(),m=yield u.json(),x={};for(const l in o.recipes){x[l]=[];for(const n in o.recipes[l]){const h=parseInt(n);o.recipes[l][n].forEach(g=>{x[l].push({inputs:g,outputQuantity:h})})}}const s={};for(const l in o.shards){let n=(c=(a=t.customRates[l])!=null?a:m[l])!=null?c:0;if(l==="L15"&&n===0){const h=t.moneyPerHour==null?1/0:t.moneyPerHour;n=this.calculateKuudraRate(t.kuudraTier,h)}n>0&&(t.noWoodenBait&&oe.includes(l)&&(n*=.05),ce.includes(l)||(n=this.applyFortuneModifiers(n,l,o.shards[l],t))),t.excludeChameleon&&l==="L4"&&(n=0),s[l]=C(k({},o.shards[l]),{id:l,rate:n})}return{recipes:x,shards:s}}catch(i){throw new Error(`Failed to parse data: ${i}`)}})}calculateKuudraRate(t,a){const i={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!i)return 0;let u;return a===1/0?u=0:a===0?u=1e12:u=i.cost/a*3600,i.multiplier*(3600/(i.baseTime+u))}applyFortuneModifiers(t,a,c,i){let u=i.hunterFortune;const o=1+5*i.tiamatLevel/100,m=1+2*i.seaSerpentLevel/100*o,x=2*i.pythonLevel/100*m,s=i.kingCobraLevel/100*m;switch(c.rarity){case"common":u+=2*i.newtLevel;break;case"uncommon":u+=2*i.salamanderLevel;break;case"rare":u+=i.lizardKingLevel;break;case"epic":u+=i.leviathanLevel;break}return i.frogPet&&(t*=1.1),a in z&&(z[a]&&(t*=1+x),u*=1+s),t*(1+u/100)}computeMinCosts(t){const a=new Map,c=new Map,i=Object.keys(t.shards),u=.8/3600;i.forEach(m=>{const x=t.shards[m].rate>0?1/t.shards[m].rate:1/0;a.set(m,x),c.set(m,{recipe:null})});let o=!0;for(;o;)o=!1,i.forEach(m=>{(t.recipes[m]||[]).forEach(s=>{const[l,n]=s.inputs,h=t.shards[l].fuse_amount,d=t.shards[n].fuse_amount,g=a.get(l)*h,f=a.get(n)*d,v=(g+f+u)/s.outputQuantity;v<a.get(m)&&(a.set(m,v),c.set(m,{recipe:s}),o=!0)})});return{minCosts:a,choices:c}}buildRecipeTree(t,a){const c=a.get(t);if(c.recipe===null)return{shard:t,method:"direct",quantity:0};{const i=c.recipe,[u,o]=i.inputs,m=this.buildRecipeTree(u,a),x=this.buildRecipeTree(o,a);return{shard:t,method:"recipe",recipe:i,inputs:[m,x],quantity:0}}}assignQuantities(t,a,c,i){if(t.quantity=a,t.method==="recipe"){const u=t.recipe,o=u.outputQuantity,m=Math.ceil(a/o);i.total+=m;const[x,s]=u.inputs,l=c.shards[x].fuse_amount,n=c.shards[s].fuse_amount,h=m*l,d=m*n;this.assignQuantities(t.inputs[0],h,c,i),this.assignQuantities(t.inputs[1],d,c,i)}}collectTotalQuantities(t){const a=new Map,c=i=>{if(i.method==="direct"){const u=a.get(i.shard)||0;a.set(i.shard,u+i.quantity)}else i.inputs.forEach(c)};return c(t),a}decimalHoursToHoursMinutes(t){const a=Math.floor(t),c=Math.round((t-a)*60);return a===0?`${c} minutes`:c===0||isNaN(c)?`${a} hours`:`${a} hours ${c} minutes`}calculateOptimalPath(t,a,c){return S(this,null,function*(){var y;const i=yield this.parseData(c);if(!i.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0,inputs:[]}};const{minCosts:u,choices:o}=this.computeMinCosts(i),m=this.buildRecipeTree(t,o),x={total:0};this.assignQuantities(m,a,i,x);const s=this.collectTotalQuantities(m);let l=a,n=1;const h=o.get(t);if(h!=null&&h.recipe){const v=h.recipe.outputQuantity;n=Math.ceil(a/v),l=n*v}const d=(y=u.get(t))!=null?y:0,g=d*l,f=x.total*.8/3600;return{timePerShard:d,totalTime:g,totalShardsProduced:l,craftsNeeded:n,totalQuantities:s,totalFusions:x.total,craftTime:f,tree:m}})}};W(L,"instance");let I=L;const J=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:I},Symbol.toStringTag,{value:"Module"})),Se=()=>{const[r,t]=p.useState(null),[a,c]=p.useState(!1),[i,u]=p.useState(null),o=p.useCallback((x,s,l)=>S(null,null,function*(){try{c(!0),u(null);const h=yield I.getInstance().calculateOptimalPath(x,s,l);t(h)}catch(n){u(n instanceof Error?n.message:"Calculation failed"),t(null)}finally{c(!1)}}),[]),m=p.useCallback(()=>{t(null),u(null)},[]);return{result:r,loading:a,error:i,calculate:o,clearResult:m}},ke=({onSubmit:r})=>{const{setForm:t}=_();return e.jsx(Ne,{onSubmit:a=>r(a,t)})},Ce=()=>{const{result:r,setResult:t,calculationData:a,setCalculationData:c,targetShardName:i,setTargetShardName:u,form:o}=_(),{loading:m,error:x}=Se(),{customRates:s}=de(),[l,n]=p.useState(!1),h=(d,g)=>S(null,null,function*(){g(d);try{if(!d.shard||d.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}n(!1);const v=(yield $.getInstance().getShardNameToKeyMap())[d.shard.toLowerCase()];if(!v){console.warn(`Calculation skipped: Shard "${d.shard}" not found in data`);return}u(d.shard);const N={customRates:s,hunterFortune:d.hunterFortune,excludeChameleon:d.excludeChameleon,frogPet:d.frogPet,newtLevel:d.newtLevel,salamanderLevel:d.salamanderLevel,lizardKingLevel:d.lizardKingLevel,leviathanLevel:d.leviathanLevel,pythonLevel:d.pythonLevel,kingCobraLevel:d.kingCobraLevel,seaSerpentLevel:d.seaSerpentLevel,tiamatLevel:d.tiamatLevel,kuudraTier:d.kuudraTier,moneyPerHour:d.moneyPerHour,noWoodenBait:d.noWoodenBait},w=(yield B(()=>Promise.resolve().then(()=>J),void 0)).CalculationService.getInstance(),F=yield w.calculateOptimalPath(v,d.quantity,N);t(F);const K=yield w.parseData(N);c(K)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return p.useEffect(()=>{o&&o.shard&&o.shard.trim()!==""&&S(null,null,function*(){try{const f=(yield $.getInstance().getShardNameToKeyMap())[o.shard.toLowerCase()];if(!f)return;u(o.shard);const y={customRates:s,hunterFortune:o.hunterFortune,excludeChameleon:o.excludeChameleon,frogPet:o.frogPet,newtLevel:o.newtLevel,salamanderLevel:o.salamanderLevel,lizardKingLevel:o.lizardKingLevel,leviathanLevel:o.leviathanLevel,pythonLevel:o.pythonLevel,kingCobraLevel:o.kingCobraLevel,seaSerpentLevel:o.seaSerpentLevel,tiamatLevel:o.tiamatLevel,kuudraTier:o.kuudraTier,moneyPerHour:o.moneyPerHour,noWoodenBait:o.noWoodenBait},N=(yield B(()=>Promise.resolve().then(()=>J),void 0)).CalculationService.getInstance(),R=yield N.calculateOptimalPath(f,o.quantity,y);t(R);const w=yield N.parseData(y);c(w)}catch(d){d instanceof Error&&!d.message.includes("not found")&&console.error("Calculation failed (customRates effect):",d)}})},[s,o,t,c,u]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-1 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>n(!l),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm cursor-pointer
              `,children:[l?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:[l?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${l?"block":"hidden xl:block"}`,children:e.jsx(ke,{onSubmit:h})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ve,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),r&&a&&e.jsx(we,{result:r,data:a,targetShardName:i}),!r&&!m&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(U,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},$e=()=>e.jsx(Ce,{});export{$e as CalculatorPage};
