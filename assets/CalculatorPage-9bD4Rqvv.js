var we=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var se=(u,t,l)=>t in u?we(u,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[t]=l,z=(u,t)=>{for(var l in t||(t={}))Le.call(t,l)&&se(u,l,t[l]);if(he)for(var l of he(t))Re.call(t,l)&&se(u,l,t[l]);return u},A=(u,t)=>ke(u,Ce(t));var pe=(u,t,l)=>se(u,typeof t!="symbol"?t+"":t,l);var W=(u,t,l)=>new Promise((o,r)=>{var c=x=>{try{m(l.next(x))}catch(h){r(h)}},i=x=>{try{m(l.throw(x))}catch(h){r(h)}},m=x=>x.done?o(x.value):Promise.resolve(x.value).then(c,i);m((l=l.apply(u,t)).next())});import{u as ie,j as e,M as fe,P as Te,f as H,K as Se,a as D,T as B,g as Ee,b as U,c as G,W as Me,N as Pe,B as ye,_ as ge}from"./index-BA69ubF-.js";import{R as Y,r as I}from"./vendor-Dt516RNf.js";import{D as ae,S as K}from"./dataService-4bUB4DT0.js";import{S as $e}from"./ShardAutocomplete-Bh4KXI5o.js";import{a as Qe,Z as Fe,R as _e,c as Oe,b as He,d as Ke,e as Ie,T as qe,f as be,H as je,X as ze,M as ve,g as Ae}from"./icons-DNYyJ9Q2.js";import{u as We}from"./useCustomRates-B6596grU.js";import"./forms-CPIcrlzh.js";function Be(u){return W(this,null,function*(){return!u||typeof u!="string"?!1:!!(yield ae.getInstance().getShardNameToKeyMap())[u.trim().toLowerCase()]})}const Ue=({onSubmit:u})=>{const{form:t,setForm:l}=ie();Y.useEffect(()=>{W(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Be(t.shard))&&u(A(z({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const o=(s,n)=>{const d=A(z({},t),{[s]:n});l(d),s!=="shard"&&s!=="quantity"&&u(d)},r=()=>{const s=A(z({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});l(s),setTimeout(()=>{u(s)},0)},c=()=>{const s=t.shard,n=t.quantity,d={shard:s,quantity:n,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};l(d),x(""),setTimeout(()=>{u(d)},0)};function i(s){if(!s)return 0;const n=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!n)return Number(s.replace(/,/g,""))||0;let d=parseFloat(n[1].replace(/,/g,""));const a=n[2];return a==="k"?d*=1e3:a==="m"?d*=1e6:a==="b"&&(d*=1e9),Math.round(d)}const[m,x]=Y.useState("");Y.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&m===""&&(o("moneyPerHour",1/0),u(A(z({},t),{moneyPerHour:1/0})))},[t.shard]),Y.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&m!==""&&x("")},[t.moneyPerHour]);const h=()=>{t.shard&&o("shard","")};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx($e,{value:t.shard,onChange:s=>o("shard",s),onSelect:s=>{let n="common";if(s&&typeof s.rarity=="string"){const p=s.rarity.toLowerCase();p in fe&&(n=p)}const d=fe[n],a=A(z({},t),{shard:s.name,quantity:d});l(a),setTimeout(()=>u(a),0)},onFocus:h,placeholder:"Search for a shard...",searchMode:"name-only"})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>o("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:r,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:c,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>o("hunterFortune",Number(s.target.value)),className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>o("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>o("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt",shardId:"C35"},{key:"salamanderLevel",label:"Salamander",shardId:"U8"},{key:"lizardKingLevel",label:"Lizard King",shardId:"R8"},{key:"leviathanLevel",label:"Leviathan",shardId:"E5"},{key:"pythonLevel",label:"Python",shardId:"R9"},{key:"kingCobraLevel",label:"King Cobra",shardId:"R54"},{key:"seaSerpentLevel",label:"Sea Serpent",shardId:"E32"},{key:"tiamatLevel",label:"Tiamat",shardId:"L6"},{key:"crocodileLevel",label:"Crocodile",shardId:"R45"}].map(({key:s,label:n,shardId:d})=>{var p;const a=K[d];return e.jsx(Te,{value:t[s]||0,onChange:y=>o(s,y),label:n,tooltipTitle:a==null?void 0:a.title,tooltipContent:H((a==null?void 0:a.description)||"No description available."),tooltipShardName:n,tooltipShardIcon:d,tooltipRarity:((p=a==null?void 0:a.rarity)==null?void 0:p.toLowerCase())||"common",tooltipFamily:a==null?void 0:a.family,tooltipType:a==null?void 0:a.type,tooltipWarning:s==="crocodileLevel"?"Warning: May slow calculations significantly":void 0},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Se,{value:t.kuudraTier||"none",onChange:s=>o("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:m,onChange:s=>{if(x(s.target.value),s.target.value.trim()==="")o("moneyPerHour",1/0),u(A(z({},t),{moneyPerHour:1/0}));else{const n=i(s.target.value);o("moneyPerHour",n)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},ne=({tree:u,data:t,isTopLevel:l=!1,totalShardsProduced:o=u.quantity,nodeId:r,expandedStates:c,onToggle:i})=>{var V,re,le,ce,oe,de;const m=t.shards[u.shard],x=E=>{const g=t.recipes[E];if(!(g!=null&&g.length))return null;const b={U8:T=>T.inputs.includes("C35")&&T.inputs.includes("U38"),C35:T=>T.inputs.includes("C23")&&T.inputs.includes("U38")}[E];return b?g.find(b):g.sort((T,w)=>w.outputQuantity-T.outputQuantity)[0]},h=E=>E?e.jsx(He,{className:"w-6 h-6 text-amber-400"}):e.jsx(Ke,{className:"w-6 h-6 text-amber-400"}),s=(E,g,M=!0)=>{var T;const b=K[g.id];return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((b==null?void 0:b.description)||"No description available."),title:b==null?void 0:b.title,shardName:g.name,shardIcon:g.id,rarity:((T=b==null?void 0:b.rarity)==null?void 0:T.toLowerCase())||g.rarity,family:b==null?void 0:b.family,type:b==null?void 0:b.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})}),M&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]})},n=(E,g,M,b,T,w,P=!1,$)=>{var q,F,O;const N=K[g.id],k=K[b.id],L=K[w.id];return e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium min-w-0",children:[P&&e.jsxs("span",{className:"font-normal text-sm text-amber-300 flex-shrink-0 mr-2",children:["Step ",$,":"]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((N==null?void 0:N.description)||"No description available."),title:N==null?void 0:N.title,shardName:g.name,shardIcon:g.id,rarity:((q=N==null?void 0:N.rarity)==null?void 0:q.toLowerCase())||g.rarity,family:N==null?void 0:N.family,type:N==null?void 0:N.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"="}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[M,"x"]}),e.jsx(B,{content:H((k==null?void 0:k.description)||"No description available."),title:k==null?void 0:k.title,shardName:b.name,shardIcon:b.id,rarity:((F=k==null?void 0:k.rarity)==null?void 0:F.toLowerCase())||b.rarity,family:k==null?void 0:k.family,type:k==null?void 0:k.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${b.id}.png`,alt:b.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(b.rarity)} whitespace-nowrap text-sm`,children:b.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"+"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[T,"x"]}),e.jsx(B,{content:H((L==null?void 0:L.description)||"No description available."),title:(L==null?void 0:L.title)||w.name,shardName:w.name,shardIcon:w.id,rarity:((O=L==null?void 0:L.rarity)==null?void 0:O.toLowerCase())||w.rarity,family:L==null?void 0:L.family,type:L==null?void 0:L.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${w.id}.png`,alt:w.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(w.rarity)} whitespace-nowrap text-sm`,children:w.name})]})})]})]})},d=(E,g)=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full flex-shrink-0"}),e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2",children:s(E,g,!1)}),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]}),a=(E,g,M,b=1)=>{var q;const T=E.outputQuantity,w=t.shards[E.inputs[0]],P=t.shards[E.inputs[1]],$=w.fuse_amount,N=P.fuse_amount,k=`${M}-${g.id}`,L=(q=c.get(k))!=null?q:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(k),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(L),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:n(T,g,$,w,N,P)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:"1"})]})})]}),L&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 flex flex-col gap-0.5",children:E.inputs.map(F=>{const O=t.shards[F];if(!O)return null;const Z=x(F);return F==="C11"||F==="U38"||F==="C23"?e.jsx("div",{children:d(O.fuse_amount,O)},`direct-${F}`):Z&&b<2?e.jsx("div",{children:a(Z,O,k,b+1)},`sub-${F}`):null})})]})};if(u.method==="cycle"){const E=(V=c.get(r))!=null?V:!0,g=u.cycles.reduce((M,b)=>M+b.expectedCrafts,0);return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors gap-2 sm:gap-8",onClick:()=>i(r),children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(E),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"text-sm text-amber-300 flex-shrink-0",children:[g," crafts"]}),e.jsx(Oe,{className:"w-6 text-amber-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[s(Math.floor(u.quantity),m,!1),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-sm font-medium rounded-md flex-shrink-0",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:g})]})})]}),E&&u.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:u.cycles.map((M,b)=>e.jsxs("div",{children:[e.jsx("div",{className:"space-y-0.5",children:[...M.steps].slice().reverse().map((T,w)=>{var Z;const P=T.recipe,$=t.shards[T.outputShard],N=t.shards[P.inputs[0]],k=t.shards[P.inputs[1]],L=N.fuse_amount,q=k.fuse_amount;let F=P.outputQuantity;P.isReptile&&(F*=M.multiplier);const O=M.steps.length-w;if(O===1){const te=`${r}-step-${O}`,me=(Z=c.get(te))!=null?Z:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(te),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(me),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:n(F,$,L,N,q,k,!0,O)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:M.expectedCrafts})]})})]}),me&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-1",children:P.inputs.map(X=>{const ue=t.shards[X],xe=x(X);return xe&&ue&&X!=="C11"&&X!=="U38"&&X!=="C23"?e.jsx("div",{className:"space-y-1",children:a(xe,ue,r)},X):null})})]},w)}else return e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between gap-2 sm:gap-8",children:[e.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:n(F,$,L,N,q,k,!0,O)}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:M.expectedCrafts})]})})]},w)})}),(()=>{const T=new Set(M.steps.map(P=>P.outputShard)),w={};return M.steps.forEach(P=>{P.recipe.inputs.forEach($=>{const N=t.shards[$];!N||T.has($)||(w[$]||(w[$]={quantity:0,shard:N}),w[$].quantity+=N.fuse_amount)})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(w).map(({quantity:P,shard:$})=>e.jsx("div",{children:d(P*g,$)},$.id))})})()]},b))})]})}if(u.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s(u.quantity,m,!1),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[D(m.rate),e.jsx("span",{className:"text-slate-500 text-xs font-bold mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})})]});const p=(re=c.get(r))!=null?re:!0,y=u.inputs[0],f=u.inputs[1],j=t.shards[y.shard],S=t.shards[f.shard],Q="craftsNeeded"in u&&(le=u.craftsNeeded)!=null?le:1,_=l?o:u.quantity,v=K[m.id],C=K[j.id],R=K[S.id];return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>i(r),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-15 sm:gap-8 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 p-0.5 min-w-0 flex-1",children:[h(p),e.jsxs("div",{className:"text-white flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsxs("span",{className:"font-medium text-sm flex-shrink-0",children:[Math.floor(_),"x"]}),e.jsx(B,{content:H((v==null?void 0:v.description)||"No description available."),title:v==null?void 0:v.title,shardName:m.name,shardIcon:m.id,rarity:((ce=v==null?void 0:v.rarity)==null?void 0:ce.toLowerCase())||m.rarity,family:v==null?void 0:v.family,type:v==null?void 0:v.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${m.id}.png`,alt:m.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium ${U(m.rarity)} text-sm truncate`,title:Ee(m,!1),children:m.name})]})}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center gap-1 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsx("span",{className:"text-white flex-shrink-0 text-sm",children:"="}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(y.quantity),"x"]}),e.jsx(B,{content:H((C==null?void 0:C.description)||"No description available."),title:C==null?void 0:C.title,shardName:j.name,shardIcon:j.id,rarity:((oe=C==null?void 0:C.rarity)==null?void 0:oe.toLowerCase())||j.rarity,family:C==null?void 0:C.family,type:C==null?void 0:C.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${j.id}.png`,alt:j.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(j.rarity)} text-sm truncate`,children:j.name})]})}),e.jsx("span",{className:"flex-shrink-0 text-white text-sm",children:"+"}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(f.quantity),"x"]}),e.jsx(B,{content:H((R==null?void 0:R.description)||"No description available."),title:R==null?void 0:R.title,shardName:S.name,shardIcon:S.id,rarity:((de=R==null?void 0:R.rarity)==null?void 0:de.toLowerCase())||S.rarity,family:R==null?void 0:R.family,type:R==null?void 0:R.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${S.id}.png`,alt:S.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(S.rarity)} text-sm truncate`,children:S.name})]})})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:Q})]})})]})}),p&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(ne,{tree:y,data:t,nodeId:`${r}-0`,expandedStates:c,onToggle:i}),e.jsx(ne,{tree:f,data:t,nodeId:`${r}-1`,expandedStates:c,onToggle:i})]})]})},Ve=({result:u,data:t,targetShardName:l})=>{const[o,r]=I.useState(new Map),[c,i]=I.useState(""),m=(n,d="root")=>{const a=new Map,p=(y,f)=>{y.method==="recipe"&&y.inputs&&(a.set(f,!0),y.inputs.forEach((j,S)=>{p(j,`${f}-${S}`)}))};return p(n,d),a};Y.useEffect(()=>{if(u.tree){const n=JSON.stringify(u.tree);if(n!==c){const d=m(u.tree);r(d),i(n)}}},[u.tree,c]);const x=()=>{const n=new Map(o);for(const d of n.keys())n.set(d,!0);r(n)},h=()=>{const n=new Map(o);for(const d of n.keys())n.set(d,!1);r(n)},s=n=>{const d=new Map(o);d.set(n,!d.get(n)),r(d)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:Math.floor(u.totalShardsProduced)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[u.totalFusions,"x",u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:G(u.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2.5 flex-wrap items-start sm:items-center sm:justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"flex gap-2",children:[(()=>{const n=Array.from(u.totalQuantities).filter(([p])=>{var y,f;return["shinyfish","inferno koi","abyssal lanternfish","silentdepth"].includes((f=(y=t.shards[p])==null?void 0:y.name)==null?void 0:f.toLowerCase())});if(n.length===0)return null;const d=n.reduce((p,[y,f])=>{var Q,_;const S=((_=(Q=t.shards[y])==null?void 0:Q.name)==null?void 0:_.toLowerCase())==="shinyfish"?512:1024;return p+f*S},0),a=p=>p>=1e9?(p/1e9).toFixed(1).replace(/\.0$/,"")+"b":p>=1e6?(p/1e6).toFixed(1).replace(/\.0$/,"")+"m":p>=1e3?(p/1e3).toFixed(1).replace(/\.0$/,"")+"k":p.toString();return e.jsxs("div",{className:"flex gap-1 items-center px-3 py-1.5 bg-fuchsia-500/20 border border-fuchsia-500/30 text-fuchsia-400 text-sm font-medium rounded-md min-w-0",children:[e.jsx("span",{className:"text-slate-300",children:a(d)}),e.jsx("span",{className:"truncate",children:"Forest Essence"})]})})(),e.jsxs("div",{className:"px-3 py-1.5 flex gap-1 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md min-w-0",children:[e.jsxs("span",{className:"text-slate-300",children:[Math.floor(u.totalShardsProduced),"x"]}),e.jsx("span",{className:"truncate",children:l}),e.jsxs("span",{className:"text-slate-400 whitespace-nowrap",children:[Math.floor(u.craftsNeeded)," craft",Math.floor(u.craftsNeeded)>1?"s":""]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(u.totalQuantities).map(([n,d])=>{var j;const a=t.shards[n],p=d,y=p/a.rate,f=K[a.id];return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[p,"x"]}),e.jsx(B,{content:H((f==null?void 0:f.description)||"No description available."),title:f==null?void 0:f.title,shardName:a.name,shardIcon:a.id,rarity:((j=f==null?void 0:f.rarity)==null?void 0:j.toLowerCase())||a.rarity,family:f==null?void 0:f.family,type:f==null?void 0:f.type,className:"cursor-pointer",children:e.jsxs("span",{className:`mt-0 font-medium text-sm ${U(a.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${a.id}.png`,alt:a.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),a.name]})})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[D(a.rate)," ",e.jsx("span",{className:"text-slate-500 font-bold",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:G(y)})]})]},n)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(be,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-fit",children:e.jsx(ne,{tree:u.tree,data:t,isTopLevel:!0,totalShardsProduced:u.totalShardsProduced,nodeId:"root",expandedStates:o,onToggle:s})})})]})]})},J=class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}parseData(t){return W(this,null,function*(){var l,o;try{const[r,c]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),i=yield r.json(),m=yield c.json(),x={};for(const s in i.recipes){x[s]=[];for(const n in i.recipes[s]){const d=parseInt(n);i.recipes[s][n].forEach(p=>{const y=p.some(f=>i.shards[f].family.includes("Reptile"));x[s].push({inputs:p,outputQuantity:d,isReptile:y})})}}const h={};for(const s in i.shards){let n=(o=(l=t.customRates[s])!=null?l:m[s])!=null?o:0;if(s==="L15"&&n===0){const d=t.moneyPerHour==null?1/0:t.moneyPerHour;n=this.calculateKuudraRate(t.kuudraTier,d)}n>0&&(t.noWoodenBait&&Me.includes(s)&&(n*=.2),Pe.includes(s)||(n=this.applyFortuneModifiers(n,s,i.shards[s],t))),t.excludeChameleon&&s==="L4"&&(n=0),h[s]=A(z({},i.shards[s]),{id:s,rate:n})}return{recipes:x,shards:h}}catch(r){throw new Error(`Failed to parse data: ${r}`)}})}calculateKuudraRate(t,l){const r={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!r)return 0;let c;return l===1/0?c=0:l===0?c=1e12:c=r.cost/l*3600,r.multiplier*(3600/(r.baseTime+c))}applyFortuneModifiers(t,l,o,r){let c=r.hunterFortune;const i=1+5*r.tiamatLevel/100,m=1+2*r.seaSerpentLevel/100*i,x=2*r.pythonLevel/100*m,h=r.kingCobraLevel/100*m;switch(o.rarity){case"common":c+=2*r.newtLevel;break;case"uncommon":c+=2*r.salamanderLevel;break;case"rare":c+=r.lizardKingLevel;break;case"epic":c+=r.leviathanLevel;break}return r.frogPet&&(t*=1.1),l in ye&&(ye[l]&&(t*=1+x),c*=1+h),t*(1+c/100)}computeMinCosts(t,l,o,r){const c=new Map,i=new Map,m=Object.keys(t.shards),x=1+5*r/100,h=1+2*o/100*x,s=1+2*l/100*h,n=.8/3600;m.forEach(a=>{const p=t.shards[a].rate>0?1/t.shards[a].rate:1/0;c.set(a,p),i.set(a,{recipe:null})});let d=!0;for(;d;)d=!1,m.forEach(a=>{(t.recipes[a]||[]).forEach(y=>{const[f,j]=y.inputs,S=t.shards[f].fuse_amount,Q=t.shards[j].fuse_amount,_=c.get(f)*S,v=c.get(j)*Q,C=_+v+n,R=y.isReptile?y.outputQuantity*s:y.outputQuantity,V=C/R;V<c.get(a)&&(c.set(a,V),i.set(a,{recipe:y}),d=!0)})});return{minCosts:c,choices:i}}findCycleNodes(t){const l=new Map;for(const[s,n]of t)n.recipe&&l.set(s,n.recipe.inputs);let o=0;const r=new Map,c=new Map,i=new Map,m=[],x=[],h=s=>{var d;r.set(s,o),c.set(s,o),o++,m.push(s),i.set(s,!0);const n=l.get(s)||[];for(const a of n)l.has(a)&&(r.has(a)?i.get(a)&&c.set(s,Math.min(c.get(s),r.get(a))):(h(a),c.set(s,Math.min(c.get(s),c.get(a)))));if(c.get(s)===r.get(s)){const a=[];let p;do p=m.pop(),i.set(p,!1),a.push(p);while(p!==s);(a.length>1||a.length===1&&((d=l.get(s))!=null&&d.includes(s)))&&x.push(a)}};for(const s of l.keys())r.has(s)||h(s);return x}buildCycle(t,l,o){const r=[];for(const c of o)if(c.includes(t)){const i=[];for(const m of c){const x=l.get(m);x!=null&&x.recipe&&i.push({outputShard:m,recipe:x.recipe})}r.push(i)}return r}buildRecipeTree(t,l,o,r){if(r.flat().includes(l)){const i=this.buildCycle(l,o,r),{minCosts:m,choices:x}=this.computeMinCosts(t,0,0,0),h=r.flat().reduce((d,a)=>m.get(a)<m.get(d)?a:d,r.flat()[0]),s=this.buildRecipeTree(t,h,x,[]),n={total:0};return this.assignQuantities(s,t.shards[h].fuse_amount,t,n,x,1),{shard:l,method:"cycle",quantity:0,cycles:i.map(d=>({steps:d,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0,inputRecipe:s}}const c=o.get(l);if(c.recipe===null)return{shard:l,method:"direct",quantity:0};{const i=c.recipe,[m,x]=i.inputs,h=this.buildRecipeTree(t,m,o,r),s=this.buildRecipeTree(t,x,o,r);return r.flat().includes(l)?{shard:l,method:"cycleNode",recipe:i,inputs:[h,s],quantity:0,craftsNeeded:0}:{shard:l,method:"recipe",recipe:i,inputs:[h,s],quantity:0,craftsNeeded:0}}}assignQuantities(t,l,o,r,c,i){switch(t.quantity=l,t.method){case"recipe":{const m=t.recipe,x=m.isReptile?m.outputQuantity*i:m.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,r.total+=h;const[s,n]=m.inputs,d=o.shards[s].fuse_amount,a=o.shards[n].fuse_amount,p=h*d,y=h*a;this.assignQuantities(t.inputs[0],p,o,r,c,i),this.assignQuantities(t.inputs[1],y,o,r,c,i);break}case"cycleNode":{const m=t.recipe,x=m.isReptile?m.outputQuantity*i:m.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,r.total+=h;const[s,n]=m.inputs,d=o.shards[s].fuse_amount,a=o.shards[n].fuse_amount;this.assignQuantities(t.inputs[0],d,o,r,c,i),this.assignQuantities(t.inputs[1],a,o,r,c,i);break}case"cycle":for(const m of t.cycles){const x=m.steps.find(y=>y.outputShard===t.shard);if(!x)continue;const h=x.recipe,s=h.outputQuantity,n=h.isReptile?s*i:s;let d=0;m.steps.forEach(y=>{y.recipe.inputs.forEach(f=>{if(f===t.shard){const j=o.shards[f];d+=j.fuse_amount}})});const a=n-d,p=a>0?Math.ceil(l/a):Math.ceil(l/n);m.expectedCrafts=p,m.expectedOutput=n,m.baseOutput=s,m.multiplier=i,r.total+=p*m.steps.length}if(t.craftsNeeded=t.cycles.reduce((m,x)=>m+(x.expectedCrafts||0),0),t.cycles.length>0){const m=t.cycles[0].expectedCrafts,x=new Map;t.cycles[0].steps.forEach(s=>{s.recipe.inputs.forEach(n=>{const d=o.shards[n],a=x.get(n)||0;x.set(n,a+d.fuse_amount)})});const h=new Set(t.cycles[0].steps.map(s=>s.outputShard));x.forEach((s,n)=>{if(!h.has(n)){const d=s*m,a=c.get(n);if(a&&a.recipe){const p=this.buildRecipeTree(o,n,c,[]);this.assignQuantities(p,d,o,r,c,i)}}})}break}}collectTotalQuantities(t,l){const o=new Map,r=c=>{switch(c.method){case"direct":o.set(c.shard,(o.get(c.shard)||0)+c.quantity);break;case"recipe":case"cycleNode":c.inputs.forEach(r);break;case"cycle":if(c.cycles.length>0){for(const i of c.cycles){const x=c.cycles[0].expectedCrafts,h=new Map;i.steps.forEach(s=>{const[n,d]=s.recipe.inputs,a=l.shards[n].fuse_amount,p=l.shards[d].fuse_amount;l.shards[n].family.includes("Reptile")||h.set(n,(h.get(n)||0)+x*a),l.shards[d].family.includes("Reptile")||h.set(d,(h.get(d)||0)+x*p)}),h.forEach((s,n)=>{o.set(n,(o.get(n)||0)+s)})}r(c.inputRecipe)}break}};return r(t),o}calculateOptimalPath(t,l,o){return W(this,null,function*(){var _;const r=yield this.parseData(o);if(!r.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:c,choices:i}=this.computeMinCosts(r,o.crocodileLevel,o.seaSerpentLevel,o.tiamatLevel),m=o.crocodileLevel>0?this.findCycleNodes(i):[],x=this.buildRecipeTree(r,t,i,m),h={total:0},s=1+5*o.tiamatLevel/100,n=1+2*o.seaSerpentLevel/100*s,d=1+2*o.crocodileLevel/100*n;this.assignQuantities(x,l,r,h,i,d);const a=this.collectTotalQuantities(x,r);let p=l,y=1;const f=i.get(t);if(f!=null&&f.recipe){const v=f.recipe.isReptile?f.recipe.outputQuantity*d:f.recipe.outputQuantity;y=Math.ceil(l/v),p=y*v}const j=(_=c.get(t))!=null?_:0,S=j*p,Q=h.total*.8/3600;return{timePerShard:j,totalTime:S,totalShardsProduced:p,craftsNeeded:y,totalQuantities:a,totalFusions:h.total,craftTime:Q,tree:x}})}};pe(J,"instance");let ee=J;const Ne=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:ee},Symbol.toStringTag,{value:"Module"})),Je=()=>{const[u,t]=I.useState(null),[l,o]=I.useState(!1),[r,c]=I.useState(null),i=I.useCallback((x,h,s)=>W(null,null,function*(){try{o(!0),c(null);const d=yield ee.getInstance().calculateOptimalPath(x,h,s);t(d)}catch(n){c(n instanceof Error?n.message:"Calculation failed"),t(null)}finally{o(!1)}}),[]),m=I.useCallback(()=>{t(null),c(null)},[]);return{result:u,loading:l,error:r,calculate:i,clearResult:m}},Xe=({onSubmit:u})=>{const{setForm:t}=ie();return e.jsx(Ue,{onSubmit:l=>u(l,t)})},Ze=()=>{const{result:u,setResult:t,calculationData:l,setCalculationData:o,targetShardName:r,setTargetShardName:c,form:i}=ie(),{loading:m,error:x}=Je(),{customRates:h}=We(),[s,n]=I.useState(!1),d=(a,p)=>W(null,null,function*(){p(a);try{if(!a.shard||a.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}const j=(yield ae.getInstance().getShardNameToKeyMap())[a.shard.toLowerCase()];if(!j){console.warn(`Calculation skipped: Shard "${a.shard}" not found in data`);return}c(a.shard);const Q={customRates:Object.fromEntries(Object.entries(h).filter(([,V])=>V!==void 0)),hunterFortune:a.hunterFortune,excludeChameleon:a.excludeChameleon,frogPet:a.frogPet,newtLevel:a.newtLevel,salamanderLevel:a.salamanderLevel,lizardKingLevel:a.lizardKingLevel,leviathanLevel:a.leviathanLevel,pythonLevel:a.pythonLevel,kingCobraLevel:a.kingCobraLevel,seaSerpentLevel:a.seaSerpentLevel,tiamatLevel:a.tiamatLevel,crocodileLevel:a.crocodileLevel,kuudraTier:a.kuudraTier,moneyPerHour:a.moneyPerHour,noWoodenBait:a.noWoodenBait},v=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),C=yield v.calculateOptimalPath(j,a.quantity,Q);t(C);const R=yield v.parseData(Q);o(R)}catch(y){y instanceof Error&&!y.message.includes("not found")&&console.error("Calculation failed:",y)}});return I.useEffect(()=>{i&&i.shard&&i.shard.trim()!==""&&W(null,null,function*(){try{const y=(yield ae.getInstance().getShardNameToKeyMap())[i.shard.toLowerCase()];if(!y)return;c(i.shard);const j={customRates:Object.fromEntries(Object.entries(h).filter(([,C])=>C!==void 0)),hunterFortune:i.hunterFortune,excludeChameleon:i.excludeChameleon,frogPet:i.frogPet,newtLevel:i.newtLevel,salamanderLevel:i.salamanderLevel,lizardKingLevel:i.lizardKingLevel,leviathanLevel:i.leviathanLevel,pythonLevel:i.pythonLevel,kingCobraLevel:i.kingCobraLevel,seaSerpentLevel:i.seaSerpentLevel,tiamatLevel:i.tiamatLevel,crocodileLevel:i.crocodileLevel,kuudraTier:i.kuudraTier,moneyPerHour:i.moneyPerHour,noWoodenBait:i.noWoodenBait},Q=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),_=yield Q.calculateOptimalPath(y,i.quantity,j);t(_);const v=yield Q.parseData(j);o(v)}catch(a){a instanceof Error&&!a.message.includes("not found")&&console.error("Calculation failed (customRates effect):",a)}})},[h,i,t,o,c]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>n(!s),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm cursor-pointer
              `,children:[s?e.jsx(ze,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[s?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${s?"block not-xl:mt-3":"hidden xl:block"}`,children:e.jsx(Xe,{onSubmit:d})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),u&&l&&e.jsx(Ve,{result:u,data:l,targetShardName:r}),!u&&!m&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},it=()=>e.jsx(Ze,{});export{it as CalculatorPage};
