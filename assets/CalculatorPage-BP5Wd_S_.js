var we=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var se=(u,t,l)=>t in u?we(u,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[t]=l,W=(u,t)=>{for(var l in t||(t={}))Le.call(t,l)&&se(u,l,t[l]);if(he)for(var l of he(t))Re.call(t,l)&&se(u,l,t[l]);return u},z=(u,t)=>ke(u,Ce(t));var pe=(u,t,l)=>se(u,typeof t!="symbol"?t+"":t,l);var A=(u,t,l)=>new Promise((m,i)=>{var r=x=>{try{o(l.next(x))}catch(h){i(h)}},n=x=>{try{o(l.throw(x))}catch(h){i(h)}},o=x=>x.done?m(x.value):Promise.resolve(x.value).then(r,n);o((l=l.apply(u,t)).next())});import{u as ie,j as e,M as fe,P as Te,f as H,K as Se,a as D,T as B,g as Ee,b as U,c as G,W as Me,N as Pe,B as ye,_ as ge}from"./index-Bs9tVf3u.js";import{R as Y,r as I}from"./vendor-Dt516RNf.js";import{D as ae,S as K}from"./dataService-DNDaW9B8.js";import{S as $e}from"./ShardAutocomplete-Bdr9R15Q.js";import{a as Qe,Z as Fe,R as _e,c as Oe,b as He,d as Ke,e as Ie,T as qe,f as be,H as je,X as We,M as ve,g as ze}from"./icons-DNYyJ9Q2.js";import{u as Ae}from"./useCustomRates-CAK-RgrM.js";import"./forms-CPIcrlzh.js";function Be(u){return A(this,null,function*(){return!u||typeof u!="string"?!1:!!(yield ae.getInstance().getShardNameToKeyMap())[u.trim().toLowerCase()]})}const Ue=({onSubmit:u})=>{const{form:t,setForm:l}=ie();Y.useEffect(()=>{A(null,null,function*(){t.shard&&t.shard.trim()!==""&&(yield Be(t.shard))&&u(z(W({},t),{frogPet:!1}))})},[t.shard,t.quantity]);const m=(s,d)=>{const c=z(W({},t),{[s]:d});l(c),s!=="shard"&&s!=="quantity"&&u(c)},i=()=>{const s=z(W({},t),{hunterFortune:121,newtLevel:10,salamanderLevel:10,lizardKingLevel:10,leviathanLevel:10,pythonLevel:10,kingCobraLevel:10,seaSerpentLevel:10,tiamatLevel:10,crocodileLevel:10,kuudraTier:"t5"});l(s),setTimeout(()=>{u(s)},0)},r=()=>{const s=t.shard,d=t.quantity,c={shard:s,quantity:d,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,crocodileLevel:0,kuudraTier:"none",moneyPerHour:1/0,noWoodenBait:!1};l(c),x(""),setTimeout(()=>{u(c)},0)};function n(s){if(!s)return 0;const d=s.trim().toLowerCase().match(/^([\d,.]+)([kmb])?$/);if(!d)return Number(s.replace(/,/g,""))||0;let c=parseFloat(d[1].replace(/,/g,""));const a=d[2];return a==="k"?c*=1e3:a==="m"?c*=1e6:a==="b"&&(c*=1e9),Math.round(c)}const[o,x]=Y.useState("");Y.useEffect(()=>{(t.moneyPerHour===void 0||t.moneyPerHour===null||t.moneyPerHour===0)&&o===""&&(m("moneyPerHour",1/0),u(z(W({},t),{moneyPerHour:1/0})))},[t.shard]),Y.useEffect(()=>{(t.moneyPerHour===null||t.moneyPerHour===void 0)&&o!==""&&x("")},[t.moneyPerHour]);const h=()=>{t.shard&&m("shard","")};return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx($e,{value:t.shard,onChange:s=>m("shard",s),onSelect:s=>{let d="common";if(s&&typeof s.rarity=="string"){const p=s.rarity.toLowerCase();p in fe&&(d=p)}const c=fe[d],a=z(W({},t),{shard:s.name,quantity:c});l(a),setTimeout(()=>u(a),0)},onFocus:h,placeholder:"Search for a shard...",searchMode:"name-only"})]}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.quantity===0?"":t.quantity,placeholder:"1",onChange:s=>m("quantity",Number(s.target.value)),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-1.5 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-colors duration-200"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:i,className:`\r
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 \r
                  text-amber-400 font-medium rounded-md text-xs\r
                  border border-amber-500/20 hover:border-amber-500/30\r
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer\r
                `,children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:r,className:`\r
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 \r
                  text-red-400 font-medium rounded-md text-xs\r
                  border border-red-500/20 hover:border-red-500/30\r
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer\r
                `,children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",{type:"number",min:"0",value:t.hunterFortune===0?"":t.hunterFortune,placeholder:"0",onChange:s=>m("hunterFortune",Number(s.target.value)),className:`\r
                  w-full px-3 py-2 text-sm\r
                  bg-white/5 border border-white/10 rounded-md\r
                  text-white placeholder-slate-400\r
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50\r
                  transition-colors duration-200\r
                `})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Chameleon"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.excludeChameleon,onClick:()=>m("excludeChameleon",!t.excludeChameleon),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.excludeChameleon?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.excludeChameleon?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.excludeChameleon?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 flex-1 cursor-pointer",children:"Exclude Wooden Bait"}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.noWoodenBait,onClick:()=>m("noWoodenBait",!t.noWoodenBait),className:`relative inline-flex h-6 w-11 items-center rounded-full border border-white/10 transition-colors duration-200 cursor-pointer
                    ${t.noWoodenBait?"bg-fuchsia-600":"bg-white/5"}
                    hover:border-fuchsia-400`,style:{boxShadow:"none"},children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full shadow transition-transform duration-200 border border-white/10
                    ${t.noWoodenBait?"bg-fuchsia-400":"bg-slate-300/70"}
                    ${t.noWoodenBait?"translate-x-5":"translate-x-0.5"}`,style:{paddingLeft:"1px"}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{key:"newtLevel",label:"Newt",shardId:"C35"},{key:"salamanderLevel",label:"Salamander",shardId:"U8"},{key:"lizardKingLevel",label:"Lizard King",shardId:"R8"},{key:"leviathanLevel",label:"Leviathan",shardId:"E5"},{key:"pythonLevel",label:"Python",shardId:"R9"},{key:"kingCobraLevel",label:"King Cobra",shardId:"R54"},{key:"seaSerpentLevel",label:"Sea Serpent",shardId:"E32"},{key:"tiamatLevel",label:"Tiamat",shardId:"L6"},{key:"crocodileLevel",label:"Crocodile",shardId:"R45"}].map(({key:s,label:d,shardId:c})=>{var p;const a=K[c];return e.jsx(Te,{value:t[s]||0,onChange:f=>m(s,f),label:d,tooltipTitle:a==null?void 0:a.title,tooltipContent:H((a==null?void 0:a.description)||"No description available."),tooltipShardName:d,tooltipShardIcon:c,tooltipRarity:((p=a==null?void 0:a.rarity)==null?void 0:p.toLowerCase())||"common",tooltipFamily:a==null?void 0:a.family,tooltipType:a==null?void 0:a.type,tooltipWarning:s==="crocodileLevel"?"Warning: May slow calculations significantly":void 0},s)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Se,{value:t.kuudraTier||"none",onChange:s=>m("kuudraTier",s),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",min:"0",value:o,onChange:s=>{if(x(s.target.value),s.target.value.trim()==="")m("moneyPerHour",1/0),u(z(W({},t),{moneyPerHour:1/0}));else{const d=n(s.target.value);m("moneyPerHour",d)}},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"}),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins / hr"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},ne=({tree:u,data:t,isTopLevel:l=!1,totalShardsProduced:m=u.quantity,nodeId:i,expandedStates:r,onToggle:n})=>{var V,re,le,ce,oe,de;const o=t.shards[u.shard],x=E=>{const g=t.recipes[E];if(!(g!=null&&g.length))return null;const b={U8:S=>S.inputs.includes("C35")&&S.inputs.includes("U38"),C35:S=>S.inputs.includes("C23")&&S.inputs.includes("U38")}[E];return b?g.find(b):g.sort((S,w)=>w.outputQuantity-S.outputQuantity)[0]},h=E=>E?e.jsx(He,{className:"w-6 h-6 text-amber-400"}):e.jsx(Ke,{className:"w-6 h-6 text-amber-400"}),s=(E,g,$=!0)=>{var S;const b=K[g.id];return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((b==null?void 0:b.description)||"No description available."),title:b==null?void 0:b.title,shardName:g.name,shardIcon:g.id,rarity:((S=b==null?void 0:b.rarity)==null?void 0:S.toLowerCase())||g.rarity,family:b==null?void 0:b.family,type:b==null?void 0:b.type,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})}),$&&e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]})},d=(E,g,$,b,S,w,M=!1,Q)=>{var q,F,O;const N=K[g.id],k=K[b.id],L=K[w.id];return e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium min-w-0",children:[M&&e.jsxs("span",{className:"font-normal text-sm text-amber-300 flex-shrink-0 mr-2",children:["Step ",Q,":"]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-white flex-shrink-0 text-sm",children:[E,"x"]}),e.jsx(B,{content:H((N==null?void 0:N.description)||"No description available."),title:N==null?void 0:N.title,shardName:g.name,shardIcon:g.id,rarity:((q=N==null?void 0:N.rarity)==null?void 0:q.toLowerCase())||g.rarity,family:N==null?void 0:N.family,type:N==null?void 0:N.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${g.id}.png`,alt:g.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(g.rarity)} whitespace-nowrap text-sm`,children:g.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"="}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[$,"x"]}),e.jsx(B,{content:H((k==null?void 0:k.description)||"No description available."),title:k==null?void 0:k.title,shardName:b.name,shardIcon:b.id,rarity:((F=k==null?void 0:k.rarity)==null?void 0:F.toLowerCase())||b.rarity,family:k==null?void 0:k.family,type:k==null?void 0:k.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${b.id}.png`,alt:b.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(b.rarity)} whitespace-nowrap text-sm`,children:b.name})]})})]}),e.jsx("span",{className:"flex-shrink-0 text-sm",children:"+"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsxs("span",{className:"text-slate-400 flex-shrink-0 text-sm",children:[S,"x"]}),e.jsx(B,{content:H((L==null?void 0:L.description)||"No description available."),title:(L==null?void 0:L.title)||w.name,shardName:w.name,shardIcon:w.id,rarity:((O=L==null?void 0:L.rarity)==null?void 0:O.toLowerCase())||w.rarity,family:L==null?void 0:L.family,type:L==null?void 0:L.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${w.id}.png`,alt:w.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(w.rarity)} whitespace-nowrap text-sm`,children:w.name})]})})]})]})},c=(E,g)=>e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full flex-shrink-0"}),e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2",children:s(E,g,!1)}),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:D(g.rate)}),e.jsx("span",{className:"text-slate-500 text-sm mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"hr"})]})]}),a=(E,g,$,b=1)=>{var q;const S=E.outputQuantity,w=t.shards[E.inputs[0]],M=t.shards[E.inputs[1]],Q=w.fuse_amount,N=M.fuse_amount,k=`${$}-${g.id}`,L=(q=r.get(k))!=null?q:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>n(k),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(L),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:d(S,g,Q,w,N,M)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:"1"})]})})]}),L&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 flex flex-col gap-0.5",children:E.inputs.map(F=>{const O=t.shards[F];if(!O)return null;const Z=x(F);return F==="C11"||F==="U38"||F==="C23"?e.jsx("div",{children:c(O.fuse_amount,O)},`direct-${F}`):Z&&b<2?e.jsx("div",{children:a(Z,O,k,b+1)},`sub-${F}`):null})})]})};if(u.method==="cycle"){const E=(V=r.get(i))!=null?V:!0,g=Math.ceil(u.quantity/(u.cycles[0].expectedOutput-u.cycles[0].baseOutput));return e.jsxs("div",{className:"flex flex-col border border-slate-400/70 rounded-md bg-slate-500/40",children:[e.jsxs("button",{className:"flex items-center justify-between w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors gap-2 sm:gap-8",onClick:()=>n(i),children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(E),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"text-sm text-amber-300 flex-shrink-0",children:[g," crafts"]}),e.jsx(Oe,{className:"w-6 text-amber-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 overflow-hidden",children:[s(Math.floor(u.quantity),o,!1),e.jsx("span",{className:"px-1 bg-amber-500/20 text-amber-400 border border-amber-400/40 text-sm font-medium rounded-md flex-shrink-0",children:"CYCLE !"})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:g})]})})]}),E&&u.cycles.length>0&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-2",children:u.cycles.map(($,b)=>e.jsxs("div",{children:[e.jsx("div",{className:"space-y-0.5",children:[...$.steps].slice().reverse().map((S,w)=>{var Z;const M=S.recipe,Q=t.shards[S.outputShard],N=t.shards[M.inputs[0]],k=t.shards[M.inputs[1]],L=N.fuse_amount,q=k.fuse_amount;let F=M.outputQuantity;M.isReptile&&(F*=$.multiplier);const O=$.steps.length-w;if(O===1){const te=`${i}-step-${O}`,me=(Z=r.get(te))!=null?Z:!0;return e.jsxs("div",{className:"bg-slate-600/20 rounded border border-slate-300/50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>n(te),className:"w-full px-3 py-1.5 text-left cursor-pointer hover:bg-slate-800/40 transition-colors flex items-center justify-between gap-2 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[h(me),e.jsx("div",{className:"min-w-0 flex-shrink-0 overflow-hidden",children:d(F,Q,L,N,q,k,!0,O)})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:$.expectedCrafts})]})})]}),me&&e.jsx("div",{className:"border-t border-slate-400/70 pl-3 pr-0.5 py-0.5 space-y-1",children:M.inputs.map(X=>{const ue=t.shards[X],xe=x(X);return xe&&ue&&X!=="C11"&&X!=="U38"&&X!=="C23"?e.jsx("div",{className:"space-y-1",children:a(xe,ue,i)},X):null})})]},w)}else return e.jsxs("div",{className:"px-3 py-1.5 bg-slate-600/20 rounded border border-slate-300/50 flex items-center justify-between gap-2 sm:gap-8",children:[e.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:d(F,Q,L,N,q,k,!0,O)}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:$.expectedCrafts})]})})]},w)})}),(()=>{const S=new Set($.steps.map(M=>M.outputShard)),w={};return $.steps.forEach(M=>{M.recipe.inputs.forEach(Q=>{const N=t.shards[Q];!N||S.has(Q)||(w[Q]||(w[Q]={quantity:0,shard:N}),w[Q].quantity+=N.fuse_amount)})}),e.jsx("div",{className:"flex flex-col gap-0.5 mt-0.5",children:Object.values(w).map(({quantity:M,shard:Q})=>e.jsx("div",{children:c(M*$.expectedCrafts,Q)},Q.id))})})()]},b))})]})}if(u.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 p-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s(u.quantity,o,!1),e.jsx("span",{className:"px-1 py-0.4 text-sm bg-green-500/20 text-green-400 border border-green-500/30 rounded-md flex-shrink-0",children:"Direct"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[D(o.rate),e.jsx("span",{className:"text-slate-500 text-xs font-bold mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"hr"})]})})]});const p=(re=r.get(i))!=null?re:!0,f=u.inputs[0],j=u.inputs[1],y=t.shards[f.shard],R=t.shards[j.shard],P="craftsNeeded"in u&&(le=u.craftsNeeded)!=null?le:1,_=l?m:u.quantity,v=K[o.id],C=K[y.id],T=K[R.id];return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>n(i),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-15 sm:gap-8 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 p-0.5 min-w-0 flex-1",children:[h(p),e.jsxs("div",{className:"text-white flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsxs("span",{className:"font-medium text-sm flex-shrink-0",children:[Math.floor(_),"x"]}),e.jsx(B,{content:H((v==null?void 0:v.description)||"No description available."),title:v==null?void 0:v.title,shardName:o.name,shardIcon:o.id,rarity:((ce=v==null?void 0:v.rarity)==null?void 0:ce.toLowerCase())||o.rarity,family:v==null?void 0:v.family,type:v==null?void 0:v.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${o.id}.png`,alt:o.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`font-medium ${U(o.rarity)} text-sm truncate`,title:Ee(o,!1),children:o.name})]})}),e.jsxs("span",{className:"text-slate-400 text-sm font-medium flex items-center gap-1 min-w-0 flex-shrink-0 overflow-hidden",children:[e.jsx("span",{className:"text-white flex-shrink-0 text-sm",children:"="}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(f.quantity),"x"]}),e.jsx(B,{content:H((C==null?void 0:C.description)||"No description available."),title:C==null?void 0:C.title,shardName:y.name,shardIcon:y.id,rarity:((oe=C==null?void 0:C.rarity)==null?void 0:oe.toLowerCase())||y.rarity,family:C==null?void 0:C.family,type:C==null?void 0:C.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${y.id}.png`,alt:y.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(y.rarity)} text-sm truncate`,children:y.name})]})}),e.jsx("span",{className:"flex-shrink-0 text-white text-sm",children:"+"}),e.jsxs("span",{className:"flex-shrink-0 text-sm",children:[Math.floor(j.quantity),"x"]}),e.jsx(B,{content:H((T==null?void 0:T.description)||"No description available."),title:T==null?void 0:T.title,shardName:R.name,shardIcon:R.id,rarity:((de=T==null?void 0:T.rarity)==null?void 0:de.toLowerCase())||R.rarity,family:T==null?void 0:T.family,type:T==null?void 0:T.type,className:"cursor-pointer min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-shrink-0",children:[e.jsx("img",{src:`/SkyShards/shardIcons/${R.id}.png`,alt:R.name,className:"w-6 h-6 object-contain flex-shrink-0",loading:"lazy"}),e.jsx("span",{className:`${U(R.rarity)} text-sm truncate`,children:R.name})]})})]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"font-medium text-white text-xs",children:P})]})})]})}),p&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(ne,{tree:f,data:t,nodeId:`${i}-0`,expandedStates:r,onToggle:n}),e.jsx(ne,{tree:j,data:t,nodeId:`${i}-1`,expandedStates:r,onToggle:n})]})]})},Ve=({result:u,data:t,targetShardName:l,noWoodenBait:m=!1})=>{const[i,r]=I.useState(new Map),[n,o]=I.useState(""),x=(c,a="root")=>{const p=new Map,f=(j,y)=>{j.method==="recipe"&&j.inputs&&(p.set(y,!0),j.inputs.forEach((R,P)=>{f(R,`${y}-${P}`)}))};return f(c,a),p};Y.useEffect(()=>{if(u.tree){const c=JSON.stringify(u.tree);if(c!==n){const a=x(u.tree);r(a),o(c)}}},[u.tree,n]);const h=()=>{const c=new Map(i);for(const a of c.keys())c.set(a,!0);r(c)},s=()=>{const c=new Map(i);for(const a of c.keys())c.set(a,!1);r(c)},d=c=>{const a=new Map(i);a.set(c,!a.get(c)),r(a)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Ie,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:G(u.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:Math.floor(u.totalShardsProduced)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[u.totalFusions,"x",u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),u.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:G(u.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2.5 flex-wrap items-start sm:items-center sm:justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"flex gap-2",children:[!m&&(()=>{const c=Array.from(u.totalQuantities).filter(([f])=>{var j,y;return["shinyfish","inferno koi","abyssal lanternfish","silentdepth"].includes((y=(j=t.shards[f])==null?void 0:j.name)==null?void 0:y.toLowerCase())});if(c.length===0)return null;const a=c.reduce((f,[j,y])=>{var _,v;const P=((v=(_=t.shards[j])==null?void 0:_.name)==null?void 0:v.toLowerCase())==="shinyfish"?512:1024;return f+y*P},0),p=f=>f>=1e9?(f/1e9).toFixed(1).replace(/\.0$/,"")+"b":f>=1e6?(f/1e6).toFixed(1).replace(/\.0$/,"")+"m":f>=1e3?(f/1e3).toFixed(1).replace(/\.0$/,"")+"k":f.toString();return e.jsxs("div",{className:"flex gap-1 items-center px-3 py-1.5 bg-fuchsia-500/20 border border-fuchsia-500/30 text-fuchsia-400 text-sm font-medium rounded-md min-w-0",children:[e.jsx("span",{className:"text-slate-300",children:p(a)}),e.jsx("span",{className:"truncate",children:"Forest Essence"})]})})(),e.jsxs("div",{className:"px-3 py-1.5 flex gap-1 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md min-w-0",children:[e.jsxs("span",{className:"text-slate-300",children:[Math.floor(u.totalShardsProduced),"x"]}),e.jsx("span",{className:"truncate",children:l}),e.jsxs("span",{className:"text-slate-400 whitespace-nowrap",children:[Math.floor(u.craftsNeeded)," craft",Math.floor(u.craftsNeeded)>1?"s":""]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(u.totalQuantities).map(([c,a])=>{var R;const p=t.shards[c],f=a,j=f/p.rate,y=K[p.id];return e.jsxs("div",{className:"bg-slate-700 border border-slate-600 rounded-md px-3 pt-1 pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start min-w-0 justify-center h-full",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-base flex-shrink-0",children:[f,"x"]}),e.jsx(B,{content:H((y==null?void 0:y.description)||"No description available."),title:y==null?void 0:y.title,shardName:p.name,shardIcon:p.id,rarity:((R=y==null?void 0:y.rarity)==null?void 0:R.toLowerCase())||p.rarity,family:y==null?void 0:y.family,type:y==null?void 0:y.type,className:"cursor-pointer",children:e.jsxs("span",{className:`mt-0 font-medium text-sm ${U(p.rarity)} flex items-center flex-shrink-0`,children:[e.jsx("img",{src:`/SkyShards/shardIcons/${p.id}.png`,alt:p.name,className:"w-5 h-5 object-contain flex-shrink-0 inline-block align-middle mr-2",loading:"lazy"}),p.name]})})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2 justify-center h-full",children:[e.jsxs("div",{className:"text-sm text-slate-400 whitespace-nowrap",children:[D(p.rate)," ",e.jsx("span",{className:"text-slate-500 font-bold",children:" / "})," ",e.jsx("span",{className:"text-slate-500",children:"hr"})]}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-nowrap mt-1",children:G(j)})]})]},c)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(be,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:e.jsx("div",{className:"min-w-fit",children:e.jsx(ne,{tree:u.tree,data:t,isTopLevel:!0,totalShardsProduced:u.totalShardsProduced,nodeId:"root",expandedStates:i,onToggle:d})})})]})]})},J=class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}parseData(t){return A(this,null,function*(){var l,m;try{const[i,r]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),n=yield i.json(),o=yield r.json(),x={};for(const s in n.recipes){x[s]=[];for(const d in n.recipes[s]){const c=parseInt(d);n.recipes[s][d].forEach(p=>{const f=p.some(j=>n.shards[j].family.includes("Reptile"));x[s].push({inputs:p,outputQuantity:c,isReptile:f})})}}const h={};for(const s in n.shards){let d=(m=(l=t.customRates[s])!=null?l:o[s])!=null?m:0;if(s==="L15"&&d===0){const c=t.moneyPerHour==null?1/0:t.moneyPerHour;d=this.calculateKuudraRate(t.kuudraTier,c)}d>0&&(t.noWoodenBait&&Me.includes(s)&&(d*=.2),Pe.includes(s)||(d=this.applyFortuneModifiers(d,s,n.shards[s],t))),t.excludeChameleon&&s==="L4"&&(d=0),h[s]=z(W({},n.shards[s]),{id:s,rate:d})}return{recipes:x,shards:h}}catch(i){throw new Error(`Failed to parse data: ${i}`)}})}calculateKuudraRate(t,l){const i={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[t];if(!i)return 0;let r;return l===1/0?r=0:l===0?r=1e12:r=i.cost/l*3600,i.multiplier*(3600/(i.baseTime+r))}applyFortuneModifiers(t,l,m,i){let r=i.hunterFortune;const n=1+5*i.tiamatLevel/100,o=1+2*i.seaSerpentLevel/100*n,x=2*i.pythonLevel/100*o,h=i.kingCobraLevel/100*o;switch(m.rarity){case"common":r+=2*i.newtLevel;break;case"uncommon":r+=2*i.salamanderLevel;break;case"rare":r+=i.lizardKingLevel;break;case"epic":r+=i.leviathanLevel;break}return i.frogPet&&(t*=1.1),l in ye&&(ye[l]&&(t*=1+x),r*=1+h),t*(1+r/100)}computeMinCosts(t,l,m,i){const r=new Map,n=new Map,o=Object.keys(t.shards),x=1+5*i/100,h=1+2*m/100*x,s=1+2*l/100*h,d=.8/3600;o.forEach(a=>{const p=t.shards[a].rate>0?1/t.shards[a].rate:1/0;r.set(a,p),n.set(a,{recipe:null})});let c=!0;for(;c;)c=!1,o.forEach(a=>{(t.recipes[a]||[]).forEach(f=>{const[j,y]=f.inputs,R=t.shards[j].fuse_amount,P=t.shards[y].fuse_amount,_=r.get(j)*R,v=r.get(y)*P,C=_+v+d,T=f.isReptile?f.outputQuantity*s:f.outputQuantity,V=C/T;V<r.get(a)&&(r.set(a,V),n.set(a,{recipe:f}),c=!0)})});return{minCosts:r,choices:n}}findCycleNodes(t){const l=new Map;for(const[s,d]of t)d.recipe&&l.set(s,d.recipe.inputs);let m=0;const i=new Map,r=new Map,n=new Map,o=[],x=[],h=s=>{var c;i.set(s,m),r.set(s,m),m++,o.push(s),n.set(s,!0);const d=l.get(s)||[];for(const a of d)l.has(a)&&(i.has(a)?n.get(a)&&r.set(s,Math.min(r.get(s),i.get(a))):(h(a),r.set(s,Math.min(r.get(s),r.get(a)))));if(r.get(s)===i.get(s)){const a=[];let p;do p=o.pop(),n.set(p,!1),a.push(p);while(p!==s);(a.length>1||a.length===1&&((c=l.get(s))!=null&&c.includes(s)))&&x.push(a)}};for(const s of l.keys())i.has(s)||h(s);return x}buildCycle(t,l,m){const i=[];for(const r of m)if(r.includes(t)){const n=[];for(const o of r){const x=l.get(o);x!=null&&x.recipe&&n.push({outputShard:o,recipe:x.recipe})}i.push(n)}return i}buildRecipeTree(t,l,m,i){if(i.flat().includes(l)){const n=this.buildCycle(l,m,i),{minCosts:o,choices:x}=this.computeMinCosts(t,0,0,0),h=i.flat().reduce((c,a)=>o.get(a)<o.get(c)?a:c,i.flat()[0]),s=this.buildRecipeTree(t,h,x,[]),d={total:0};return this.assignQuantities(s,t.shards[h].fuse_amount,t,d,x,1),{shard:l,method:"cycle",quantity:0,cycles:n.map(c=>({steps:c,expectedCrafts:0,expectedOutput:0,baseOutput:0,multiplier:1})),craftsNeeded:0,inputRecipe:s}}const r=m.get(l);if(r.recipe===null)return{shard:l,method:"direct",quantity:0};{const n=r.recipe,[o,x]=n.inputs,h=this.buildRecipeTree(t,o,m,i),s=this.buildRecipeTree(t,x,m,i);return i.flat().includes(l)?{shard:l,method:"cycleNode",recipe:n,inputs:[h,s],quantity:0,craftsNeeded:0}:{shard:l,method:"recipe",recipe:n,inputs:[h,s],quantity:0,craftsNeeded:0}}}assignQuantities(t,l,m,i,r,n){switch(t.quantity=l,t.method){case"recipe":{const o=t.recipe,x=o.isReptile?o.outputQuantity*n:o.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,i.total+=h;const[s,d]=o.inputs,c=m.shards[s].fuse_amount,a=m.shards[d].fuse_amount,p=h*c,f=h*a;this.assignQuantities(t.inputs[0],p,m,i,r,n),this.assignQuantities(t.inputs[1],f,m,i,r,n);break}case"cycleNode":{const o=t.recipe,x=o.isReptile?o.outputQuantity*n:o.outputQuantity,h=Math.ceil(l/x);t.craftsNeeded=h,i.total+=h;const[s,d]=o.inputs,c=m.shards[s].fuse_amount,a=m.shards[d].fuse_amount;this.assignQuantities(t.inputs[0],c,m,i,r,n),this.assignQuantities(t.inputs[1],a,m,i,r,n);break}case"cycle":for(const o of t.cycles){const x=o.steps.find(f=>f.outputShard===t.shard);if(!x)continue;const h=x.recipe,s=h.outputQuantity,d=h.isReptile?s*n:s;let c=0;o.steps.forEach(f=>{f.recipe.inputs.forEach(j=>{if(j===t.shard){const y=m.shards[j];c+=y.fuse_amount}})});const a=2*(d-c),p=a>0?Math.ceil(l/a):Math.ceil(l/d);o.expectedCrafts=p,o.expectedOutput=d,o.baseOutput=s,o.multiplier=n,i.total+=p*o.steps.length}if(t.craftsNeeded=t.cycles.reduce((o,x)=>o+(x.expectedCrafts||0),0),t.cycles.length>0){const o=t.cycles[0].expectedCrafts,x=new Map;t.cycles[0].steps.forEach(s=>{s.recipe.inputs.forEach(d=>{const c=m.shards[d],a=x.get(d)||0;x.set(d,a+c.fuse_amount)})});const h=new Set(t.cycles[0].steps.map(s=>s.outputShard));x.forEach((s,d)=>{if(!h.has(d)){const c=s*o,a=r.get(d);if(a&&a.recipe){const p=this.buildRecipeTree(m,d,r,[]);this.assignQuantities(p,c,m,i,r,n)}}})}break}}collectTotalQuantities(t,l){const m=new Map,i=r=>{switch(r.method){case"direct":m.set(r.shard,(m.get(r.shard)||0)+r.quantity);break;case"recipe":case"cycleNode":r.inputs.forEach(i);break;case"cycle":if(r.cycles.length>0){for(const n of r.cycles){const o=r.cycles[0].expectedCrafts,x=new Map;n.steps.forEach(h=>{const[s,d]=h.recipe.inputs,c=l.shards[s].fuse_amount,a=l.shards[d].fuse_amount;l.shards[s].family.includes("Reptile")||x.set(s,(x.get(s)||0)+o*c),l.shards[d].family.includes("Reptile")||x.set(d,(x.get(d)||0)+o*a)}),x.forEach((h,s)=>{m.set(s,(m.get(s)||0)+h)})}i(r.inputRecipe)}break}};return i(t),m}calculateOptimalPath(t,l,m){return A(this,null,function*(){var _;const i=yield this.parseData(m);if(!i.shards[t])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:t,method:"direct",quantity:0}};const{minCosts:r,choices:n}=this.computeMinCosts(i,m.crocodileLevel,m.seaSerpentLevel,m.tiamatLevel),o=m.crocodileLevel>0?this.findCycleNodes(n):[],x=this.buildRecipeTree(i,t,n,o),h={total:0},s=1+5*m.tiamatLevel/100,d=1+2*m.seaSerpentLevel/100*s,c=1+2*m.crocodileLevel/100*d;this.assignQuantities(x,l,i,h,n,c);const a=this.collectTotalQuantities(x,i);let p=l,f=1;const j=n.get(t);if(j!=null&&j.recipe){const v=j.recipe.isReptile?j.recipe.outputQuantity*c:j.recipe.outputQuantity;f=Math.ceil(l/v),p=f*v}const y=(_=r.get(t))!=null?_:0,R=y*p,P=h.total*.8/3600;return{timePerShard:y,totalTime:R,totalShardsProduced:p,craftsNeeded:f,totalQuantities:a,totalFusions:h.total,craftTime:P,tree:x}})}};pe(J,"instance");let ee=J;const Ne=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:ee},Symbol.toStringTag,{value:"Module"})),Je=()=>{const[u,t]=I.useState(null),[l,m]=I.useState(!1),[i,r]=I.useState(null),n=I.useCallback((x,h,s)=>A(null,null,function*(){try{m(!0),r(null);const c=yield ee.getInstance().calculateOptimalPath(x,h,s);t(c)}catch(d){r(d instanceof Error?d.message:"Calculation failed"),t(null)}finally{m(!1)}}),[]),o=I.useCallback(()=>{t(null),r(null)},[]);return{result:u,loading:l,error:i,calculate:n,clearResult:o}},Xe=({onSubmit:u})=>{const{setForm:t}=ie();return e.jsx(Ue,{onSubmit:l=>u(l,t)})},Ze=()=>{const{result:u,setResult:t,calculationData:l,setCalculationData:m,targetShardName:i,setTargetShardName:r,form:n}=ie(),{loading:o,error:x}=Je(),{customRates:h}=Ae(),[s,d]=I.useState(!1),c=(a,p)=>A(null,null,function*(){p(a);try{if(!a.shard||a.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}const y=(yield ae.getInstance().getShardNameToKeyMap())[a.shard.toLowerCase()];if(!y){console.warn(`Calculation skipped: Shard "${a.shard}" not found in data`);return}r(a.shard);const P={customRates:Object.fromEntries(Object.entries(h).filter(([,V])=>V!==void 0)),hunterFortune:a.hunterFortune,excludeChameleon:a.excludeChameleon,frogPet:a.frogPet,newtLevel:a.newtLevel,salamanderLevel:a.salamanderLevel,lizardKingLevel:a.lizardKingLevel,leviathanLevel:a.leviathanLevel,pythonLevel:a.pythonLevel,kingCobraLevel:a.kingCobraLevel,seaSerpentLevel:a.seaSerpentLevel,tiamatLevel:a.tiamatLevel,crocodileLevel:a.crocodileLevel,kuudraTier:a.kuudraTier,moneyPerHour:a.moneyPerHour,noWoodenBait:a.noWoodenBait},v=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),C=yield v.calculateOptimalPath(y,a.quantity,P);t(C);const T=yield v.parseData(P);m(T)}catch(f){f instanceof Error&&!f.message.includes("not found")&&console.error("Calculation failed:",f)}});return I.useEffect(()=>{n&&n.shard&&n.shard.trim()!==""&&A(null,null,function*(){try{const f=(yield ae.getInstance().getShardNameToKeyMap())[n.shard.toLowerCase()];if(!f)return;r(n.shard);const y={customRates:Object.fromEntries(Object.entries(h).filter(([,C])=>C!==void 0)),hunterFortune:n.hunterFortune,excludeChameleon:n.excludeChameleon,frogPet:n.frogPet,newtLevel:n.newtLevel,salamanderLevel:n.salamanderLevel,lizardKingLevel:n.lizardKingLevel,leviathanLevel:n.leviathanLevel,pythonLevel:n.pythonLevel,kingCobraLevel:n.kingCobraLevel,seaSerpentLevel:n.seaSerpentLevel,tiamatLevel:n.tiamatLevel,crocodileLevel:n.crocodileLevel,kuudraTier:n.kuudraTier,moneyPerHour:n.moneyPerHour,noWoodenBait:n.noWoodenBait},P=(yield ge(()=>Promise.resolve().then(()=>Ne),void 0)).CalculationService.getInstance(),_=yield P.calculateOptimalPath(f,n.quantity,y);t(_);const v=yield P.parseData(y);m(v)}catch(a){a instanceof Error&&!a.message.includes("not found")&&console.error("Calculation failed (customRates effect):",a)}})},[h,n,t,m,r]),e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>d(!s),className:`\r
                w-full px-3 py-2.5 \r
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30\r
                rounded-md text-white hover:bg-purple-500/20 \r
                flex items-center justify-center space-x-2 \r
                transition-colors duration-200 font-medium text-sm cursor-pointer\r
              `,children:[s?e.jsx(We,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[s?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${s?"block not-xl:mt-3":"hidden xl:block"}`,children:e.jsx(Xe,{onSubmit:c})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[x&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(ze,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:x})]})]}),u&&l&&e.jsx(Ve,{result:u,data:l,targetShardName:i,noWoodenBait:n==null?void 0:n.noWoodenBait}),!u&&!o&&!x&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Configure your settings and select a shard to see optimal fusion paths"})]})})]})]})})},it=()=>e.jsx(Ze,{});export{it as CalculatorPage};
