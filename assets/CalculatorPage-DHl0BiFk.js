var ue=Object.defineProperty,me=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var F=(r,s,t)=>s in r?ue(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t,w=(r,s)=>{for(var t in s||(s={}))he.call(s,t)&&F(r,t,s[t]);if(Q)for(var t of Q(s))pe.call(s,t)&&F(r,t,s[t]);return r},S=(r,s)=>me(r,xe(s));var q=(r,s,t)=>F(r,typeof s!="symbol"?s+"":s,t);var k=(r,s,t)=>new Promise((n,l)=>{var i=d=>{try{c(t.next(d))}catch(m){l(m)}},a=d=>{try{c(t.throw(d))}catch(m){l(m)}},c=d=>d.done?n(d.value):Promise.resolve(d.value).then(i,a);c((t=t.apply(r,s)).next())});import{j as e,_ as fe}from"./index-CGazPbuG.js";import{r as f,R as I}from"./vendor-lM--12k9.js";import{o as H,s as B,a as X,b as G,c as A,n as N,e as be,d as Y,u as ge}from"./forms-DE1HYwwM.js";import{d as ve,D as O,g as T,M as E,K as je,f as R,a as ee,b as V,W as ye,N as Ne,B as U,u as we}from"./useCustomRates-CRvHpbg-.js";import{a as Se,X as te,S as ke,Z as Ce,R as Te,b as Le,T as Pe,c as W,H as Z,d as Ee,e as Me,M as $,f as Re}from"./icons-ub95DieP.js";function se(r,s,t){var c;function n(d,m){var x,o;var u;Object.defineProperty(d,"_zod",{value:(x=d._zod)!=null?x:{},enumerable:!1}),(o=(u=d._zod).traits)!=null||(u.traits=new Set),d._zod.traits.add(r),s(d,m);for(const h in a.prototype)h in d||Object.defineProperty(d,h,{value:a.prototype[h].bind(d)});d._zod.constr=a,d._zod.def=m}const l=(c=t==null?void 0:t.Parent)!=null?c:Object;class i extends l{}Object.defineProperty(i,"name",{value:r});function a(d){var x;var m;const u=t!=null&&t.Parent?new i:this;n(u,d),(x=(m=u._zod).deferred)!=null||(m.deferred=[]);for(const o of u._zod.deferred)o();return u}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:d=>{var m,u;return t!=null&&t.Parent&&d instanceof t.Parent?!0:(u=(m=d==null?void 0:d._zod)==null?void 0:m.traits)==null?void 0:u.has(r)}}),Object.defineProperty(a,"name",{value:r}),a}class _e extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Oe={};function re(r){return Oe}function ze(r,s){return typeof s=="bigint"?s.toString():s}const ne=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function _(r){return typeof r=="string"?r:r==null?void 0:r.message}function ae(r,s,t){var l,i,a,c,d,m,u,x,o,h,p;const n=S(w({},r),{path:(l=r.path)!=null?l:[]});if(!r.message){const b=(p=(h=(x=(m=_((c=(a=(i=r.inst)==null?void 0:i._zod.def)==null?void 0:a.error)==null?void 0:c.call(a,r)))!=null?m:_((d=s==null?void 0:s.error)==null?void 0:d.call(s,r)))!=null?x:_((u=t.customError)==null?void 0:u.call(t,r)))!=null?h:_((o=t.localeError)==null?void 0:o.call(t,r)))!=null?p:"Invalid input";n.message=b}return delete n.inst,delete n.continue,s!=null&&s.reportInput||delete n.input,n}const le=(r,s)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:s,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(s,ze,2)},enumerable:!0})},Ie=se("$ZodError",le),oe=se("$ZodError",le,{Parent:Error}),Ke=r=>(s,t,n,l)=>{var c;const i=n?Object.assign(n,{async:!1}):{async:!1},a=s._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new _e;if(a.issues.length){const d=new((c=l==null?void 0:l.Err)!=null?c:r)(a.issues.map(m=>ae(m,i,re())));throw ne(d,l==null?void 0:l.callee),d}return a.value},Fe=Ke(oe),Ae=r=>(s,t,n,l)=>k(null,null,function*(){var c;const i=n?Object.assign(n,{async:!0}):{async:!0};let a=s._zod.run({value:t,issues:[]},i);if(a instanceof Promise&&(a=yield a),a.issues.length){const d=new((c=l==null?void 0:l.Err)!=null?c:r)(a.issues.map(m=>ae(m,i,re())));throw ne(d,l==null?void 0:l.callee),d}return a.value}),$e=Ae(oe);function J(r,s){try{var t=r()}catch(n){return s(n)}return t&&t.then?t.then(void 0,s):t}function De(r,s){for(var t={};r.length;){var n=r[0],l=n.code,i=n.message,a=n.path.join(".");if(!t[a])if("unionErrors"in n){var c=n.unionErrors[0].errors[0];t[a]={message:c.message,type:c.code}}else t[a]={message:i,type:l};if("unionErrors"in n&&n.unionErrors.forEach(function(u){return u.errors.forEach(function(x){return r.push(x)})}),s){var d=t[a].types,m=d&&d[n.code];t[a]=X(a,s,t,l,m?[].concat(m,n.message):n.message)}r.shift()}return t}function Qe(r,s){for(var t={};r.length;){var n=r[0],l=n.code,i=n.message,a=n.path.join(".");if(!t[a])if(n.code==="invalid_union"){var c=n.errors[0][0];t[a]={message:c.message,type:c.code}}else t[a]={message:i,type:l};if(n.code==="invalid_union"&&n.errors.forEach(function(u){return u.forEach(function(x){return r.push(x)})}),s){var d=t[a].types,m=d&&d[n.code];t[a]=X(a,s,t,l,m?[].concat(m,n.message):n.message)}r.shift()}return t}function qe(r,s,t){if(t===void 0&&(t={}),function(n){return"_def"in n&&typeof n._def=="object"&&"typeName"in n._def}(r))return function(n,l,i){try{return Promise.resolve(J(function(){return Promise.resolve(r[t.mode==="sync"?"parse":"parseAsync"](n,s)).then(function(a){return i.shouldUseNativeValidation&&H({},i),{errors:{},values:t.raw?Object.assign({},n):a}})},function(a){if(function(c){return Array.isArray(c==null?void 0:c.issues)}(a))return{values:{},errors:B(De(a.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}};if(function(n){return"_zod"in n&&typeof n._zod=="object"}(r))return function(n,l,i){try{return Promise.resolve(J(function(){return Promise.resolve((t.mode==="sync"?Fe:$e)(r,n,s)).then(function(a){return i.shouldUseNativeValidation&&H({},i),{errors:{},values:t.raw?Object.assign({},n):a}})},function(a){if(function(c){return c instanceof Ie}(a))return{values:{},errors:B(Qe(a.issues,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const He=G({shard:Y().min(1,"Please select a shard"),quantity:N().min(1,"Quantity must be at least 1"),hunterFortune:N().min(0,"Hunter Fortune must be non-negative"),excludeChameleon:A(),frogPet:A(),newtLevel:N().min(0).max(10),salamanderLevel:N().min(0).max(10),lizardKingLevel:N().min(0).max(10),leviathanLevel:N().min(0).max(10),pythonLevel:N().min(0).max(10),kingCobraLevel:N().min(0).max(10),seaSerpentLevel:N().min(0).max(10),tiamatLevel:N().min(0).max(10),kuudraTier:be(["none","t1","t2","t3","t4","t5"]),moneyPerHour:N().min(0),noWoodenBait:A()});G({shardId:Y(),rate:N().min(0)});const Be=I.memo(({shard:r,index:s,focusedIndex:t,onSelect:n,isSelecting:l,setFocusedIndex:i})=>{const a=f.useCallback(d=>{d.preventDefault(),d.stopPropagation(),n(r)},[n,r]),c=f.useCallback(()=>{l||i(s)},[l,i,s]);return e.jsx("li",{className:`px-3 py-2.5 cursor-pointer border-b border-slate-700 last:border-b-0 ${s===t?"bg-purple-600 text-white":"text-slate-200 hover:bg-slate-700"}`,onMouseDown:a,onClick:a,onMouseEnter:c,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-medium truncate ${T(r.rarity)}`,children:r.name}),e.jsxs("div",{className:"text-xs opacity-75 truncate",children:[r.family," • ",r.type]})]}),r.rate>0&&e.jsxs("div",{className:"text-xs font-mono bg-slate-900/50 px-2 py-1 rounded ml-2",children:[r.rate,"/hr"]})]})})}),Ve=({value:r,onChange:s,onSelect:t,placeholder:n="Search for a shard...",className:l=""})=>{const[i,a]=f.useState([]),[c,d]=f.useState(!1),[m,u]=f.useState(-1),[x,o]=f.useState(!1),[h,p]=f.useState(!1),b=f.useRef(null),j=f.useRef(null),v=f.useRef(null),L=f.useMemo(()=>ve(g=>k(null,null,function*(){if(g.length===0||x){a([]),d(!1),p(!1);return}p(!0);try{const P=yield O.getInstance().searchShards(g);a(P.slice(0,10)),d(P.length>0),u(-1)}catch(y){console.error("Search failed:",y),a([]),d(!1)}finally{p(!1)}}),100),[x]),K=f.useCallback(g=>{const y=g.target.value;o(!1),s(y),v.current&&clearTimeout(v.current),L(y)},[s,L]),M=f.useCallback(g=>{o(!0),d(!1),a([]),u(-1),s(g.name),t(g),v.current&&clearTimeout(v.current),setTimeout(()=>{o(!1),b.current&&b.current.blur()},50)},[s,t]),ie=f.useCallback(g=>{if(!(!c||i.length===0||x))switch(g.key){case"ArrowDown":g.preventDefault(),u(y=>(y+1)%i.length);break;case"ArrowUp":g.preventDefault(),u(y=>y<=0?i.length-1:y-1);break;case"Enter":g.preventDefault(),m>=0&&m<i.length?M(i[m]):i.length===1&&M(i[0]);break;case"Escape":d(!1),u(-1);break}},[c,i,x,m,M]),ce=f.useCallback(()=>{var g;o(!1),s(""),a([]),d(!1),u(-1),v.current&&clearTimeout(v.current),(g=b.current)==null||g.focus()},[s]),de=f.useCallback(()=>{x||r.trim()&&L(r)},[x,r,L]);return f.useEffect(()=>{const g=y=>{const P=y.target;b.current&&!b.current.contains(P)&&j.current&&!j.current.contains(P)&&(d(!1),u(-1))};return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g),v.current&&clearTimeout(v.current)}},[]),e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:h?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(Se,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:b,type:"text",value:r,onChange:K,onKeyDown:ie,onFocus:de,placeholder:n,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),r&&e.jsx("button",{onClick:ce,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(te,{className:"h-4 w-4"})})]}),c&&i.length>0&&!x&&e.jsx("ul",{ref:j,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:i.map((g,y)=>e.jsx(Be,{shard:g,index:y,focusedIndex:m,onSelect:M,isSelecting:x,setFocusedIndex:u},g.key))})]})},Ue=I.memo(({value:r,onChange:s,label:t})=>{const n=f.useMemo(()=>Array.from({length:11},(l,i)=>i),[]);return e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsx("select",{value:r,onChange:l=>s(Number(l.target.value)),className:"w-full px-2 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-xs focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 appearance-none cursor-pointer hover:border-slate-500 transition-colors",children:n.map(l=>e.jsxs("option",{value:l,className:"bg-slate-800 text-white",children:["Level ",l]},l))})]})}),We=I.memo(({value:r,onChange:s,label:t})=>e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsx("select",{value:r,onChange:n=>s(n.target.value),className:"w-full px-2 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-xs focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 appearance-none cursor-pointer hover:border-slate-500 transition-colors",children:je.map(n=>e.jsx("option",{value:n.value,className:"bg-slate-800 text-white",children:n.label},n.value))})]})),Ze=({onSubmit:r})=>{const{register:s,setValue:t,watch:n,reset:l,formState:{errors:i}}=ge({resolver:qe(He),defaultValues:{shard:"",quantity:1,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1}}),a=n("shard"),c=n();f.useEffect(()=>{const o=h=>k(null,null,function*(){if(!h||h.trim()==="")return!1;try{return!!(yield O.getInstance().getShardNameToKeyMap())[h.toLowerCase()]}catch(p){return!1}});if(a&&a.trim()!==""&&c.shard&&c.shard.trim()!==""){const h=setTimeout(()=>k(null,null,function*(){if(yield o(c.shard)){const b=c,j=S(w({},b),{frogPet:!b.frogPet});r(j)}}),1e3);return()=>clearTimeout(h)}},[c,r,a]);const d=o=>{t("shard",o.name),setTimeout(()=>{const h=n(),p=S(w({},h),{shard:o.name,frogPet:!h.frogPet});r(p)},100)},m=()=>{t("hunterFortune",121),t("newtLevel",10),t("salamanderLevel",10),t("lizardKingLevel",10),t("leviathanLevel",10),t("pythonLevel",10),t("kingCobraLevel",10),t("seaSerpentLevel",10),t("tiamatLevel",10)},u=()=>{const o=n("shard"),h=n("quantity");l(),t("shard",o),t("quantity",h)},x=()=>k(null,null,function*(){const o=a;if(!o||o.trim()===""){t("quantity",E.common);return}try{const p=yield O.getInstance().getShardByName(o);if(p){const b=E[p.rarity]||E.common;t("quantity",b)}else t("quantity",E.common)}catch(h){console.error("Failed to get shard rarity:",h),t("quantity",E.common)}});return e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3 space-y-3",children:e.jsxs("form",{onSubmit:o=>o.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-200 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full"}),"Target Shard"]}),e.jsx(Ve,{value:a,onChange:o=>t("shard",o),onSelect:d,placeholder:"Search for a shard..."}),i.shard&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:i.shard.message})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",S(w({type:"number",min:"1"},s("quantity",{valueAsNumber:!0})),{onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),o.currentTarget.blur())},className:"w-full px-2 py-2 text-sm bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors"})),i.quantity&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:i.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:" "}),e.jsx("button",{type:"button",onClick:x,className:`
                  w-full h-[36px] px-2 py-1.5 bg-purple-500/20 hover:bg-purple-500/30 
                  text-purple-400 font-medium rounded-lg 
                  border border-purple-500/20 hover:border-purple-500/30
                  transition-colors duration-200
                  flex items-center justify-center cursor-pointer text-xs
                `,children:"Max"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-slate-200",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded",children:e.jsx(ke,{className:"w-4 h-4 text-purple-400"})}),"Settings"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:m,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-lg 
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200
                  flex items-center space-x-1 cursor-pointer text-xs
                `,children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:u,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-lg 
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200
                  flex items-center space-x-1 cursor-pointer text-xs
                `,children:[e.jsx(Te,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-300 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",S(w({type:"number",min:"0"},s("hunterFortune",{valueAsNumber:!0})),{onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),o.currentTarget.blur())},className:"w-full px-2 py-2 text-sm bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-fuchsia-500 focus:ring-1 focus:ring-fuchsia-500/20 hover:border-slate-500 transition-colors"}))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-slate-800 border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors cursor-pointer",children:[e.jsx("input",S(w({id:"excludeChameleon",type:"checkbox"},s("excludeChameleon")),{className:"w-3 h-3 rounded bg-slate-700 border border-slate-500 text-purple-500 focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 transition-colors checked:bg-purple-500 checked:border-purple-500 cursor-pointer"})),e.jsx("label",{htmlFor:"excludeChameleon",className:"text-xs font-medium text-white cursor-pointer flex-1",children:"Exclude Chameleon"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-slate-800 border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors cursor-pointer",children:[e.jsx("input",S(w({id:"excludeWoodenBait",type:"checkbox"},s("noWoodenBait")),{className:"w-3 h-3 rounded bg-slate-700 border border-slate-500 text-purple-500 focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 transition-colors checked:bg-purple-500 checked:border-purple-500 cursor-pointer"})),e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-xs font-medium text-white cursor-pointer flex-1",children:"Exclude Wooden Bait"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-slate-800 border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors cursor-pointer",children:[e.jsx("input",S(w({id:"frogPet",type:"checkbox"},s("frogPet")),{className:"w-3 h-3 rounded bg-slate-700 border border-slate-500 text-purple-500 focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 transition-colors checked:bg-purple-500 checked:border-purple-500 cursor-pointer"})),e.jsx("label",{htmlFor:"frogPet",className:"text-xs font-medium text-white cursor-pointer flex-1",children:"No Frog Pet"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xs font-medium text-slate-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:o,label:h})=>e.jsx(Ue,{value:n(o)||0,onChange:p=>t(o,p),label:h},o))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xs font-medium text-slate-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(We,{value:n("kuudraTier")||"t5",onChange:o=>t("kuudraTier",o),label:"Kuudra Tier"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Coins/hour"}),e.jsx("input",S(w({type:"number",min:"0",placeholder:"40000000"},s("moneyPerHour",{valueAsNumber:!0})),{onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),o.currentTarget.blur())},className:"w-full px-2 py-2 text-sm bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors"})),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},D=({tree:r,data:s,isTopLevel:t=!1,totalShardsProduced:n=r.quantity,nodeId:l,expandedStates:i,onToggle:a})=>{var p;const c=s.shards[r.shard],d=(p=i.get(l))!=null?p:!0;if(r.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-800 rounded-lg border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[r.quantity,"x"]}),e.jsx("span",{className:`font-medium ${T(c.rarity)}`,title:V(c,!0),children:c.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:ee(c.rate)}),e.jsx("span",{className:"text-slate-500",children:"/"}),e.jsx("span",{className:"text-xs text-slate-500",children:"hour"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[c.type," • ",c.family]})]})]});const m=r.inputs[0],u=r.inputs[1],x=s.shards[m.shard],o=s.shards[u.shard],h=t?n:r.quantity;return e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>a(l),className:"w-full p-2 text-left cursor-pointer hover:bg-slate-750 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[d?e.jsx(Ee,{className:"w-3 h-3 text-slate-400"}):e.jsx(Me,{className:"w-3 h-3 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[h,"x "]}),e.jsx("span",{className:`font-medium text-sm ${T(c.rarity)}`,title:V(c,!1),children:c.name}),e.jsxs("span",{className:"text-slate-400 ml-2 text-sm",children:["= ",m.quantity,"x ",e.jsx("span",{className:T(x.rarity),children:x.name})," + ",u.quantity,"x"," ",e.jsx("span",{className:T(o.rarity),children:o.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:h}),e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[c.type," • ",c.family]})]})]})}),d&&e.jsxs("div",{className:"border-t border-slate-600 p-2 space-y-1",children:[e.jsx(D,{tree:m,data:s,nodeId:`${l}-0`,expandedStates:i,onToggle:a}),e.jsx(D,{tree:u,data:s,nodeId:`${l}-1`,expandedStates:i,onToggle:a})]})]})},Je=({result:r,data:s,targetShardName:t})=>{const[n,l]=f.useState(new Map),[i,a]=f.useState(""),c=(m,u="root")=>{const x=new Map,o=(h,p)=>{h.method==="recipe"&&h.inputs&&(x.set(p,!0),h.inputs.forEach((b,j)=>{o(b,`${p}-${j}`)}))};return o(m,u),x};I.useEffect(()=>{if(r.tree){const m=JSON.stringify(r.tree);if(m!==i){const u=c(r.tree);l(u),a(m)}}},[r.tree,i]);const d=m=>{const u=new Map(n);u.set(m,!u.get(m)),l(u)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Le,{className:"w-3 h-3 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:R(r.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Pe,{className:"w-3 h-3 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:R(r.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(W,{className:"w-3 h-3 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:r.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Z,{className:"w-3 h-3 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[r.totalFusions,"x",r.craftTime>1/12&&e.jsx("span",{className:"text-xs text-slate-400 block",children:R(r.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded",children:e.jsx(Z,{className:"w-4 h-4 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-2.5 py-1.5 bg-blue-500/10 border border-blue-500/20 text-blue-300 text-sm font-medium rounded-lg",children:["for ",r.totalShardsProduced," ",t," • ",r.craftsNeeded," craft",r.craftsNeeded>1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:Array.from(r.totalQuantities).map(([m,u])=>{const x=s.shards[m],o=u/x.rate;return e.jsx("div",{className:"bg-slate-700/50 border border-slate-600/50 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-sm",children:[e.jsxs("span",{className:"text-white",children:[u,"x "]}),e.jsx("span",{className:T(x.rarity),children:x.name})]}),e.jsx("div",{className:"text-xs text-slate-400",children:R(o)})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[ee(x.rate),"/hour"]})]})},m)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded",children:e.jsx(W,{className:"w-4 h-4 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const m=new Map(n);for(const u of m.keys())m.set(u,!0);l(m)},className:`
                px-2 py-1.5 bg-green-500/20 hover:bg-green-500/30 
                text-green-400 font-medium rounded-lg 
                border border-green-500/20 hover:border-green-500/30
                transition-colors duration-200
                flex items-center space-x-1 cursor-pointer text-xs
              `,children:"Expand All"}),e.jsx("button",{onClick:()=>{const m=new Map(n);for(const u of m.keys())m.set(u,!1);l(m)},className:`
                px-2 py-1.5 bg-orange-500/20 hover:bg-orange-500/30 
                text-orange-400 font-medium rounded-lg 
                border border-orange-500/20 hover:border-orange-500/30
                transition-colors duration-200
                flex items-center space-x-1 cursor-pointer text-xs
              `,children:"Collapse All"})]})]}),e.jsx(D,{tree:r.tree,data:s,isTopLevel:!0,totalShardsProduced:r.totalShardsProduced,nodeId:"root",expandedStates:n,onToggle:d})]})]})},C=class C{static getInstance(){return C.instance||(C.instance=new C),C.instance}parseData(s){return k(this,null,function*(){var t,n;try{const[l,i]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),a=yield l.json(),c=yield i.json(),d={};for(const u in a.recipes){d[u]=[];for(const x in a.recipes[u]){const o=parseInt(x);a.recipes[u][x].forEach(p=>{d[u].push({inputs:p,outputQuantity:o})})}}const m={};for(const u in a.shards){let x=(n=(t=s.customRates[u])!=null?t:c[u])!=null?n:0;u==="L15"&&x===0&&(x=this.calculateKuudraRate(s.kuudraTier,s.moneyPerHour)),x>0&&(s.noWoodenBait&&ye.includes(u)&&(x*=.05),Ne.includes(u)||(x=this.applyFortuneModifiers(x,u,a.shards[u],s))),s.excludeChameleon&&u==="L4"&&(x=0),m[u]=S(w({},a.shards[u]),{id:u,rate:x})}return{recipes:d,shards:m}}catch(l){throw new Error(`Failed to parse data: ${l}`)}})}calculateKuudraRate(s,t){const l={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[s];if(!l)return 0;const i=t===0?0:l.cost/t*3600;return l.multiplier*(3600/(l.baseTime+i))}applyFortuneModifiers(s,t,n,l){let i=l.hunterFortune;const a=1+5*l.tiamatLevel/100,c=1+2*l.seaSerpentLevel/100*a,d=2*l.pythonLevel/100*c,m=l.kingCobraLevel/100*c;switch(n.rarity){case"common":i+=2*l.newtLevel;break;case"uncommon":i+=2*l.salamanderLevel;break;case"rare":i+=l.lizardKingLevel;break;case"epic":i+=l.leviathanLevel;break}return l.frogPet&&(s*=1.1),t in U&&(U[t]&&(s*=1+d),i*=1+m),s*(1+i/100)}computeMinCosts(s){const t=new Map,n=new Map,l=Object.keys(s.shards),i=.8/3600;l.forEach(c=>{const d=s.shards[c].rate>0?1/s.shards[c].rate:1/0;t.set(c,d),n.set(c,{recipe:null})});let a=!0;for(;a;)a=!1,l.forEach(c=>{(s.recipes[c]||[]).forEach(m=>{const[u,x]=m.inputs,o=s.shards[u].fuse_amount,h=s.shards[x].fuse_amount,p=t.get(u)*o,b=t.get(x)*h,v=(p+b+i)/m.outputQuantity;v<t.get(c)&&(t.set(c,v),n.set(c,{recipe:m}),a=!0)})});return{minCosts:t,choices:n}}buildRecipeTree(s,t){const n=t.get(s);if(n.recipe===null)return{shard:s,method:"direct",quantity:0};{const l=n.recipe,[i,a]=l.inputs,c=this.buildRecipeTree(i,t),d=this.buildRecipeTree(a,t);return{shard:s,method:"recipe",recipe:l,inputs:[c,d],quantity:0}}}assignQuantities(s,t,n,l){if(s.quantity=t,s.method==="recipe"){const i=s.recipe,a=i.outputQuantity,c=Math.ceil(t/a);l.total+=c;const[d,m]=i.inputs,u=n.shards[d].fuse_amount,x=n.shards[m].fuse_amount,o=c*u,h=c*x;this.assignQuantities(s.inputs[0],o,n,l),this.assignQuantities(s.inputs[1],h,n,l)}}collectTotalQuantities(s){const t=new Map,n=l=>{if(l.method==="direct"){const i=t.get(l.shard)||0;t.set(l.shard,i+l.quantity)}else l.inputs.forEach(n)};return n(s),t}decimalHoursToHoursMinutes(s){const t=Math.floor(s),n=Math.round((s-t)*60);return t===0?`${n} minutes`:n===0||isNaN(n)?`${t} hours`:`${t} hours ${n} minutes`}calculateOptimalPath(s,t,n){return k(this,null,function*(){var j;const l=yield this.parseData(n);if(!l.shards[s])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:s,method:"direct",quantity:0,inputs:[]}};const{minCosts:i,choices:a}=this.computeMinCosts(l),c=this.buildRecipeTree(s,a),d={total:0};this.assignQuantities(c,t,l,d);const m=this.collectTotalQuantities(c);let u=t,x=1;const o=a.get(s);if(o!=null&&o.recipe){const v=o.recipe.outputQuantity;x=Math.ceil(t/v),u=x*v}const h=(j=i.get(s))!=null?j:0,p=h*u,b=d.total*.8/3600;return{timePerShard:h,totalTime:p,totalShardsProduced:u,craftsNeeded:x,totalQuantities:m,totalFusions:d.total,craftTime:b,tree:c}})}};q(C,"instance");let z=C;const Xe=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:z},Symbol.toStringTag,{value:"Module"})),Ge=()=>{const[r,s]=f.useState(null),[t,n]=f.useState(!1),[l,i]=f.useState(null),a=f.useCallback((d,m,u)=>k(null,null,function*(){try{n(!0),i(null);const o=yield z.getInstance().calculateOptimalPath(d,m,u);s(o)}catch(x){i(x instanceof Error?x.message:"Calculation failed"),s(null)}finally{n(!1)}}),[]),c=f.useCallback(()=>{s(null),i(null)},[]);return{result:r,loading:t,error:l,calculate:a,clearResult:c}},at=()=>{const{result:r,loading:s,error:t,calculate:n}=Ge(),{customRates:l}=we(),[i,a]=f.useState(null),[c,d]=f.useState(""),[m,u]=f.useState(!1),x=o=>k(null,null,function*(){try{if(!o.shard||o.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}u(!1);const b=(yield O.getInstance().getShardNameToKeyMap())[o.shard.toLowerCase()];if(!b){console.warn(`Calculation skipped: Shard "${o.shard}" not found in data`);return}d(o.shard);const j={customRates:l,hunterFortune:o.hunterFortune,excludeChameleon:o.excludeChameleon,frogPet:o.frogPet,newtLevel:o.newtLevel,salamanderLevel:o.salamanderLevel,lizardKingLevel:o.lizardKingLevel,leviathanLevel:o.leviathanLevel,pythonLevel:o.pythonLevel,kingCobraLevel:o.kingCobraLevel,seaSerpentLevel:o.seaSerpentLevel,tiamatLevel:o.tiamatLevel,kuudraTier:o.kuudraTier,moneyPerHour:o.moneyPerHour,noWoodenBait:o.noWoodenBait};yield n(b,o.quantity,j);const K=yield(yield fe(()=>Promise.resolve().then(()=>Xe),void 0)).CalculationService.getInstance().parseData(j);a(K)}catch(h){h instanceof Error&&!h.message.includes("not found")&&console.error("Calculation failed:",h)}});return e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-3",children:[e.jsx("div",{className:"xl:col-span-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>u(!m),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white flex items-center justify-center space-x-2 cursor-pointer",children:[m?e.jsx(te,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[m?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${m?"block":"hidden xl:block"}`,children:e.jsx(Ze,{onSubmit:x})})]})}),e.jsxs("div",{className:"xl:col-span-9 space-y-3",children:[t&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded p-3 flex items-start space-x-2",children:[e.jsx(Re,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:t})]})]}),r&&i&&e.jsx(Je,{result:r,data:i,targetShardName:c}),!r&&!s&&!t&&e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700 rounded",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-700 rounded flex items-center justify-center mx-auto",children:e.jsx($,{className:"w-6 h-6 text-slate-300"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-slate-700 text-white text-sm rounded flex items-center space-x-1 mx-auto cursor-pointer hover:bg-slate-600 transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})};export{at as CalculatorPage};
