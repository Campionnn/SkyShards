var he=Object.defineProperty,xe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var A=(r,s,t)=>s in r?he(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t,w=(r,s)=>{for(var t in s||(s={}))fe.call(s,t)&&A(r,t,s[t]);if(D)for(var t of D(s))be.call(s,t)&&A(r,t,s[t]);return r},S=(r,s)=>xe(r,pe(s));var H=(r,s,t)=>A(r,typeof s!="symbol"?s+"":s,t);var k=(r,s,t)=>new Promise((n,o)=>{var c=l=>{try{d(t.next(l))}catch(h){o(h)}},a=l=>{try{d(t.throw(l))}catch(h){o(h)}},d=l=>l.done?n(l.value):Promise.resolve(l.value).then(c,a);d((t=t.apply(r,s)).next())});import{j as e,_ as ve}from"./index-CztRp-a4.js";import{r as p,R as $}from"./vendor-lM--12k9.js";import{o as B,s as V,a as Y,b as ee,c as K,n as N,e as ge,d as te,u as je}from"./forms-DE1HYwwM.js";import{d as ye,D as _,g as T,M as P,K as U,f as M,a as se,b as W,W as Ne,N as we,B as Z,u as Se}from"./useCustomRates-D6x1AFMI.js";import{a as ke,X as re,S as Ce,Z as Le,R as Te,b as q,c as Ee,T as Pe,d as J,H as X,e as Re,M as F,f as Me}from"./icons-D5G7fq2V.js";function ne(r,s,t){var d;function n(l,h){var u,i;var m;Object.defineProperty(l,"_zod",{value:(u=l._zod)!=null?u:{},enumerable:!1}),(i=(m=l._zod).traits)!=null||(m.traits=new Set),l._zod.traits.add(r),s(l,h);for(const x in a.prototype)x in l||Object.defineProperty(l,x,{value:a.prototype[x].bind(l)});l._zod.constr=a,l._zod.def=h}const o=(d=t==null?void 0:t.Parent)!=null?d:Object;class c extends o{}Object.defineProperty(c,"name",{value:r});function a(l){var u;var h;const m=t!=null&&t.Parent?new c:this;n(m,l),(u=(h=m._zod).deferred)!=null||(h.deferred=[]);for(const i of m._zod.deferred)i();return m}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:l=>{var h,m;return t!=null&&t.Parent&&l instanceof t.Parent?!0:(m=(h=l==null?void 0:l._zod)==null?void 0:h.traits)==null?void 0:m.has(r)}}),Object.defineProperty(a,"name",{value:r}),a}class Oe extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const _e={};function ae(r){return _e}function ze(r,s){return typeof s=="bigint"?s.toString():s}const le=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function O(r){return typeof r=="string"?r:r==null?void 0:r.message}function oe(r,s,t){var o,c,a,d,l,h,m,u,i,x,f;const n=S(w({},r),{path:(o=r.path)!=null?o:[]});if(!r.message){const b=(f=(x=(u=(h=O((d=(a=(c=r.inst)==null?void 0:c._zod.def)==null?void 0:a.error)==null?void 0:d.call(a,r)))!=null?h:O((l=s==null?void 0:s.error)==null?void 0:l.call(s,r)))!=null?u:O((m=t.customError)==null?void 0:m.call(t,r)))!=null?x:O((i=t.localeError)==null?void 0:i.call(t,r)))!=null?f:"Invalid input";n.message=b}return delete n.inst,delete n.continue,s!=null&&s.reportInput||delete n.input,n}const ie=(r,s)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:s,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(s,ze,2)},enumerable:!0})},$e=ne("$ZodError",ie),ce=ne("$ZodError",ie,{Parent:Error}),Ie=r=>(s,t,n,o)=>{var d;const c=n?Object.assign(n,{async:!1}):{async:!1},a=s._zod.run({value:t,issues:[]},c);if(a instanceof Promise)throw new Oe;if(a.issues.length){const l=new((d=o==null?void 0:o.Err)!=null?d:r)(a.issues.map(h=>oe(h,c,ae())));throw le(l,o==null?void 0:o.callee),l}return a.value},Ae=Ie(ce),Ke=r=>(s,t,n,o)=>k(null,null,function*(){var d;const c=n?Object.assign(n,{async:!0}):{async:!0};let a=s._zod.run({value:t,issues:[]},c);if(a instanceof Promise&&(a=yield a),a.issues.length){const l=new((d=o==null?void 0:o.Err)!=null?d:r)(a.issues.map(h=>oe(h,c,ae())));throw le(l,o==null?void 0:o.callee),l}return a.value}),Fe=Ke(ce);function G(r,s){try{var t=r()}catch(n){return s(n)}return t&&t.then?t.then(void 0,s):t}function Qe(r,s){for(var t={};r.length;){var n=r[0],o=n.code,c=n.message,a=n.path.join(".");if(!t[a])if("unionErrors"in n){var d=n.unionErrors[0].errors[0];t[a]={message:d.message,type:d.code}}else t[a]={message:c,type:o};if("unionErrors"in n&&n.unionErrors.forEach(function(m){return m.errors.forEach(function(u){return r.push(u)})}),s){var l=t[a].types,h=l&&l[n.code];t[a]=Y(a,s,t,o,h?[].concat(h,n.message):n.message)}r.shift()}return t}function qe(r,s){for(var t={};r.length;){var n=r[0],o=n.code,c=n.message,a=n.path.join(".");if(!t[a])if(n.code==="invalid_union"){var d=n.errors[0][0];t[a]={message:d.message,type:d.code}}else t[a]={message:c,type:o};if(n.code==="invalid_union"&&n.errors.forEach(function(m){return m.forEach(function(u){return r.push(u)})}),s){var l=t[a].types,h=l&&l[n.code];t[a]=Y(a,s,t,o,h?[].concat(h,n.message):n.message)}r.shift()}return t}function De(r,s,t){if(t===void 0&&(t={}),function(n){return"_def"in n&&typeof n._def=="object"&&"typeName"in n._def}(r))return function(n,o,c){try{return Promise.resolve(G(function(){return Promise.resolve(r[t.mode==="sync"?"parse":"parseAsync"](n,s)).then(function(a){return c.shouldUseNativeValidation&&B({},c),{errors:{},values:t.raw?Object.assign({},n):a}})},function(a){if(function(d){return Array.isArray(d==null?void 0:d.issues)}(a))return{values:{},errors:V(Qe(a.errors,!c.shouldUseNativeValidation&&c.criteriaMode==="all"),c)};throw a}))}catch(a){return Promise.reject(a)}};if(function(n){return"_zod"in n&&typeof n._zod=="object"}(r))return function(n,o,c){try{return Promise.resolve(G(function(){return Promise.resolve((t.mode==="sync"?Ae:Fe)(r,n,s)).then(function(a){return c.shouldUseNativeValidation&&B({},c),{errors:{},values:t.raw?Object.assign({},n):a}})},function(a){if(function(d){return d instanceof $e}(a))return{values:{},errors:V(qe(a.issues,!c.shouldUseNativeValidation&&c.criteriaMode==="all"),c)};throw a}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const He=ee({shard:te().min(1,"Please select a shard"),quantity:N().min(1,"Quantity must be at least 1"),hunterFortune:N().min(0,"Hunter Fortune must be non-negative"),excludeChameleon:K(),frogPet:K(),newtLevel:N().min(0).max(10),salamanderLevel:N().min(0).max(10),lizardKingLevel:N().min(0).max(10),leviathanLevel:N().min(0).max(10),pythonLevel:N().min(0).max(10),kingCobraLevel:N().min(0).max(10),seaSerpentLevel:N().min(0).max(10),tiamatLevel:N().min(0).max(10),kuudraTier:ge(["none","t1","t2","t3","t4","t5"]),moneyPerHour:N().min(0),noWoodenBait:K()});ee({shardId:te(),rate:N().min(0)});const Be=$.memo(({shard:r,index:s,focusedIndex:t,onSelect:n,isSelecting:o,setFocusedIndex:c})=>{const a=p.useCallback(l=>{l.preventDefault(),l.stopPropagation(),n(r)},[n,r]),d=p.useCallback(()=>{o||c(s)},[o,c,s]);return e.jsx("li",{className:`px-3 py-2.5 cursor-pointer border-b border-slate-700 last:border-b-0 ${s===t?"bg-purple-600 text-white":"text-slate-200 hover:bg-slate-700"}`,onMouseDown:a,onClick:a,onMouseEnter:d,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-medium truncate ${T(r.rarity)}`,children:r.name}),e.jsxs("div",{className:"text-xs opacity-75 truncate",children:[r.family," â€¢ ",r.type]})]}),r.rate>0&&e.jsxs("div",{className:"text-xs font-mono bg-slate-900/50 px-2 py-1 rounded-md ml-2",children:[r.rate,e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]})]})})}),Ve=({value:r,onChange:s,onSelect:t,placeholder:n="Search for a shard...",className:o=""})=>{const[c,a]=p.useState([]),[d,l]=p.useState(!1),[h,m]=p.useState(-1),[u,i]=p.useState(!1),[x,f]=p.useState(!1),b=p.useRef(null),y=p.useRef(null),g=p.useRef(null),C=p.useMemo(()=>ye(v=>k(null,null,function*(){if(v.length===0||u){a([]),l(!1),f(!1);return}f(!0);try{const E=yield _.getInstance().searchShards(v);a(E.slice(0,10)),l(E.length>0),m(-1)}catch(j){console.error("Search failed:",j),a([]),l(!1)}finally{f(!1)}}),100),[u]),I=p.useCallback(v=>{const j=v.target.value;i(!1),s(j),g.current&&clearTimeout(g.current),C(j)},[s,C]),R=p.useCallback(v=>{i(!0),l(!1),a([]),m(-1),s(v.name),t(v),g.current&&clearTimeout(g.current),setTimeout(()=>{i(!1),b.current&&b.current.blur()},50)},[s,t]),de=p.useCallback(v=>{if(!(!d||c.length===0||u))switch(v.key){case"ArrowDown":v.preventDefault(),m(j=>(j+1)%c.length);break;case"ArrowUp":v.preventDefault(),m(j=>j<=0?c.length-1:j-1);break;case"Enter":v.preventDefault(),h>=0&&h<c.length?R(c[h]):c.length===1&&R(c[0]);break;case"Escape":l(!1),m(-1);break}},[d,c,u,h,R]),ue=p.useCallback(()=>{var v;i(!1),s(""),a([]),l(!1),m(-1),g.current&&clearTimeout(g.current),(v=b.current)==null||v.focus()},[s]),me=p.useCallback(()=>{u||r.trim()&&C(r)},[u,r,C]);return p.useEffect(()=>{const v=j=>{const E=j.target;b.current&&!b.current.contains(E)&&y.current&&!y.current.contains(E)&&(l(!1),m(-1))};return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v),g.current&&clearTimeout(g.current)}},[]),e.jsxs("div",{className:`relative ${o}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(ke,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:b,type:"text",value:r,onChange:I,onKeyDown:de,onFocus:me,placeholder:n,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-md text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),r&&e.jsx("button",{onClick:ue,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(re,{className:"h-4 w-4"})})]}),d&&c.length>0&&!u&&e.jsx("ul",{ref:y,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-md shadow-xl max-h-60 overflow-y-auto",children:c.map((v,j)=>e.jsx(Be,{shard:v,index:j,focusedIndex:h,onSelect:R,isSelecting:u,setFocusedIndex:m},v.key))})]})},Ue=$.memo(({value:r,onChange:s,label:t})=>{const n=p.useMemo(()=>Array.from({length:11},(l,h)=>h),[]),[o,c]=p.useState(!1),a=p.useRef(null);p.useEffect(()=>{const l=h=>{a.current&&!a.current.contains(h.target)&&c(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const d=l=>{s(l),c(!1)};return e.jsxs("div",{className:"relative",ref:a,children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>c(!o),className:"w-full px-3 py-2 pr-10 bg-white/5 border border-white/10 rounded-md text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 cursor-pointer hover:border-white/20 hover:bg-white/10 transition-all duration-200 text-left",children:["Level ",r]}),e.jsx(q,{className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none transition-transform duration-200 ${o?"rotate-180":""}`}),o&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-slate-800/95 backdrop-blur-sm border border-white/20 rounded-md shadow-xl max-h-48 overflow-y-auto",children:n.map(l=>e.jsxs("button",{type:"button",onClick:()=>d(l),className:`w-full px-3 py-2.5 text-left text-sm hover:bg-blue-500/20 hover:text-blue-300 transition-all duration-150 border-b border-white/5 last:border-b-0 ${r===l?"bg-blue-500/30 text-blue-200":"text-white"}`,children:["Level ",l]},l))})]})]})}),We=$.memo(({value:r,onChange:s,label:t})=>{const[n,o]=p.useState(!1),c=p.useRef(null);p.useEffect(()=>{const l=h=>{c.current&&!c.current.contains(h.target)&&o(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const a=l=>{s(l),o(!1)},d=U.find(l=>l.value===r);return e.jsxs("div",{className:"relative",ref:c,children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>o(!n),className:"w-full px-3 py-2 pr-10 bg-white/5 border border-white/10 rounded-md text-white text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 cursor-pointer hover:border-white/20 hover:bg-white/10 transition-all duration-200 text-left",children:(d==null?void 0:d.label)||"Select tier"}),e.jsx(q,{className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none transition-transform duration-200 ${n?"rotate-180":""}`}),n&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-slate-800/95 backdrop-blur-sm border border-white/20 rounded-md shadow-xl max-h-48 overflow-y-auto",children:U.map(l=>e.jsx("button",{type:"button",onClick:()=>a(l.value),className:`w-full px-3 py-2.5 text-left text-sm hover:bg-orange-500/20 hover:text-orange-300 transition-all duration-150 border-b border-white/5 last:border-b-0 ${r===l.value?"bg-orange-500/30 text-orange-200":"text-white"}`,children:l.label},l.value))})]})]})}),Ze=({onSubmit:r})=>{const{register:s,setValue:t,watch:n,reset:o,formState:{errors:c}}=je({resolver:De(He),defaultValues:{shard:"",quantity:1,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1}}),a=n("shard"),d=n();p.useEffect(()=>{const i=x=>k(null,null,function*(){if(!x||x.trim()==="")return!1;try{return!!(yield _.getInstance().getShardNameToKeyMap())[x.toLowerCase()]}catch(f){return!1}});if(a&&a.trim()!==""&&d.shard&&d.shard.trim()!==""){const x=setTimeout(()=>k(null,null,function*(){if(yield i(d.shard)){const b=S(w({},d),{frogPet:!1});r(b)}}),1e3);return()=>clearTimeout(x)}},[d,r,a]);const l=i=>{t("shard",i.name),setTimeout(()=>{const x=S(w({},n()),{shard:i.name,frogPet:!1});r(x)},100)},h=()=>{t("hunterFortune",121),t("newtLevel",10),t("salamanderLevel",10),t("lizardKingLevel",10),t("leviathanLevel",10),t("pythonLevel",10),t("kingCobraLevel",10),t("seaSerpentLevel",10),t("tiamatLevel",10)},m=()=>{const i=n("shard"),x=n("quantity");o(),t("shard",i),t("quantity",x)},u=()=>k(null,null,function*(){const i=a;if(!i||i.trim()===""){t("quantity",P.common);return}try{const f=yield _.getInstance().getShardByName(i);if(f){const b=P[f.rarity]||P.common;t("quantity",b)}else t("quantity",P.common)}catch(x){console.error("Failed to get shard rarity:",x),t("quantity",P.common)}});return e.jsx("div",{className:"bg-slate-800/40 border border-slate-600/30 rounded-md p-3 space-y-3",children:e.jsxs("form",{onSubmit:i=>i.preventDefault(),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-emerald-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),"Target Shard"]}),e.jsx(Ve,{value:a,onChange:i=>t("shard",i),onSelect:l,placeholder:"Search for a shard..."}),c.shard&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:c.shard.message})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",S(w({type:"number",min:"1"},s("quantity",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:`
                  w-full px-3 py-1.5 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50
                  transition-colors duration-200
                `})),c.quantity&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:c.quantity.message})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Â "}),e.jsx("button",{type:"button",onClick:u,className:`
                  px-2.5 py-1.5 text-sm font-medium rounded-md
                  bg-emerald-500/20 hover:bg-emerald-500/30 
                  text-emerald-400 border border-emerald-500/20 hover:border-emerald-500/30
                  transition-colors duration-200 flex items-center justify-center cursor-pointer
                `,children:"Max"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-purple-400"}),"Settings"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{type:"button",onClick:h,className:`
                  px-2 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 
                  text-amber-400 font-medium rounded-md text-xs
                  border border-amber-500/20 hover:border-amber-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:m,className:`
                  px-2 py-1.5 bg-red-500/20 hover:bg-red-500/30 
                  text-red-400 font-medium rounded-md text-xs
                  border border-red-500/20 hover:border-red-500/30
                  transition-colors duration-200 flex items-center space-x-1 cursor-pointer
                `,children:[e.jsx(Te,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-fuchsia-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-fuchsia-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",S(w({type:"number",min:"0"},s("hunterFortune",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:`
                  w-full px-3 py-2 text-sm
                  bg-white/5 border border-white/10 rounded-md
                  text-white placeholder-slate-400
                  focus:outline-none focus:ring-2 focus:ring-fuchsia-500/50 focus:border-fuchsia-500/50
                  transition-colors duration-200
                `}))]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",S(w({id:"excludeChameleon",type:"checkbox"},s("excludeChameleon")),{className:"sr-only peer"})),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Chameleon"})]}),e.jsxs("div",{className:"group flex items-center space-x-3 p-2.5 bg-white/5 border border-white/10 rounded-md hover:bg-white/10 hover:border-white/20 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",S(w({id:"excludeWoodenBait",type:"checkbox"},s("noWoodenBait")),{className:"sr-only peer"})),e.jsx("div",{className:"w-5 h-5 bg-slate-900 border-2 border-slate-600 rounded-md flex items-center justify-center cursor-pointer transition-all duration-200 hover:border-slate-500 peer-checked:bg-fuchsia-500 peer-checked:border-fuchsia-500 peer-focus:ring-2 peer-focus:ring-fuchsia-500/20",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-slate-200 cursor-pointer flex-1 group-hover:text-white transition-colors",children:"Exclude Wooden Bait"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-blue-300",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Shard Levels"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:i,label:x})=>e.jsx(Ue,{value:n(i)||0,onChange:f=>t(i,f),label:x},i))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-orange-300",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Kraken Shard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(We,{value:n("kuudraTier")||"t5",onChange:i=>t("kuudraTier",i),label:"Kuudra Tier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",S(w({type:"number",min:"0",placeholder:"40000000"},s("moneyPerHour",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:"w-full px-3 py-2 pr-20 text-sm bg-white/5 border border-white/10 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50 hover:border-white/20 hover:bg-white/10 transition-all duration-200"})),e.jsx("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500 pointer-events-none",children:"coins/hour"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})})},Q=({tree:r,data:s,isTopLevel:t=!1,totalShardsProduced:n=r.quantity,nodeId:o,expandedStates:c,onToggle:a})=>{var f;const d=s.shards[r.shard],l=(f=c.get(o))!=null?f:!0;if(r.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 bg-slate-800 rounded-md border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-slate-300 font-medium text-sm",children:[r.quantity,"x"]}),e.jsx("span",{className:`font-medium text-sm ${T(d.rarity)}`,title:W(d,!0),children:d.name}),e.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-md",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:[se(d.rate),e.jsx("span",{className:"text-slate-500 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-400",children:"hr"})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[d.type," â€¢ ",d.family]})]})]});const h=r.inputs[0],m=r.inputs[1],u=s.shards[h.shard],i=s.shards[m.shard],x=t?n:r.quantity;return e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>a(o),className:"w-full px-3 py-1 text-left cursor-pointer hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[l?e.jsx(q,{className:"w-4 h-4 text-slate-400"}):e.jsx(Re,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium text-sm",children:[x,"x "]}),e.jsx("span",{className:`font-medium ${T(d.rarity)} text-sm`,title:W(d,!1),children:d.name}),e.jsxs("span",{className:"text-slate-400 ml-1.5 text-sm",children:["= ",h.quantity,"x ",e.jsx("span",{className:T(u.rarity),children:u.name})," + ",m.quantity,"x"," ",e.jsx("span",{className:T(i.rarity),children:i.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end space-x-1.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:`font-medium text-white ${t?"text-sm":"text-xs"}`,children:x})]}),e.jsxs("div",{className:"text-slate-400 capitalize text-xs",children:[d.type," â€¢ ",d.family]})]})]})}),l&&e.jsxs("div",{className:"border-t border-slate-600 pl-3 pr-0.5 py-0.5 space-y-0.5",children:[e.jsx(Q,{tree:h,data:s,nodeId:`${o}-0`,expandedStates:c,onToggle:a}),e.jsx(Q,{tree:m,data:s,nodeId:`${o}-1`,expandedStates:c,onToggle:a})]})]})},Je=({result:r,data:s,targetShardName:t})=>{const[n,o]=p.useState(new Map),[c,a]=p.useState(""),d=(u,i="root")=>{const x=new Map,f=(b,y)=>{b.method==="recipe"&&b.inputs&&(x.set(y,!0),b.inputs.forEach((g,C)=>{f(g,`${y}-${C}`)}))};return f(u,i),x};$.useEffect(()=>{if(r.tree){const u=JSON.stringify(r.tree);if(u!==c){const i=d(r.tree);o(i),a(u)}}},[r.tree,c]);const l=()=>{const u=new Map(n);for(const i of u.keys())u.set(i,!0);o(u)},h=()=>{const u=new Map(n);for(const i of u.keys())u.set(i,!1);o(u)},m=u=>{const i=new Map(n);i.set(u,!i.get(u)),o(i)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(r.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(Pe,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:M(r.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(J,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:r.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-md flex items-center justify-center",children:e.jsx(X,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[r.totalFusions,"x",r.craftTime>1/12&&e.jsx("span",{className:"text-slate-400 mx-1",children:"â€¢"}),r.craftTime>1/12&&e.jsx("span",{className:"text-slate-400",children:M(r.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(X,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"px-3 py-1.5 bg-sky-500/20 border border-sky-500/30 text-sky-400 text-sm font-medium rounded-md",children:["for ",r.totalShardsProduced," ",t," ",e.jsxs("span",{className:"text-slate-400",children:[r.craftsNeeded," craft",r.craftsNeeded>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(r.totalQuantities).map(([u,i])=>{const x=s.shards[u],f=i/x.rate;return e.jsx("div",{className:"bg-slate-700 border border-slate-600 rounded-md p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[i,"x ",e.jsx("span",{className:T(x.rarity),children:x.name})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[se(x.rate),e.jsx("span",{className:"text-slate-600 mx-0.5",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"hr"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs text-slate-400",children:M(f)})})]})},u)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded-md",children:e.jsx(J,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:l,className:"px-3 py-1.5 bg-green-500/10 border border-green-500/20 hover:border-green-400/30 text-white text-xs font-medium rounded-md hover:bg-green-500/20 transition-all duration-200 cursor-pointer",children:"Expand All"}),e.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-orange-500/10 border border-orange-500/20 hover:border-orange-400/30 text-white text-xs font-medium rounded-md hover:bg-orange-500/20 transition-all duration-200 cursor-pointer",children:"Collapse All"})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(Q,{tree:r.tree,data:s,isTopLevel:!0,totalShardsProduced:r.totalShardsProduced,nodeId:"root",expandedStates:n,onToggle:m})})]})]})},L=class L{static getInstance(){return L.instance||(L.instance=new L),L.instance}parseData(s){return k(this,null,function*(){var t,n;try{const[o,c]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),a=yield o.json(),d=yield c.json(),l={};for(const m in a.recipes){l[m]=[];for(const u in a.recipes[m]){const i=parseInt(u);a.recipes[m][u].forEach(f=>{l[m].push({inputs:f,outputQuantity:i})})}}const h={};for(const m in a.shards){let u=(n=(t=s.customRates[m])!=null?t:d[m])!=null?n:0;m==="L15"&&u===0&&(u=this.calculateKuudraRate(s.kuudraTier,s.moneyPerHour)),u>0&&(s.noWoodenBait&&Ne.includes(m)&&(u*=.05),we.includes(m)||(u=this.applyFortuneModifiers(u,m,a.shards[m],s))),s.excludeChameleon&&m==="L4"&&(u=0),h[m]=S(w({},a.shards[m]),{id:m,rate:u})}return{recipes:l,shards:h}}catch(o){throw new Error(`Failed to parse data: ${o}`)}})}calculateKuudraRate(s,t){const o={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[s];if(!o)return 0;const c=t===0?0:o.cost/t*3600;return o.multiplier*(3600/(o.baseTime+c))}applyFortuneModifiers(s,t,n,o){let c=o.hunterFortune;const a=1+5*o.tiamatLevel/100,d=1+2*o.seaSerpentLevel/100*a,l=2*o.pythonLevel/100*d,h=o.kingCobraLevel/100*d;switch(n.rarity){case"common":c+=2*o.newtLevel;break;case"uncommon":c+=2*o.salamanderLevel;break;case"rare":c+=o.lizardKingLevel;break;case"epic":c+=o.leviathanLevel;break}return o.frogPet&&(s*=1.1),t in Z&&(Z[t]&&(s*=1+l),c*=1+h),s*(1+c/100)}computeMinCosts(s){const t=new Map,n=new Map,o=Object.keys(s.shards),c=.8/3600;o.forEach(d=>{const l=s.shards[d].rate>0?1/s.shards[d].rate:1/0;t.set(d,l),n.set(d,{recipe:null})});let a=!0;for(;a;)a=!1,o.forEach(d=>{(s.recipes[d]||[]).forEach(h=>{const[m,u]=h.inputs,i=s.shards[m].fuse_amount,x=s.shards[u].fuse_amount,f=t.get(m)*i,b=t.get(u)*x,g=(f+b+c)/h.outputQuantity;g<t.get(d)&&(t.set(d,g),n.set(d,{recipe:h}),a=!0)})});return{minCosts:t,choices:n}}buildRecipeTree(s,t){const n=t.get(s);if(n.recipe===null)return{shard:s,method:"direct",quantity:0};{const o=n.recipe,[c,a]=o.inputs,d=this.buildRecipeTree(c,t),l=this.buildRecipeTree(a,t);return{shard:s,method:"recipe",recipe:o,inputs:[d,l],quantity:0}}}assignQuantities(s,t,n,o){if(s.quantity=t,s.method==="recipe"){const c=s.recipe,a=c.outputQuantity,d=Math.ceil(t/a);o.total+=d;const[l,h]=c.inputs,m=n.shards[l].fuse_amount,u=n.shards[h].fuse_amount,i=d*m,x=d*u;this.assignQuantities(s.inputs[0],i,n,o),this.assignQuantities(s.inputs[1],x,n,o)}}collectTotalQuantities(s){const t=new Map,n=o=>{if(o.method==="direct"){const c=t.get(o.shard)||0;t.set(o.shard,c+o.quantity)}else o.inputs.forEach(n)};return n(s),t}decimalHoursToHoursMinutes(s){const t=Math.floor(s),n=Math.round((s-t)*60);return t===0?`${n} minutes`:n===0||isNaN(n)?`${t} hours`:`${t} hours ${n} minutes`}calculateOptimalPath(s,t,n){return k(this,null,function*(){var y;const o=yield this.parseData(n);if(!o.shards[s])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:s,method:"direct",quantity:0,inputs:[]}};const{minCosts:c,choices:a}=this.computeMinCosts(o),d=this.buildRecipeTree(s,a),l={total:0};this.assignQuantities(d,t,o,l);const h=this.collectTotalQuantities(d);let m=t,u=1;const i=a.get(s);if(i!=null&&i.recipe){const g=i.recipe.outputQuantity;u=Math.ceil(t/g),m=u*g}const x=(y=c.get(s))!=null?y:0,f=x*m,b=l.total*.8/3600;return{timePerShard:x,totalTime:f,totalShardsProduced:m,craftsNeeded:u,totalQuantities:h,totalFusions:l.total,craftTime:b,tree:d}})}};H(L,"instance");let z=L;const Xe=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:z},Symbol.toStringTag,{value:"Module"})),Ge=()=>{const[r,s]=p.useState(null),[t,n]=p.useState(!1),[o,c]=p.useState(null),a=p.useCallback((l,h,m)=>k(null,null,function*(){try{n(!0),c(null);const i=yield z.getInstance().calculateOptimalPath(l,h,m);s(i)}catch(u){c(u instanceof Error?u.message:"Calculation failed"),s(null)}finally{n(!1)}}),[]),d=p.useCallback(()=>{s(null),c(null)},[]);return{result:r,loading:t,error:o,calculate:a,clearResult:d}},at=()=>{const{result:r,loading:s,error:t,calculate:n}=Ge(),{customRates:o}=Se(),[c,a]=p.useState(null),[d,l]=p.useState(""),[h,m]=p.useState(!1),u=i=>k(null,null,function*(){try{if(!i.shard||i.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}m(!1);const b=(yield _.getInstance().getShardNameToKeyMap())[i.shard.toLowerCase()];if(!b){console.warn(`Calculation skipped: Shard "${i.shard}" not found in data`);return}l(i.shard);const y={customRates:o,hunterFortune:i.hunterFortune,excludeChameleon:i.excludeChameleon,frogPet:i.frogPet,newtLevel:i.newtLevel,salamanderLevel:i.salamanderLevel,lizardKingLevel:i.lizardKingLevel,leviathanLevel:i.leviathanLevel,pythonLevel:i.pythonLevel,kingCobraLevel:i.kingCobraLevel,seaSerpentLevel:i.seaSerpentLevel,tiamatLevel:i.tiamatLevel,kuudraTier:i.kuudraTier,moneyPerHour:i.moneyPerHour,noWoodenBait:i.noWoodenBait};yield n(b,i.quantity,y);const I=yield(yield ve(()=>Promise.resolve().then(()=>Xe),void 0)).CalculationService.getInstance().parseData(y);a(I)}catch(x){x instanceof Error&&!x.message.includes("not found")&&console.error("Calculation failed:",x)}});return e.jsx("div",{className:"min-h-screen space-y-3 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-7 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>m(!h),className:`
                w-full px-3 py-2.5 
                bg-purple-500/10 border border-purple-500/20 hover:border-purple-400/30
                rounded-md text-white hover:bg-purple-500/20 
                flex items-center justify-center space-x-2 
                transition-colors duration-200 font-medium text-sm
              `,children:[h?e.jsx(re,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[h?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${h?"block":"hidden xl:block"}`,children:e.jsx(Ze,{onSubmit:u})})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-3",children:[t&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-md p-3 flex items-start space-x-2",children:[e.jsx(Me,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:t})]})]}),r&&c&&e.jsx(Je,{result:r,data:c,targetShardName:d}),!r&&!s&&!t&&e.jsx("div",{className:"text-center py-10 bg-white/5 border border-white/10 rounded-md",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 border border-purple-500/20 rounded-md flex items-center justify-center mx-auto",children:e.jsx(F,{className:"w-6 h-6 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>m(!0),className:`
                      px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 
                      text-purple-400 font-medium rounded-md 
                      border border-purple-500/20 hover:border-purple-500/30
                      transition-colors duration-200 text-sm
                      flex items-center space-x-2 mx-auto
                    `,children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})};export{at as CalculatorPage};
