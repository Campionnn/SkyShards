var ue=Object.defineProperty,me=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var K=(r,s,t)=>s in r?ue(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t,w=(r,s)=>{for(var t in s||(s={}))xe.call(s,t)&&K(r,t,s[t]);if(Q)for(var t of Q(s))fe.call(s,t)&&K(r,t,s[t]);return r},S=(r,s)=>me(r,he(s));var q=(r,s,t)=>K(r,typeof s!="symbol"?s+"":s,t);var k=(r,s,t)=>new Promise((a,l)=>{var o=u=>{try{d(t.next(u))}catch(h){l(h)}},n=u=>{try{d(t.throw(u))}catch(h){l(h)}},d=u=>u.done?a(u.value):Promise.resolve(u.value).then(o,n);d((t=t.apply(r,s)).next())});import{j as e,_ as pe}from"./index-CNl7DXin.js";import{r as p,R as A}from"./vendor-lM--12k9.js";import{o as H,s as B,a as X,b as G,c as F,n as N,e as be,d as Y,u as ge}from"./forms-DE1HYwwM.js";import{d as ve,D as O,g as T,M as P,K as je,f as R,a as ee,b as V,W as ye,N as Ne,B as U,u as we}from"./useCustomRates-CRvHpbg-.js";import{a as Se,X as te,S as ke,Z as Ce,R as Te,b as Le,T as Ee,c as W,H as Z,d as Pe,e as Me,M as $,f as Re}from"./icons-ub95DieP.js";function se(r,s,t){var d;function a(u,h){var m,i;var c;Object.defineProperty(u,"_zod",{value:(m=u._zod)!=null?m:{},enumerable:!1}),(i=(c=u._zod).traits)!=null||(c.traits=new Set),u._zod.traits.add(r),s(u,h);for(const x in n.prototype)x in u||Object.defineProperty(u,x,{value:n.prototype[x].bind(u)});u._zod.constr=n,u._zod.def=h}const l=(d=t==null?void 0:t.Parent)!=null?d:Object;class o extends l{}Object.defineProperty(o,"name",{value:r});function n(u){var m;var h;const c=t!=null&&t.Parent?new o:this;a(c,u),(m=(h=c._zod).deferred)!=null||(h.deferred=[]);for(const i of c._zod.deferred)i();return c}return Object.defineProperty(n,"init",{value:a}),Object.defineProperty(n,Symbol.hasInstance,{value:u=>{var h,c;return t!=null&&t.Parent&&u instanceof t.Parent?!0:(c=(h=u==null?void 0:u._zod)==null?void 0:h.traits)==null?void 0:c.has(r)}}),Object.defineProperty(n,"name",{value:r}),n}class _e extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Oe={};function re(r){return Oe}function ze(r,s){return typeof s=="bigint"?s.toString():s}const ae=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function _(r){return typeof r=="string"?r:r==null?void 0:r.message}function ne(r,s,t){var l,o,n,d,u,h,c,m,i,x,f;const a=S(w({},r),{path:(l=r.path)!=null?l:[]});if(!r.message){const b=(f=(x=(m=(h=_((d=(n=(o=r.inst)==null?void 0:o._zod.def)==null?void 0:n.error)==null?void 0:d.call(n,r)))!=null?h:_((u=s==null?void 0:s.error)==null?void 0:u.call(s,r)))!=null?m:_((c=t.customError)==null?void 0:c.call(t,r)))!=null?x:_((i=t.localeError)==null?void 0:i.call(t,r)))!=null?f:"Invalid input";a.message=b}return delete a.inst,delete a.continue,s!=null&&s.reportInput||delete a.input,a}const le=(r,s)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:s,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(s,ze,2)},enumerable:!0})},Ae=se("$ZodError",le),ie=se("$ZodError",le,{Parent:Error}),Ie=r=>(s,t,a,l)=>{var d;const o=a?Object.assign(a,{async:!1}):{async:!1},n=s._zod.run({value:t,issues:[]},o);if(n instanceof Promise)throw new _e;if(n.issues.length){const u=new((d=l==null?void 0:l.Err)!=null?d:r)(n.issues.map(h=>ne(h,o,re())));throw ae(u,l==null?void 0:l.callee),u}return n.value},Ke=Ie(ie),Fe=r=>(s,t,a,l)=>k(null,null,function*(){var d;const o=a?Object.assign(a,{async:!0}):{async:!0};let n=s._zod.run({value:t,issues:[]},o);if(n instanceof Promise&&(n=yield n),n.issues.length){const u=new((d=l==null?void 0:l.Err)!=null?d:r)(n.issues.map(h=>ne(h,o,re())));throw ae(u,l==null?void 0:l.callee),u}return n.value}),$e=Fe(ie);function J(r,s){try{var t=r()}catch(a){return s(a)}return t&&t.then?t.then(void 0,s):t}function De(r,s){for(var t={};r.length;){var a=r[0],l=a.code,o=a.message,n=a.path.join(".");if(!t[n])if("unionErrors"in a){var d=a.unionErrors[0].errors[0];t[n]={message:d.message,type:d.code}}else t[n]={message:o,type:l};if("unionErrors"in a&&a.unionErrors.forEach(function(c){return c.errors.forEach(function(m){return r.push(m)})}),s){var u=t[n].types,h=u&&u[a.code];t[n]=X(n,s,t,l,h?[].concat(h,a.message):a.message)}r.shift()}return t}function Qe(r,s){for(var t={};r.length;){var a=r[0],l=a.code,o=a.message,n=a.path.join(".");if(!t[n])if(a.code==="invalid_union"){var d=a.errors[0][0];t[n]={message:d.message,type:d.code}}else t[n]={message:o,type:l};if(a.code==="invalid_union"&&a.errors.forEach(function(c){return c.forEach(function(m){return r.push(m)})}),s){var u=t[n].types,h=u&&u[a.code];t[n]=X(n,s,t,l,h?[].concat(h,a.message):a.message)}r.shift()}return t}function qe(r,s,t){if(t===void 0&&(t={}),function(a){return"_def"in a&&typeof a._def=="object"&&"typeName"in a._def}(r))return function(a,l,o){try{return Promise.resolve(J(function(){return Promise.resolve(r[t.mode==="sync"?"parse":"parseAsync"](a,s)).then(function(n){return o.shouldUseNativeValidation&&H({},o),{errors:{},values:t.raw?Object.assign({},a):n}})},function(n){if(function(d){return Array.isArray(d==null?void 0:d.issues)}(n))return{values:{},errors:B(De(n.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw n}))}catch(n){return Promise.reject(n)}};if(function(a){return"_zod"in a&&typeof a._zod=="object"}(r))return function(a,l,o){try{return Promise.resolve(J(function(){return Promise.resolve((t.mode==="sync"?Ke:$e)(r,a,s)).then(function(n){return o.shouldUseNativeValidation&&H({},o),{errors:{},values:t.raw?Object.assign({},a):n}})},function(n){if(function(d){return d instanceof Ae}(n))return{values:{},errors:B(Qe(n.issues,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw n}))}catch(n){return Promise.reject(n)}};throw new Error("Invalid input: not a Zod schema")}const He=G({shard:Y().min(1,"Please select a shard"),quantity:N().min(1,"Quantity must be at least 1"),hunterFortune:N().min(0,"Hunter Fortune must be non-negative"),excludeChameleon:F(),frogPet:F(),newtLevel:N().min(0).max(10),salamanderLevel:N().min(0).max(10),lizardKingLevel:N().min(0).max(10),leviathanLevel:N().min(0).max(10),pythonLevel:N().min(0).max(10),kingCobraLevel:N().min(0).max(10),seaSerpentLevel:N().min(0).max(10),tiamatLevel:N().min(0).max(10),kuudraTier:be(["none","t1","t2","t3","t4","t5"]),moneyPerHour:N().min(0),noWoodenBait:F()});G({shardId:Y(),rate:N().min(0)});const Be=A.memo(({shard:r,index:s,focusedIndex:t,onSelect:a,isSelecting:l,setFocusedIndex:o})=>{const n=p.useCallback(u=>{u.preventDefault(),u.stopPropagation(),a(r)},[a,r]),d=p.useCallback(()=>{l||o(s)},[l,o,s]);return e.jsx("li",{className:`px-3 py-2.5 cursor-pointer border-b border-slate-700 last:border-b-0 ${s===t?"bg-purple-600 text-white":"text-slate-200 hover:bg-slate-700"}`,onMouseDown:n,onClick:n,onMouseEnter:d,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-medium truncate ${T(r.rarity)}`,children:r.name}),e.jsxs("div",{className:"text-xs opacity-75 truncate",children:[r.family," â€¢ ",r.type]})]}),r.rate>0&&e.jsxs("div",{className:"text-xs font-mono bg-slate-900/50 px-2 py-1 rounded ml-2",children:[r.rate,"/hr"]})]})})}),Ve=({value:r,onChange:s,onSelect:t,placeholder:a="Search for a shard...",className:l=""})=>{const[o,n]=p.useState([]),[d,u]=p.useState(!1),[h,c]=p.useState(-1),[m,i]=p.useState(!1),[x,f]=p.useState(!1),b=p.useRef(null),j=p.useRef(null),v=p.useRef(null),L=p.useMemo(()=>ve(g=>k(null,null,function*(){if(g.length===0||m){n([]),u(!1),f(!1);return}f(!0);try{const E=yield O.getInstance().searchShards(g);n(E.slice(0,10)),u(E.length>0),c(-1)}catch(y){console.error("Search failed:",y),n([]),u(!1)}finally{f(!1)}}),100),[m]),I=p.useCallback(g=>{const y=g.target.value;i(!1),s(y),v.current&&clearTimeout(v.current),L(y)},[s,L]),M=p.useCallback(g=>{i(!0),u(!1),n([]),c(-1),s(g.name),t(g),v.current&&clearTimeout(v.current),setTimeout(()=>{i(!1),b.current&&b.current.blur()},50)},[s,t]),oe=p.useCallback(g=>{if(!(!d||o.length===0||m))switch(g.key){case"ArrowDown":g.preventDefault(),c(y=>(y+1)%o.length);break;case"ArrowUp":g.preventDefault(),c(y=>y<=0?o.length-1:y-1);break;case"Enter":g.preventDefault(),h>=0&&h<o.length?M(o[h]):o.length===1&&M(o[0]);break;case"Escape":u(!1),c(-1);break}},[d,o,m,h,M]),ce=p.useCallback(()=>{var g;i(!1),s(""),n([]),u(!1),c(-1),v.current&&clearTimeout(v.current),(g=b.current)==null||g.focus()},[s]),de=p.useCallback(()=>{m||r.trim()&&L(r)},[m,r,L]);return p.useEffect(()=>{const g=y=>{const E=y.target;b.current&&!b.current.contains(E)&&j.current&&!j.current.contains(E)&&(u(!1),c(-1))};return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g),v.current&&clearTimeout(v.current)}},[]),e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}):e.jsx(Se,{className:"h-4 w-4 text-slate-400"})}),e.jsx("input",{ref:b,type:"text",value:r,onChange:I,onKeyDown:oe,onFocus:de,placeholder:a,className:"w-full pl-10 pr-10 py-2.5 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors",autoComplete:"off",spellCheck:!1}),r&&e.jsx("button",{onClick:ce,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white",children:e.jsx(te,{className:"h-4 w-4"})})]}),d&&o.length>0&&!m&&e.jsx("ul",{ref:j,className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:o.map((g,y)=>e.jsx(Be,{shard:g,index:y,focusedIndex:h,onSelect:M,isSelecting:m,setFocusedIndex:c},g.key))})]})},Ue=A.memo(({value:r,onChange:s,label:t})=>{const a=p.useMemo(()=>Array.from({length:11},(l,o)=>o),[]);return e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsx("select",{value:r,onChange:l=>s(Number(l.target.value)),className:"w-full px-3 py-2.5 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 appearance-none cursor-pointer hover:border-slate-500 transition-colors",children:a.map(l=>e.jsxs("option",{value:l,className:"bg-slate-800 text-white",children:["Level ",l]},l))})]})}),We=A.memo(({value:r,onChange:s,label:t})=>e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:t}),e.jsx("select",{value:r,onChange:a=>s(a.target.value),className:"w-full px-3 py-2.5 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 appearance-none cursor-pointer hover:border-slate-500 transition-colors",children:je.map(a=>e.jsx("option",{value:a.value,className:"bg-slate-800 text-white",children:a.label},a.value))})]})),Ze=({onSubmit:r})=>{const{register:s,setValue:t,watch:a,reset:l,formState:{errors:o}}=ge({resolver:qe(He),defaultValues:{shard:"",quantity:1,hunterFortune:0,excludeChameleon:!1,frogPet:!1,newtLevel:0,salamanderLevel:0,lizardKingLevel:0,leviathanLevel:0,pythonLevel:0,kingCobraLevel:0,seaSerpentLevel:0,tiamatLevel:0,kuudraTier:"t5",moneyPerHour:0,noWoodenBait:!1}}),n=a("shard"),d=a();p.useEffect(()=>{const i=x=>k(null,null,function*(){if(!x||x.trim()==="")return!1;try{return!!(yield O.getInstance().getShardNameToKeyMap())[x.toLowerCase()]}catch(f){return!1}});if(n&&n.trim()!==""&&d.shard&&d.shard.trim()!==""){const x=setTimeout(()=>k(null,null,function*(){if(yield i(d.shard)){const b=d,j=S(w({},b),{frogPet:!b.frogPet});r(j)}}),1e3);return()=>clearTimeout(x)}},[d,r,n]);const u=i=>{t("shard",i.name),setTimeout(()=>{const x=a(),f=S(w({},x),{shard:i.name,frogPet:!x.frogPet});r(f)},100)},h=()=>{t("hunterFortune",121),t("newtLevel",10),t("salamanderLevel",10),t("lizardKingLevel",10),t("leviathanLevel",10),t("pythonLevel",10),t("kingCobraLevel",10),t("seaSerpentLevel",10),t("tiamatLevel",10)},c=()=>{const i=a("shard"),x=a("quantity");l(),t("shard",i),t("quantity",x)},m=()=>k(null,null,function*(){const i=n;if(!i||i.trim()===""){t("quantity",P.common);return}try{const f=yield O.getInstance().getShardByName(i);if(f){const b=P[f.rarity]||P.common;t("quantity",b)}else t("quantity",P.common)}catch(x){console.error("Failed to get shard rarity:",x),t("quantity",P.common)}});return e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 pb-3 border-b border-slate-700",children:[e.jsx("div",{className:"w-7 h-7 bg-purple-500/20 rounded flex items-center justify-center",children:e.jsx(ke,{className:"w-4 h-4 text-purple-400"})}),e.jsx("h2",{className:"text-base font-medium text-white",children:"Configuration"})]}),e.jsxs("form",{onSubmit:i=>i.preventDefault(),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-200 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Target Shard"]}),e.jsx(Ve,{value:n,onChange:i=>t("shard",i),onSelect:u,placeholder:"Search for a shard..."}),o.shard&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:o.shard.message})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Quantity"}),e.jsx("input",S(w({type:"number",min:"1"},s("quantity",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:"w-full px-3 py-2.5 text-sm bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20 hover:border-slate-500 transition-colors"})),o.quantity&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:o.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-300 mb-1",children:"Â "}),e.jsx("button",{type:"button",onClick:m,className:"w-full h-[42px] text-sm bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors flex items-center justify-center",children:"Max"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-200",children:"Settings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:h,className:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-xs font-medium rounded-md transition-colors flex items-center space-x-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:"Max Stats"})]}),e.jsxs("button",{type:"button",onClick:c,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-medium rounded-md transition-colors flex items-center space-x-1",children:[e.jsx(Te,{className:"w-3 h-3"}),e.jsx("span",{children:"Reset"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Hunter Fortune"]}),e.jsx("input",S(w({type:"number",min:"0"},s("hunterFortune",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:"w-full px-3 py-2.5 text-sm bg-slate-900/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"}))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-slate-900/50 border border-slate-600/50 rounded-lg hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",S(w({id:"excludeChameleon",type:"checkbox"},s("excludeChameleon")),{className:"w-4 h-4 rounded bg-slate-600 border border-slate-500 text-indigo-500 focus:ring-indigo-500"})),e.jsx("label",{htmlFor:"excludeChameleon",className:"text-sm font-medium text-white cursor-pointer flex-1",children:"Exclude Chameleon"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-slate-900/50 border border-slate-600/50 rounded-lg hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",S(w({id:"excludeWoodenBait",type:"checkbox"},s("noWoodenBait")),{className:"w-4 h-4 rounded bg-slate-600 border border-slate-500 text-indigo-500 focus:ring-indigo-500"})),e.jsx("label",{htmlFor:"excludeWoodenBait",className:"text-sm font-medium text-white cursor-pointer flex-1",children:"Exclude Wooden Bait"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-slate-900/50 border border-slate-600/50 rounded-lg hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",S(w({id:"frogPet",type:"checkbox"},s("frogPet")),{className:"w-4 h-4 rounded bg-slate-600 border border-slate-500 text-indigo-500 focus:ring-indigo-500"})),e.jsx("label",{htmlFor:"frogPet",className:"text-sm font-medium text-white cursor-pointer flex-1",children:"No Frog Pet"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-200",children:"Shard Levels"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"newtLevel",label:"Newt"},{key:"salamanderLevel",label:"Salamander"},{key:"lizardKingLevel",label:"Lizard King"},{key:"leviathanLevel",label:"Leviathan"},{key:"pythonLevel",label:"Python"},{key:"kingCobraLevel",label:"King Cobra"},{key:"seaSerpentLevel",label:"Sea Serpent"},{key:"tiamatLevel",label:"Tiamat"}].map(({key:i,label:x})=>e.jsx(Ue,{value:a(i)||0,onChange:f=>t(i,f),label:x},i))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-200",children:"Kraken Shard"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(We,{value:a("kuudraTier")||"t5",onChange:i=>t("kuudraTier",i),label:"Kuudra Tier"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Coins/hour"}),e.jsx("input",S(w({type:"number",min:"0",placeholder:"40000000"},s("moneyPerHour",{valueAsNumber:!0})),{onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),i.currentTarget.blur())},className:"w-full px-3 py-2.5 text-sm bg-slate-900/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"})),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Empty to ignore key cost"})]})]})]})]})]})},D=({tree:r,data:s,isTopLevel:t=!1,totalShardsProduced:a=r.quantity,nodeId:l,expandedStates:o,onToggle:n})=>{var f;const d=s.shards[r.shard],u=(f=o.get(l))!=null?f:!0;if(r.method==="direct")return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800 rounded border border-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-slate-300 font-medium bg-slate-700 px-2 py-1 rounded text-sm",children:[r.quantity,"x"]}),e.jsx("span",{className:`font-medium ${T(d.rarity)}`,title:V(d,!0),children:d.name}),e.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 text-xs font-medium rounded",children:"DIRECT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:[ee(d.rate),"/hour"]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[d.type," â€¢ ",d.family]})]})]});const h=r.inputs[0],c=r.inputs[1],m=s.shards[h.shard],i=s.shards[c.shard],x=t?a:r.quantity;return e.jsxs("div",{className:"bg-slate-800 rounded border border-slate-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>n(l),className:"w-full p-3 text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[u?e.jsx(Pe,{className:"w-4 h-4 text-slate-400"}):e.jsx(Me,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("span",{className:"font-medium",children:[x,"x "]}),e.jsx("span",{className:`font-medium ${T(d.rarity)}`,title:V(d,!1),children:d.name}),e.jsxs("span",{className:"text-slate-400 ml-2 text-sm",children:["= ",h.quantity,"x ",e.jsx("span",{className:T(m.rarity),children:m.name})," + ",c.quantity,"x"," ",e.jsx("span",{className:T(i.rarity),children:i.name})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"fusions"}),e.jsx("span",{className:"text-sm font-medium text-white",children:x})]}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[d.type," â€¢ ",d.family]})]})]})}),u&&e.jsxs("div",{className:"border-t border-slate-600 p-3 space-y-2",children:[e.jsx(D,{tree:h,data:s,nodeId:`${l}-0`,expandedStates:o,onToggle:n}),e.jsx(D,{tree:c,data:s,nodeId:`${l}-1`,expandedStates:o,onToggle:n})]})]})},Je=({result:r,data:s,targetShardName:t})=>{const[a,l]=p.useState(new Map),[o,n]=p.useState(""),d=(c,m="root")=>{const i=new Map,x=(f,b)=>{f.method==="recipe"&&f.inputs&&(i.set(b,!0),f.inputs.forEach((j,v)=>{x(j,`${b}-${v}`)}))};return x(c,m),i};A.useEffect(()=>{if(r.tree){const c=JSON.stringify(r.tree);if(c!==o){const m=d(r.tree);l(m),n(c)}}},[r.tree,o]);const u=()=>{const c=new Map(a),m=Array.from(c.values()).every(i=>i);for(const i of c.keys())c.set(i,!m);l(c)},h=c=>{const m=new Map(a);m.set(c,!m.get(c)),l(m)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Le,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Time per Shard"}),e.jsx("p",{className:"text-white font-medium text-sm",children:R(r.timePerShard)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Time"}),e.jsx("p",{className:"text-white font-medium text-sm",children:R(r.totalTime)})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(W,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Shards Produced"}),e.jsx("p",{className:"text-white font-medium text-sm",children:r.totalShardsProduced})]})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded flex items-center justify-center",children:e.jsx(Z,{className:"w-4 h-4 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs",children:"Total Fusions"}),e.jsxs("p",{className:"text-white font-medium text-sm",children:[r.totalFusions,"x",r.craftTime>1/12&&e.jsx("span",{className:"text-xs text-slate-400 block",children:R(r.craftTime)})]})]})]})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded",children:e.jsx(Z,{className:"w-5 h-5 text-blue-400"})}),"Materials Needed"]}),e.jsxs("div",{className:"text-sm text-slate-300 bg-slate-700 px-3 py-1 rounded",children:["for ",r.totalShardsProduced," ",t," (",r.craftsNeeded," craft",r.craftsNeeded>1?"s":"",")"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:Array.from(r.totalQuantities).map(([c,m])=>{const i=s.shards[c],x=m/i.rate;return e.jsx("div",{className:"bg-slate-700 border border-slate-600 rounded p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[m,"x ",e.jsx("span",{className:T(i.rarity),children:i.name})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[ee(i.rate),"/hour"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs text-slate-400",children:R(x)})})]})},c)})})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-slate-700 rounded",children:e.jsx(W,{className:"w-5 h-5 text-purple-400"})}),"Fusion Tree"]}),e.jsx("button",{onClick:u,className:"px-3 py-2 bg-slate-700 text-white rounded text-sm font-medium",children:Array.from(a.values()).every(c=>c)?"Collapse All":"Expand All"})]}),e.jsx(D,{tree:r.tree,data:s,isTopLevel:!0,totalShardsProduced:r.totalShardsProduced,nodeId:"root",expandedStates:a,onToggle:h})]})]})},C=class C{static getInstance(){return C.instance||(C.instance=new C),C.instance}parseData(s){return k(this,null,function*(){var t,a;try{const[l,o]=yield Promise.all([fetch("/SkyShards/fusion-data.json"),fetch("/SkyShards/rates.json")]),n=yield l.json(),d=yield o.json(),u={};for(const c in n.recipes){u[c]=[];for(const m in n.recipes[c]){const i=parseInt(m);n.recipes[c][m].forEach(f=>{u[c].push({inputs:f,outputQuantity:i})})}}const h={};for(const c in n.shards){let m=(a=(t=s.customRates[c])!=null?t:d[c])!=null?a:0;c==="L15"&&m===0&&(m=this.calculateKuudraRate(s.kuudraTier,s.moneyPerHour)),m>0&&(s.noWoodenBait&&ye.includes(c)&&(m*=.05),Ne.includes(c)||(m=this.applyFortuneModifiers(m,c,n.shards[c],s))),s.excludeChameleon&&c==="L4"&&(m=0),h[c]=S(w({},n.shards[c]),{id:c,rate:m})}return{recipes:u,shards:h}}catch(l){throw new Error(`Failed to parse data: ${l}`)}})}calculateKuudraRate(s,t){const l={t1:{baseTime:135,cost:155e3,multiplier:1},t2:{baseTime:135,cost:31e4,multiplier:1},t3:{baseTime:135,cost:582e3,multiplier:2},t4:{baseTime:135,cost:1164e3,multiplier:2},t5:{baseTime:165,cost:2328e3,multiplier:3}}[s];if(!l)return 0;const o=t===0?0:l.cost/t*3600;return l.multiplier*(3600/(l.baseTime+o))}applyFortuneModifiers(s,t,a,l){let o=l.hunterFortune;const n=1+5*l.tiamatLevel/100,d=1+2*l.seaSerpentLevel/100*n,u=2*l.pythonLevel/100*d,h=l.kingCobraLevel/100*d;switch(a.rarity){case"common":o+=2*l.newtLevel;break;case"uncommon":o+=2*l.salamanderLevel;break;case"rare":o+=l.lizardKingLevel;break;case"epic":o+=l.leviathanLevel;break}return l.frogPet&&(s*=1.1),t in U&&(U[t]&&(s*=1+u),o*=1+h),s*(1+o/100)}computeMinCosts(s){const t=new Map,a=new Map,l=Object.keys(s.shards),o=.8/3600;l.forEach(d=>{const u=s.shards[d].rate>0?1/s.shards[d].rate:1/0;t.set(d,u),a.set(d,{recipe:null})});let n=!0;for(;n;)n=!1,l.forEach(d=>{(s.recipes[d]||[]).forEach(h=>{const[c,m]=h.inputs,i=s.shards[c].fuse_amount,x=s.shards[m].fuse_amount,f=t.get(c)*i,b=t.get(m)*x,v=(f+b+o)/h.outputQuantity;v<t.get(d)&&(t.set(d,v),a.set(d,{recipe:h}),n=!0)})});return{minCosts:t,choices:a}}buildRecipeTree(s,t){const a=t.get(s);if(a.recipe===null)return{shard:s,method:"direct",quantity:0};{const l=a.recipe,[o,n]=l.inputs,d=this.buildRecipeTree(o,t),u=this.buildRecipeTree(n,t);return{shard:s,method:"recipe",recipe:l,inputs:[d,u],quantity:0}}}assignQuantities(s,t,a,l){if(s.quantity=t,s.method==="recipe"){const o=s.recipe,n=o.outputQuantity,d=Math.ceil(t/n);l.total+=d;const[u,h]=o.inputs,c=a.shards[u].fuse_amount,m=a.shards[h].fuse_amount,i=d*c,x=d*m;this.assignQuantities(s.inputs[0],i,a,l),this.assignQuantities(s.inputs[1],x,a,l)}}collectTotalQuantities(s){const t=new Map,a=l=>{if(l.method==="direct"){const o=t.get(l.shard)||0;t.set(l.shard,o+l.quantity)}else l.inputs.forEach(a)};return a(s),t}decimalHoursToHoursMinutes(s){const t=Math.floor(s),a=Math.round((s-t)*60);return t===0?`${a} minutes`:a===0||isNaN(a)?`${t} hours`:`${t} hours ${a} minutes`}calculateOptimalPath(s,t,a){return k(this,null,function*(){var j;const l=yield this.parseData(a);if(!l.shards[s])return{timePerShard:0,totalTime:0,totalShardsProduced:0,craftsNeeded:0,totalQuantities:new Map,totalFusions:0,craftTime:0,tree:{shard:s,method:"direct",quantity:0,inputs:[]}};const{minCosts:o,choices:n}=this.computeMinCosts(l),d=this.buildRecipeTree(s,n),u={total:0};this.assignQuantities(d,t,l,u);const h=this.collectTotalQuantities(d);let c=t,m=1;const i=n.get(s);if(i!=null&&i.recipe){const v=i.recipe.outputQuantity;m=Math.ceil(t/v),c=m*v}const x=(j=o.get(s))!=null?j:0,f=x*c,b=u.total*.8/3600;return{timePerShard:x,totalTime:f,totalShardsProduced:c,craftsNeeded:m,totalQuantities:h,totalFusions:u.total,craftTime:b,tree:d}})}};q(C,"instance");let z=C;const Xe=Object.freeze(Object.defineProperty({__proto__:null,CalculationService:z},Symbol.toStringTag,{value:"Module"})),Ge=()=>{const[r,s]=p.useState(null),[t,a]=p.useState(!1),[l,o]=p.useState(null),n=p.useCallback((u,h,c)=>k(null,null,function*(){try{a(!0),o(null);const i=yield z.getInstance().calculateOptimalPath(u,h,c);s(i)}catch(m){o(m instanceof Error?m.message:"Calculation failed"),s(null)}finally{a(!1)}}),[]),d=p.useCallback(()=>{s(null),o(null)},[]);return{result:r,loading:t,error:l,calculate:n,clearResult:d}},nt=()=>{const{result:r,loading:s,error:t,calculate:a}=Ge(),{customRates:l}=we(),[o,n]=p.useState(null),[d,u]=p.useState(""),[h,c]=p.useState(!1),m=i=>k(null,null,function*(){try{if(!i.shard||i.shard.trim()===""){console.warn("Calculation skipped: No shard selected");return}c(!1);const b=(yield O.getInstance().getShardNameToKeyMap())[i.shard.toLowerCase()];if(!b){console.warn(`Calculation skipped: Shard "${i.shard}" not found in data`);return}u(i.shard);const j={customRates:l,hunterFortune:i.hunterFortune,excludeChameleon:i.excludeChameleon,frogPet:i.frogPet,newtLevel:i.newtLevel,salamanderLevel:i.salamanderLevel,lizardKingLevel:i.lizardKingLevel,leviathanLevel:i.leviathanLevel,pythonLevel:i.pythonLevel,kingCobraLevel:i.kingCobraLevel,seaSerpentLevel:i.seaSerpentLevel,tiamatLevel:i.tiamatLevel,kuudraTier:i.kuudraTier,moneyPerHour:i.moneyPerHour,noWoodenBait:i.noWoodenBait};yield a(b,i.quantity,j);const I=yield(yield pe(()=>Promise.resolve().then(()=>Xe),void 0)).CalculationService.getInstance().parseData(j);n(I)}catch(x){x instanceof Error&&!x.message.includes("not found")&&console.error("Calculation failed:",x)}});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-4 lg:gap-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsxs("div",{className:"sticky top-4",children:[e.jsx("div",{className:"xl:hidden mb-3",children:e.jsxs("button",{onClick:()=>c(!h),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white flex items-center justify-center space-x-2",children:[h?e.jsx(te,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[h?"Hide":"Show"," Configuration"]})]})}),e.jsx("div",{className:`${h?"block":"hidden xl:block"}`,children:e.jsx(Ze,{onSubmit:m})})]})}),e.jsxs("div",{className:"xl:col-span-3 space-y-4",children:[t&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded p-3 flex items-start space-x-2",children:[e.jsx(Re,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-400",children:"Calculation Error"}),e.jsx("p",{className:"text-red-300 text-sm mt-1",children:t})]})]}),r&&o&&e.jsx(Je,{result:r,data:o,targetShardName:d}),!r&&!s&&!t&&e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700 rounded",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-700 rounded flex items-center justify-center mx-auto",children:e.jsx($,{className:"w-6 h-6 text-slate-300"})}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"Ready to Calculate"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your settings and select a shard to see optimal fusion paths"}),e.jsx("div",{className:"xl:hidden",children:e.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-slate-700 text-white text-sm rounded flex items-center space-x-1 mx-auto",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Open Configuration"})]})})]})})]})]})})};export{nt as CalculatorPage};
